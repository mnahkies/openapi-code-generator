"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[53],{46903:(e,t,n)=>{n.a(e,async(e,r)=>{try{n.d(t,{Dt:()=>A,HF:()=>U,wj:()=>N,zN:()=>V});var a,o=n(49402),i=n(54910),l=n(59526),s=n(93210),d=n(86538),u=n(71644),c=n(56342),p=n(58985),f=n(42666),m=n(84972),y=n(16706),g=n(17459),v=n(1596),k=n(5133),b=n(89538),h=n(21991),T=n(14840),S=n(14383),x=n(23415),w=n(54795),M=n(26985),E=n(77360),P=n(15209),I=e([o,i,d,u,y,v,k,b,T,x,M]);[o,i,d,u,y,v,k,b,T,x,M]=I.then?(await I)():I;let $=class extends d.$V{};function N(e,t){let n,r;let o={},i=new WeakMap,I=new Map,N=new WeakMap,A=new WeakMap,U=t=>{e.reportDiagnostic(t)},D={get projections(){return(W.get(this.kind)||[]).concat(Y.get(this)||[])},projectionsByName(e){return this.projections.filter(t=>t.id.sv===e)}},Q=function(){let e=t.symbols.global,n=ty({kind:"Namespace",name:"",node:eC(),models:new Map,scalars:new Map,operations:new Map,namespaces:new Map,interfaces:new Map,unions:new Map,enums:new Map,decoratorDeclarations:new Map,functionDeclarations:new Map,decorators:[]});return eR(e).type=n,n.decorators=tn(e,n,void 0),tg(n)}(),z=new Map,G=ty({kind:"Intrinsic",name:"ErrorType"}),X=ty({kind:"Intrinsic",name:"void"}),q=ty({kind:"Intrinsic",name:"never"}),J=ty({kind:"Intrinsic",name:"unknown"}),H=ty({kind:"Intrinsic",name:"null"}),W=new Map([["Model",[]],["ModelProperty",[]],["Scalar",[]],["Union",[]],["UnionVariant",[]],["Operation",[]],["Interface",[]],["Enum",[]],["EnumMember",[]]]),Y=new Map,Z=new Set,ee=new _,et=t.symbols.global.exports.get("TypeSpec");et&&((0,d.Tk)(et.exports).set("log",{flags:8192,name:"log",value:(t,...n)=>(e.trace("projection.log",n.join(" ")),X),declarations:[],node:void 0}),(0,d.Tk)(t.symbols.null).type=H,eR(t.symbols.null).type=H);let en=new Map,er={getTypeForNode:ec,checkProgram:function(){for(let n of(function(){for(let n of(e.reportDuplicateSymbols(t.symbols.global.exports),e.sourceFiles.values()))for(let t of n.namespaces){let n=tk(t.symbol).exports??t.symbol.exports;e.reportDuplicateSymbols(n)}}(),e.sourceFiles.values()))for(let r of(function(n){let r=new Map;for(let e of n.usings){let n=e.parent,a=tk(n.symbol),o=function(e){let t=r.get(e);if(t)return t;let n=new s.i;return r.set(e,n),n}(a),i=t.getNodeLinks(e.name).resolvedSymbol;i&&o.track(i,e)}for(let t of r.values())for(let[n,r]of t.entries())for(let t of r)e.reportDiagnostic((0,T.o)({code:"duplicate-using",format:{usingName:(0,k.q5)(t.name)},target:t}))}(n),n.namespaces))eD(r);for(let t of e.sourceFiles.values())ez(t);(0,y.JN)(e)},checkSourceFile:ez,getLiteralType:tv,getTypeName:b.Uz,getNamespaceString:b.Qn,getGlobalNamespaceType:function(){return Q},getGlobalNamespaceNode:eC,getMergedSymbol:tk,cloneType:th,resolveRelatedSymbols:function(e,n){let r;let{node:a,kind:o}=(0,x.fe)(e);switch(o){case P.wp.ModelExpressionProperty:case P.wp.ObjectLiteralProperty:return eL(a).map(t=>tu(t.node.symbol,e.sv)).filter(e=>void 0!==e);case P.wp.ModelStatementProperty:case P.wp.Declaration:let i=t.getNodeLinks(e);return void 0===i.resolvedSymbol?void 0:[i.resolvedSymbol];case P.wp.Other:return;case P.wp.Decorator:case P.wp.Function:case P.wp.Using:case P.wp.TypeReference:let l=e,s=o===P.wp.Decorator;e.parent?.kind===P.a6.MemberExpression&&(e.parent.id===e?l=e.parent:s=!1),r=e$(l,n,s);break;case P.wp.TemplateArgument:let d=eB(a,n).flatMap(e=>e.templateParameters).find(t=>t.id.sv===e.sv);d&&(r=tk(d.symbol));break;default:(0,m.a7)(!1,"Unreachable")}if(r)return r.symbolSource?[r.symbolSource]:[r]},resolveCompletions:function(n){let r=new Map,{kind:a,node:o}=(0,x.fe)(n);switch(a){case P.wp.Using:case P.wp.Decorator:case P.wp.Function:case P.wp.TypeReference:case P.wp.ModelExpressionProperty:case P.wp.ModelStatementProperty:case P.wp.ObjectLiteralProperty:break;case P.wp.Other:case P.wp.Declaration:return r;case P.wp.TemplateArgument:for(let e of eB(o,void 0))for(let t of e.templateParameters)l(t.id.sv,t.symbol);return r;default:(0,m.a7)(!1,"Unreachable")}if(a===P.wp.ModelStatementProperty){let t=o.parent,a=e.checker.getTypeForNode(t),i=a.baseModel,s=i?.node;if(!s)return r;for(let e of i.properties.values())if(n.sv===e.name||!a.properties.has(e.name)){let t=tu(s.symbol,e.name);t&&l(e.name,t)}}else if(a===P.wp.ModelExpressionProperty||a===P.wp.ObjectLiteralProperty){let e=eL(o);if(e.length<=0)return r;let t=o.parent;for(let r of e)for(let e of V(r))if(n.sv===e.name||!t.properties.find(t=>(t.kind===P.a6.ModelProperty||t.kind===P.a6.ObjectLiteralProperty)&&t.id.sv===e.name)){let t=tu(r.node.symbol,e.name);t&&l(e.name,t)}}else if(n.parent&&n.parent.kind===P.a6.MemberExpression){let e=t.getNodeLinks(n.parent.base).resolvedSymbol;if(e&&(128&e.flags&&(e=e_(e,void 0)),e)){if("::"===n.parent.selector){if(e?.node===void 0&&e?.declarations&&e.declarations.length>0){let t=e?.declarations[0];t.kind===P.a6.OperationStatement&&(l("parameters",t.symbol),l("returnType",t.symbol))}else if(e?.node?.kind===P.a6.ModelProperty){let t=e.node;l("type",t.symbol)}}else i(e.exports??e.members)}}else{if(a===P.wp.TypeReference&&(0,x.Px)(o)&&o.parent?.kind===P.a6.TemplateArgument&&void 0===o.parent.name)for(let e of eB(o.parent,void 0))for(let t of e.templateParameters)l(t.id.sv,t.symbol,{suffix:" = "});let e=n.parent;for(;e&&e.kind!==P.a6.TypeSpecScript;){if(e.symbol&&e.symbol.exports){let t=tk(e.symbol);i(t.exports)}"locals"in e&&i(e.locals),e=e.parent}if(e&&e.kind===P.a6.TypeSpecScript){for(let t of e.inScopeNamespaces){let e=tk(t.symbol);i(e.exports)}i(t.symbols.global.exports),i(e.locals)}}return r;function i(e){if(e)for(let[n,r]of e=t.getAugmentedSymbolTable(e))if(65536&r.flags){for(let t of e.duplicates.get(r))if(32768&t.flags){let e=(0,E.eN)(t.symbolSource);l(e,t)}}else l(n,r)}function l(e,t,n={}){t.symbolSource&&(t=t.symbolSource),function(e){switch(a){case P.wp.ModelExpressionProperty:case P.wp.ModelStatementProperty:case P.wp.ObjectLiteralProperty:return!!(262144&e.flags);case P.wp.Decorator:return!!(1280&e.flags);case P.wp.Using:return!!(256&e.flags);case P.wp.TypeReference:return!(9216&e.flags);case P.wp.TemplateArgument:return!!(2048&e.flags);default:(0,m.a7)(!1,"We should have bailed up-front on other kinds.")}}(t)&&(e.startsWith("@")&&(e=e.slice(1)),r.has(e)||r.set(e,{...n,sym:t}))}},evalProjection:tM,project:function(e,t,n=[]){return tM(t,e,n.map(e=>tI(e)))},neverType:q,errorType:G,nullType:H,anyType:J,voidType:X,typePrototype:D,createType:ty,createAndFinishType:tm,createFunctionType:tE,createLiteralType:tP,finishType:tg,isStdType:function(e,t){return e=e.projectionBase??e,!!(("Model"===e.kind||"Scalar"===e.kind)&&void 0!==e.namespace&&eh(e.namespace))&&("Scalar"===e.kind?void 0===t||t===e.name:"Array"===t&&e===o.Array||"Record"===t&&e===o.Record||"Model"===e.kind&&(void 0===t||t===e.name))},getStdType:es,resolveTypeReference:function(e){let t=U,n=[];U=e=>n.push(e);let r=ex(e,void 0,!1);return U=t,[r===G?void 0:r,n]},getValueForNode:ep,getTypeOrValueForNode:eg,getValueExactType:function(e){return A.get(e)},getTemplateParameterUsageMap:function(){return en},isTypeAssignableTo:void 0},ea=(0,M.i)(e,er);er.isTypeAssignableTo=ea.isTypeAssignableTo;let eo=(0,w.J)(er);return er;function ei(e,t){U(void 0===t||"object"!=typeof e.target?e:{...e,target:{node:e.target,templateMapper:t}})}function el(e){e.forEach(e=>ei(e))}function es(e){let t=o[e];if(void 0!==t)return t;let n=et?.exports?.get(e);(0,m.a7)(n,`Unexpected missing symbol to std type "${e}"`),2&n.flags?eX(n.declarations[0],void 0):ta(n.declarations[0],void 0);let r=o[e];return(0,m.a7)(r,`TypeSpec std type "${e}" should have been initalized before using array syntax.`),r}function ed(e,t,n){void 0===n?(e.declaredType=t,e.instantiations=new $):e.instantiations&&e.instantiations.set(n.args,t)}function eu(e,t){let n=eR(e),r=ec((0,u.gG)(e.parent),t),a=n.declaredType??n.type;return a||function(e,t,n){switch(e.kind){case P.a6.ModelProperty:return e5(e,t);case P.a6.EnumMember:return tf(e,t,n);case P.a6.OperationStatement:return eO(e,t,n);case P.a6.UnionVariant:return td(e,t);case P.a6.ScalarConstructor:return to(e,t,n)}}((0,u.gG)(e),t,r)}function ec(e,t){let n=ek(e,t);return null===n?G:"Indeterminate"===n.entityKind?n.type:(0,E.ml)(n)?(ei((0,T.o)({code:"value-in-type",target:e})),G):("TemplateParameter"===n.kind&&n.constraint?.valueType&&ei((0,T.o)({code:"value-in-type",messageId:"referenceTemplate",target:e})),n)}function ep(e,t,n,r={}){var a,o;let i;let l=ek(e,t,n);return null===l?null:(i="Indeterminate"===l.entityKind?ef(l.type,n,e):l,r.legacyTupleAndModelCast&&null!==i&&(0,E.Xj)(i)&&(i=em(i,n,e)),null===i)?null:(0,E.ml)(i)?n?function(e,t){switch(e.valueKind){case"BooleanValue":case"StringValue":case"NumericValue":if(void 0===e.scalar){let n=e0(t,e.type);return eZ(e,{scalar:n})}return e;case"ArrayValue":case"ObjectValue":case"EnumValue":case"NullValue":case"ScalarValue":return e}}(i,n.type):i:(a=e,o=i,"Model"===o.kind&&""===o.name&&a.kind===P.a6.ModelExpression?ei((0,T.o)({code:"expect-value",messageId:"model",format:{name:(0,b.Uz)(o)},codefixes:[(0,p.l)(a)],target:a})):"Tuple"===o.kind&&a.kind===P.a6.TupleExpression?ei((0,T.o)({code:"expect-value",messageId:"tuple",format:{name:(0,b.Uz)(o)},codefixes:[(0,p.s)(a)],target:a})):ei((0,T.o)({code:"expect-value",format:{name:(0,b.Uz)(o)},target:a})),null)}function ef(e,t,n){var r,a,o,i,l,s;switch(e.kind){case"String":case"StringTemplate":return e6(e,t,n);case"Number":return function(e,t,n){if(t&&!tN(e,t,n))return null;let r=e0(t?.type,e);return eY({entityKind:"Value",valueKind:"NumericValue",value:(0,S.ew)(e.valueAsString),type:t?t.type:e,scalar:r},e)}(e,t,n);case"Boolean":return function(e,t,n){if(t&&!tN(e,t,n))return null;let r=e0(t?.type,e);return eY({entityKind:"Value",valueKind:"BooleanValue",value:e.value,type:t?t.type:e,scalar:r},e)}(e,t,n);case"EnumMember":return r=e,a=t,o=n,a&&!tN(r,a,o)?null:eY({entityKind:"Value",valueKind:"EnumValue",type:a?a.type:r,value:r},r);case"UnionVariant":return ef(e.type,t,n);case"Intrinsic":if("null"===e.name){return i=e,l=t,s=n,l&&!tN(i,l,s)?null:eY({entityKind:"Value",valueKind:"NullValue",type:l?l.type:i,value:null},i)}return e;default:return e}}function em(t,n,r){switch(t.kind){case"Tuple":return function(t,n,r){if(t.node.kind!==P.a6.TupleExpression)return t;ei((0,T.o)({code:"deprecated",codefixes:[(0,p.s)(t.node)],format:{message:"Using a tuple as a value is deprecated. Use an array value instead(with #[])."},target:t.node}));let a=[];for(let[o,i]of t.values.entries()){let l=n?.kind==="Model"&&(0,E.x3)(e,n)?n.indexer.value:n?.kind==="Tuple"?n.values[o]:void 0,s=ef(i,l&&{kind:"assignment",type:l},r);if(null!==s&&(0,E.Xj)(s)&&(s=em(s,l&&{kind:"assignment",type:l},r)),null===s)return null;if(!(0,E.ml)(s))return t;a.push(s)}return void 0===n||tj(t,n,r)?{entityKind:"Value",valueKind:"ArrayValue",type:n??t,node:t.node,values:a}:null}(t,n?.type,r);case"Model":return function(e,t,n){if(e.node?.kind!==P.a6.ModelExpression)return e;ei((0,T.o)({code:"deprecated",codefixes:[(0,p.l)(e.node)],format:{message:"Using a model as a value is deprecated. Use an object value instead(with #{})."},target:e.node}));let r={entityKind:"Value",valueKind:"ObjectValue",type:t??e,node:e.node,properties:new Map};for(let t of e.properties.values()){let a=ef(t.type,{kind:"assignment",type:t.type},n);if(null!==a&&(0,E.Xj)(a)&&(a=em(a,{kind:"assignment",type:t.type},n)),null==a)return null;if(!(0,E.ml)(a))return e;r.properties.set(t.name,{name:t.name,value:a,node:t.node})}return void 0===t||tj(e,t,n)?r:null}(t,n?.type,r);default:return t}}function ey(e,t){return!!(t?.valueType&&!(t.type&&(0,m.r$)(ea.isTypeAssignableTo(e,t.type,e))))}function eg(e,t,n){let r=ev(n),a=ek(e,t,r);if(null===a)return a;if((0,E.Xj)(a))return ey(a,n?.constraint)?em(a,r,e):a;if((0,E.ml)(a))return a;if((0,m.a7)("Indeterminate"===a.entityKind,"Expected indeterminate entity"),r){let t=[],n=U;U=e=>t.push(e);let o=ef(a.type,r,e);if(U=n,o)return el(t),o}return a.type}function ev(e){return e?.constraint.valueType?{kind:e.kind,type:e.constraint.valueType}:void 0}function ek(n,r,o){var i,l,s,c,p,f,y;switch(n.kind){case P.a6.ModelExpression:case P.a6.ModelStatement:return function(e,t){return e.kind===P.a6.ModelStatement?eX(e,t):function(e,t){let n=eR(e.symbol);if(n.declaredType&&void 0===t)return n.declaredType;let r=(0,d.nQ)(),a=ty({kind:"Model",name:"",node:e,properties:r,indexer:void 0,namespace:eK(e),decorators:[],derivedModels:[],sourceModels:[]});return ed(n,a,t),K(a,t),eW(e,r,a,t),tg(a)}(e,t)}(n,r);case P.a6.ModelProperty:return e5(n,r);case P.a6.ScalarStatement:return ta(n,r);case P.a6.AliasStatement:return ti(n,r);case P.a6.EnumStatement:return function(e,t){let n=eR(e.symbol);if(!n.type){let r=n.type=ty({kind:"Enum",name:e.id.sv,node:e,members:(0,d.nQ)(),decorators:[]}),a=new Set;for(let n of e.members)if(n.kind===P.a6.EnumMember){let o=tf(n,t,r);if(a.has(o.name)){ei((0,T.o)({code:"enum-member-duplicate",format:{name:o.name},target:e}));continue}a.add(o.name),r.members.set(o.name,o)}else for(let o of function(e,t,n,r,a){let o=[],i=ec(n,r);if(!(0,E.xg)(i)){if("Enum"!==i.kind)return ei((0,T.o)({code:"spread-enum",target:n})),o;for(let r of i.members.values())if(a.has(r.name))ei((0,T.o)({code:"enum-member-duplicate",format:{name:r.name},target:n}));else{a.add(r.name);let n=tu(e,r.name),i=tT(n,r,{enum:t,sourceMember:r});i&&o.push(i)}}return o}(e.symbol,r,n.target,t,a))e8(e,o,t),r.members.set(o.name,o);r.namespace=eK(e),r.namespace?.enums.set(r.name,r),r.decorators=tr(r,e,t),K(r,t),tg(r)}return n.type}(n,r);case P.a6.EnumMember:return tf(n,r);case P.a6.InterfaceStatement:return tl(n,r);case P.a6.UnionStatement:return ts(n,r);case P.a6.UnionVariant:return td(n,r);case P.a6.NamespaceStatement:case P.a6.JsNamespaceDeclaration:return function e(t){let n=eR(tk(t.symbol)).type;if(n||(n=eD(t)),t.kind===P.a6.NamespaceStatement){if((0,d.cy)(t.statements))t.statements.forEach(e=>ek(e));else if(t.statements){let r=e(t.statements);n.namespaces.set(r.name,r)}}return n}(n);case P.a6.OperationStatement:return eO(n,r);case P.a6.NumericLiteral:return i=n,eF(tv(i));case P.a6.BooleanLiteral:return l=n,eF(tv(l));case P.a6.StringLiteral:return s=n,eF(tv(s));case P.a6.TupleExpression:return c=n,p=r,tm({kind:"Tuple",node:c,values:c.values.map(e=>ec(e,p))});case P.a6.StringTemplateExpression:return function(e,t){let n=!1,r=!1,a=e.spans.map(e=>[e,ek(e.expression,t)]);for(let[e,t]of a)null!==t&&((0,E.ml)(t)?r=!0:"kind"in t&&"TemplateParameter"===t.kind&&t.constraint?(t.constraint.valueType&&(r=!0),t.constraint.type&&(n=!0)):n=!0);if(n&&r)return ei((0,T.o)({code:"mixed-string-template",target:e})),null;if(r){let t=e.head.value;for(let[e,n]of a)null===n||"kind"in n&&"TemplateParameter"===n.kind||((0,m.a7)(null!==n&&(0,E.ml)(n),"Expected value."),t+=function(e){switch(e.valueKind){case"StringValue":case"NumericValue":case"BooleanValue":return e.value.toString();default:return ei((0,T.o)({code:"non-literal-string-template",target:e})),`[${e.valueKind}]`}}(n)),t+=e.literal.value;return e6(tP(t),void 0,e)}{let t=!1,n=e.head.value,r=[eQ(e.head)];for(let[e,l]of a){var o,i;(0,m.a7)(null!==l&&!(0,E.ml)(l),"Expected type.");let a="Indeterminate"===l.entityKind?l.type:l,s=(o=e.expression,i=a,ty({kind:"StringTemplateSpan",node:o,isInterpolated:!0,type:i}));r.push(s);let d=function(e){switch(e.kind){case"String":case"Number":case"Boolean":return String(e.value);case"StringTemplate":if(void 0!==e.stringValue)return e.stringValue;return;default:return}}(a);d?n+=d:t=!0,r.push(eQ(e.literal)),n+=e.literal.value}return eF(ty({kind:"StringTemplate",node:e,spans:r,stringValue:t?void 0:n}))}}(n,r);case P.a6.ArrayExpression:return eV(n,r);case P.a6.UnionExpression:return function(e,t){let n=tm({kind:"Union",node:e,get options(){return Array.from(this.variants.values()).map(e=>e.type)},expression:!0,variants:(0,d.nQ)(),decorators:[]});for(let r of e.options){let e=ec(r,t);if(e!==q){if("Union"===e.kind&&e.expression)for(let[t,r]of e.variants)n.variants.set(t,r);else{let t=ty({kind:"UnionVariant",type:e,name:Symbol("name"),decorators:[],node:void 0,union:n});n.variants.set(t.name,t)}}}return K(n,t),n}(n,r);case P.a6.IntersectionExpression:return function(e,t){let n=eR(e.symbol);if(n.declaredType&&void 0===t)return n.declaredType;let r=e.options.map(e=>[e,ec(e,t)]),a=function e(t,n,r,a){let o=(0,d.nQ)(),i=ty({kind:"Model",node:n,name:"",namespace:eK(n),properties:o,decorators:[],derivedModels:[],sourceModels:[]}),l=[],s=r.filter(e=>{let[t,n]=e;return"TemplateParameter"!==n.kind&&("Model"===n.kind||(ei((0,T.o)({code:"intersect-non-model",target:t})),!1))});for(let[e,t]of s)t.indexer&&("integer"===t.indexer.key.name?ei((0,T.o)({code:"intersect-invalid-index",messageId:"array",target:e})):l.push(t.indexer));for(let[e,r]of s)for(let e of(i.sourceModels.push({usage:"intersection",model:r}),V(r))){if(o.has(e.name)){ei((0,T.o)({code:"intersect-duplicate-property",format:{propName:e.name},target:n}));continue}let s=t&&tu(t,e.name),d={sourceProperty:e,model:i},u=s?tT(s,e,d):th(e,d);for(let t of(o.set(e.name,u),e8(n,u,a),l.filter(e=>e!==r.indexer)))eH(t,e,n)}return 1===l.length?i.indexer=l[0]:l.length>1&&(i.indexer={key:l[0].key,value:e(void 0,n,l.map(e=>[e.value.node,e.value]),a)}),K(i,a),tg(i)}(e.symbol,e,r,t);return ed(n,a,t),a}(n,r);case P.a6.DecoratorDeclarationStatement:return eN(n,r);case P.a6.FunctionDeclarationStatement:return function(e,t){let n=tk(e.symbol),r=eR(n);if(r.declaredType&&void 0===t)return r.declaredType;let a=eK(e);(0,m.a7)(a,`Decorator ${e.id.sv} should have resolved a namespace or found the global namespace.`);let o=e.id.sv;2&e.modifierFlags||ei((0,T.o)({code:"function-extern",target:e}));let i=n.value;void 0===i&&ei((0,T.o)({code:"missing-implementation",target:e}));let l=ty({kind:"Function",name:o,namespace:a,node:e,parameters:e.parameters.map(e=>ej(e,t,!0)),returnType:e.returnType?ec(e.returnType,t):J,implementation:i??(()=>{})});return a.functionDeclarations.set(o,l),ed(r,l,t),l}(n,r);case P.a6.TypeReference:return function(e,t,n=!0){let r=e$(e,t);return r?eM(r,e,t,n)??G:G}(n,r);case P.a6.TemplateArgument:return f=n,y=r,ek(f.argument,y);case P.a6.TemplateParameterDeclaration:return eS(n,r);case P.a6.ProjectionStatement:return function(e){let t;let n=eR(e.symbol);if(Z.has(e))return n.declaredType;switch(Z.add(e),ei((0,T.o)({code:"deprecated",format:{message:"Projection are deprecated and will be removed in next version"},target:e})),t=n.declaredType?n.declaredType:n.declaredType=ty({kind:"Projection",node:void 0,nodeByKind:new Map,nodeByType:new Map}),e.selector.kind){case P.a6.ProjectionModelSelector:W.get("Model").push(e),t.nodeByKind.set("Model",e);break;case P.a6.ProjectionModelPropertySelector:W.get("ModelProperty").push(e),t.nodeByKind.set("ModelProperty",e);break;case P.a6.ProjectionScalarSelector:W.get("Scalar").push(e),t.nodeByKind.set("Scalar",e);break;case P.a6.ProjectionOperationSelector:W.get("Operation").push(e),t.nodeByKind.set("Operation",e);break;case P.a6.ProjectionUnionSelector:W.get("Union").push(e),t.nodeByKind.set("Union",e);break;case P.a6.ProjectionUnionVariantSelector:W.get("UnionVariant").push(e),t.nodeByKind.set("UnionVariant",e);break;case P.a6.ProjectionInterfaceSelector:W.get("Interface").push(e),t.nodeByKind.set("Interface",e);break;case P.a6.ProjectionEnumSelector:W.get("Enum").push(e),t.nodeByKind.set("Enum",e);break;case P.a6.ProjectionEnumMemberSelector:W.get("EnumMember").push(e),t.nodeByKind.set("EnumMember",e);break;default:let r=ex(e.selector,void 0),a=Y.get(r);a||(a=[],Y.set(r,a)),a.push(e),t.nodeByType.set(r,e)}return t}(n);case P.a6.VoidKeyword:return X;case P.a6.NeverKeyword:return q;case P.a6.UnknownKeyword:return J;case P.a6.ObjectLiteral:return function(e,t,n){let r=function(e,t){let n=new Map,r=!1;for(let a of e.properties)if("id"in a){let e=ep(a.value,t);null===e?r=!0:n.set(a.id.sv,{name:a.id.sv,value:e,node:a})}else{let e=function(e,t){let n=ep(e,t);return null===n?null:"ObjectValue"!==n.valueKind?(ei((0,T.o)({code:"spread-object",target:e})),null):n}(a.target,t);if(e)for(let[t,r]of e.properties)n.set(t,{...r})}return r?null:n}(e,t);if(null===r)return null;let a=function(e,t){let n=ty({kind:"Model",name:"",node:e,properties:(0,d.nQ)(),decorators:[],derivedModels:[],sourceModels:[]});for(let e of t.values()){var r,a;n.properties.set(e.name,(r=e,a=n,tm({kind:"ModelProperty",node:r.node,model:a,optional:!1,name:r.name,type:r.value.type,decorators:[]})))}return tg(n)}(e,r);return n&&!tN(a,n,e)?null:eY({entityKind:"Value",valueKind:"ObjectValue",node:e,properties:r,type:n?n.type:a},a)}(n,r,o);case P.a6.ArrayLiteral:return function(e,t,n){var r,a;let o=!1,i=e.values.map(e=>{let n=ep(e,t);return null===n&&(o=!0),n});if(o)return null;let l=(r=e,a=i,tm({kind:"Tuple",node:r,values:a.map(e=>e.type)}));return n&&!tN(l,n,e)?null:eY({entityKind:"Value",valueKind:"ArrayValue",node:e,values:i,type:n?n.type:l},l)}(n,r,o);case P.a6.ConstStatement:return function(e){let t=eR(e.symbol);if(void 0!==t.value)return t.value;let n=e.type?ec(e.type,void 0):void 0;if(ee.has(e.symbol,a.Value))return ei((0,T.o)({code:"circular-const",format:{name:e.id.sv},target:e})),null;ee.start(e.symbol,a.Value);let r=ep(e.value,void 0,n&&{kind:"assignment",type:n});return(ee.finish(e.symbol,a.Value),null===r||n&&!tA(r,n,e.id))?t.value=null:t.value=n?eZ(r,{type:n}):eZ(r),t.value}(n);case P.a6.CallExpression:return function(e,t){let n=e1(e,t);return null===n?null:"ScalarConstructor"===n.kind?function(e,t,n){let r=!1,a=n.parameters.filter(e=>!e.optional&&!e.rest).length??0,o=n.parameters[n.parameters.length-1]?.rest?void 0:n.parameters.length;if(e.arguments.length<a||void 0!==o&&e.arguments.length>o){if(e.arguments.length<a&&(r=!0),void 0===o)ei((0,T.o)({code:"invalid-argument-count",messageId:"atLeast",format:{actual:e.arguments.length.toString(),expected:a.toString()},target:e}));else{let t=a===o?a.toString():`${a}-${o}`;ei((0,T.o)({code:"invalid-argument-count",format:{actual:e.arguments.length.toString(),expected:t},target:e}))}}let i=[];for(let[a,o]of n.parameters.entries()){if(o.rest){var l;let n=(l=o.type,"Model"===l.kind?l.indexer?.value:void 0);if(n)for(let o=a;o<e.arguments.length;o++){let a=e.arguments[o];if(a){let e=ep(a,t,{kind:"argument",type:n});if(null===e){r=!0;continue}tA(e,n,a)?i.push(e):r=!0}}break}let n=e.arguments[a];if(n){let e=ep(n,t,{kind:"argument",type:o.type});if(null===e){r=!0;continue}tA(e,o.type,n)?i.push(e):r=!0}}return r?null:{entityKind:"Value",valueKind:"ScalarValue",value:{name:n.name,args:i},scalar:n.scalar,type:n.scalar}}(e,t,n):ea.areScalarsRelated(n,es("string"))?e2(e,n,"StringValue"):ea.areScalarsRelated(n,es("numeric"))?e2(e,n,"NumericValue"):ea.areScalarsRelated(n,es("boolean"))?e2(e,n,"BooleanValue"):(ei((0,T.o)({code:"named-init-required",format:{typeKind:n.kind},target:e.target})),null)}(n,r);case P.a6.TypeOfExpression:return function(e,t){let n=ek(e.target,t,void 0);if(null===n)return G;if("Indeterminate"===n.entityKind)return n.type;if((0,E.Xj)(n)){if("TemplateParameter"===n.kind){if(void 0===n.constraint||void 0!==n.constraint.type)return ei((0,T.o)({code:"expect-value",messageId:"templateConstraint",format:{name:(0,b.Uz)(n)},target:e.target})),G;if(n.constraint.valueType)return n.constraint.valueType}return ei((0,T.o)({code:"expect-value",format:{name:(0,b.Uz)(n)},target:e.target})),n}return n.type}(n,r);case P.a6.AugmentDecoratorStatement:return function(n){e$(n.targetType,void 0);let r=t.getNodeLinks(n.targetType);if(r.isTemplateInstantiation)e.reportDiagnostic((0,T.o)({code:"augment-decorator-target",messageId:"noInstance",target:n.targetType}));else if(r.finalSymbol?.flags&&1048576&~r.finalSymbol.flags&&262144&~r.finalSymbol.flags)e.reportDiagnostic((0,T.o)({code:"augment-decorator-target",messageId:2&r.finalSymbol.flags?"noModelExpression":64&r.finalSymbol.flags?"noUnionExpression":"default",target:n.targetType}));else if(r.finalSymbol?.flags&&128&r.finalSymbol.flags){let t=(0,u.gG)(r.finalSymbol);e.reportDiagnostic((0,T.o)({code:"augment-decorator-target",messageId:t.value.kind===P.a6.UnionExpression?"noUnionExpression":"default",target:n.targetType}))}return G}(n);case P.a6.UsingStatement:return function(e){let t=e$(e.name,void 0);return t&&256&~t.flags&&ei((0,T.o)({code:"using-invalid-ref",target:e.name})),G}(n);default:return G}}function eb(e){return e.kind===P.a6.OperationStatement&&e.parent?.kind===P.a6.InterfaceStatement?tc(e):e.symbol}function eh(e){return"TypeSpec"===e.name&&(e.namespace===Q||e.namespace?.projectionBase===Q)}function eT(e){return!!(e.namespace&&eh(e.namespace))}function eS(e,t){let n=e.parent,r=n.parent,o=eR(e.symbol);if(en.has(e)||en.set(e,!1),ee.has(eb(e),a.Constraint))return void 0===t&&ei((0,T.o)({code:"circular-constraint",format:{typeName:e.id.sv},target:e.constraint})),G;let i=o.declaredType;if(void 0===i){r&&r.locals?.has(e.id.sv)&&ei((0,T.o)({code:"shadow",format:{name:e.id.sv},target:e}));let t=n.templateParameters.findIndex(t=>t===e);i=o.declaredType=tm({kind:"TemplateParameter",node:e}),e.constraint&&(ee.start(eb(e),a.Constraint),i.constraint=eU(e.constraint),ee.finish(eb(e),a.Constraint)),e.default&&(i.default=function(e,t,n,r){let a=function e(r){let a=ek(r),o=!1;if(null!==a&&"kind"in a&&"TemplateParameter"===a.kind){for(let e=n;e<t.length;e++)if(a.node.symbol===t[e].symbol){ei((0,T.o)({code:"invalid-template-default",target:r}));return}return a}return(0,x.LI)(r,t=>{let n=e(t);void 0===n&&(o=!0)}),o?void 0:a}(e)??G;return!("kind"in a&&(0,E.xg)(a))&&r&&tj(a,r,e),a}(e.default,n.templateParameters,t,i.constraint))}return t?t.getMappedType(i):i}function ex(e,t,n=!0){let r=e$(e,t);return r?function(e,t,n,r=!0){let a=eM(e,t,n,r);return null===a||(0,E.ml)(a)?(ei((0,T.o)({code:"value-in-type",target:t})),G):"Indeterminate"===a.entityKind?a.type:a}(r,e,t,n):G}function ew(t,n){let r=(0,f.LA)(e,t);r&&(0,f.BG)(e,n,r)}function eM(t,n,r,a=!0){let o=function(t,n,r,a=!0){let o;if(524288&t.flags)return ep(t.declarations[0],r);if(1024&t.flags)return ei((0,T.o)({code:"invalid-type-ref",messageId:"decorator",target:t})),G;if(8192&t.flags)return ei((0,T.o)({code:"invalid-type-ref",messageId:"function",target:t})),G;let i=n.kind===P.a6.TypeReference?n.arguments:[],l=eR(t);if(1048576&t.flags&&238&t.flags){let e=t.declarations[0];if(B(e)){let l=function(e,t,n){var r,a,o,i;let l=eR(e);return l.declaredType?l.declaredType:4194304&e.flags?((0,m.a7)(e.type,"Expected late bound symbol to have type"),e.type):262144&e.flags?eu(e,n):(r=e,a=t,o=n,i=eE(r,a,o),"Indeterminate"===i.entityKind?i.type:i)}(t,e,r),s=e.templateParameters,d=function(e,t,n,r){let a=new Map,o=[],i=new Map(n.map(e=>{let t=eS(e,void 0);return o.push(t),a.set(e.id.sv,t),[t,{decl:e,checkArgument:null}]})),l=!1;for(let[n,d]of t.map((e,t)=>[e,t])){function s(){return[n,ek(n.argument,r)]}if(n.name){l=!0;let e=a.get(n.name.sv);if(!e){ei((0,T.o)({code:"invalid-template-args",messageId:"unknownName",format:{name:n.name.sv},target:n}));continue}if(null!==i.get(e).checkArgument){ei((0,T.o)({code:"invalid-template-args",messageId:"specifiedAgain",format:{name:n.name.sv},target:n}));continue}i.get(e).checkArgument=s}else{if(l&&ei((0,T.o)({code:"invalid-template-args",messageId:"positionalAfterNamed",target:n})),d>=o.length){ei((0,T.o)({code:"invalid-template-args",messageId:"tooMany",target:e}));continue}let t=o[d];i.get(t).checkArgument??=s}}let d=[],u=[];for(let[t,{decl:n,checkArgument:a}]of[...i]){function c(e,t){i.set(e,t),d.push(e),u.push(t)}if(null===a){let a=j(d,u,{node:e,mapper:r}),o=void 0===t.default?void 0:(0,E.Xj)(t.default)&&(0,E.xg)(t.default)||null===t.default?t.default:ek(n.default,a);o?c(t,o):(ei((0,T.o)({code:"invalid-template-args",messageId:"missing",format:{name:n.id.sv},target:e})),c(t,t.constraint?.type??J));continue}let[o,l]=a();if(null===l){c(t,J);continue}if(t.constraint){let e=t.constraint.type?.kind==="TemplateParameter"?i.get(t.constraint.type):t.constraint;if((0,E.Xj)(l)&&ey(l,t.constraint)&&em(l,{kind:"argument",type:t.constraint.valueType},o)!==l){c(t,l);continue}if(t.constraint&&!tt(l,e,o)){let e=t.constraint.type??J;c(t,e);continue}}else if((0,E.xg)(l)){c(t,J);continue}else if((0,E.ml)(l)){ei((0,T.o)({code:"value-in-type",messageId:"noTemplateConstraint",target:o})),c(t,J);continue}c(t,l)}return i}(n,i,s,r);o=eP(e,[...d.keys()],[...d.values()],{node:n,mapper:r},l.templateMapper,a)}else{if(i.length>0&&ei((0,T.o)({code:"invalid-template-args",messageId:"notTemplate",target:n})),4194304&t.flags)return(0,m.a7)(t.type,"Expected late bound symbol to have type"),t.type;o=l.declaredType?l.declaredType:262144&t.flags?eu(t,r):eE(t,e,r)}}else{let e=(0,u.gG)(t);if(i.length>0&&ei((0,T.o)({code:"invalid-template-args",messageId:"notTemplate",target:n})),4194304&t.flags)return(0,m.a7)(t.type,"Expected late bound symbol to have type"),t.type;2048&t.flags?o=eS(e,r):l.type?o=l.type:l.declaredType?o=l.declaredType:262144&t.flags?o=eu(t,r):l.type=o=ec(e,r)}let s=(0,u.gG)(t);return(s&&void 0===r&&(0,E.Xj)(o)&&!function e(t){function n(e){return z.has(e)||z.set(e,(e.directives??[]).findIndex(e=>"deprecated"===e.target.sv)>=0),z.get(e)}switch(t.kind){case P.a6.ModelStatement:return n(t);case P.a6.OperationStatement:return n(t)||t.parent.kind===P.a6.InterfaceStatement&&e(t.parent);case P.a6.InterfaceStatement:return n(t);case P.a6.IntersectionExpression:case P.a6.UnionExpression:case P.a6.ModelProperty:case P.a6.OperationSignatureDeclaration:case P.a6.OperationSignatureReference:return e(t.parent);default:return!1}}(n.parent)&&function(t,n,r){if(n){let t=(0,f.LA)(e,n);if(t){R(e,r,t.message,ei);return}}let a=(0,f.LA)(e,t);a&&R(e,r,a.message,ei)}(o,s,n),(0,E.Xj)(o)&&("EnumMember"===o.kind||"UnionVariant"===o.kind)||(0,E.Cm)(o))?eF(o):o}(t,n,r,a);return null!==o&&(0,E.Xj)(o)&&"TemplateParameter"===o.kind&&en.set(o.node,!0),o}function eE(e,t,n){return 2&e.flags?eX(t,n):4&e.flags?ta(t,n):128&e.flags?ti(t,n):32&e.flags?tl(t,n):8&e.flags?eO(t,n):ts(t,n)}function eP(e,t,n,r,a,o=!0){let i=e.kind===P.a6.OperationStatement&&e.parent.kind===P.a6.InterfaceStatement?tp(e):eR(e.symbol);if((0,m.a7)(i,`Unexpected checker error. symbolLinks was not defined for ${P.a6[e.kind]}`),void 0===i.instantiations){let t=ec(e);if((0,E.xg)(t))return G;(0,m.a7)(!1,`Unexpected checker error. symbolLinks.instantiations was not defined for ${P.a6[e.kind]}`)}let l=j(t,n,r,a),s=i.instantiations?.get(l.args);return s||(o?function(e,t,n,r){let a=ec(t,r);return e.get(r.args)||e.set(r.args,a),"Model"===a.kind&&(a.templateNode=t),a}(i.instantiations,e,0,l):G)}function eI(e,t){let n=(0,d.nQ)(),r=tm({kind:"Union",node:e,options:t,decorators:[],variants:n,expression:!0});for(let e of t){let t=Symbol("indexer-union-variant");n.set(t,tm({kind:"UnionVariant",node:void 0,type:e,name:t,union:r,decorators:[]}))}return r}function eN(e,t){let n=tk(e.symbol),r=eR(n);if(r.declaredType&&void 0===t)return r.declaredType;let a=eK(e);(0,m.a7)(a,`Decorator ${e.id.sv} should have resolved a namespace or found the global namespace.`);let o=e.id.sv;2&e.modifierFlags||ei((0,T.o)({code:"decorator-extern",target:e}));let i=n.value;void 0===i&&ei((0,T.o)({code:"missing-implementation",target:e}));let l=ty({kind:"Decorator",name:`@${o}`,namespace:a,node:e,target:ej(e.target,t,!0),parameters:e.parameters.map(e=>ej(e,t,!0)),implementation:i??(()=>{})});return a.decoratorDeclarations.set(o,l),ed(r,l,t),l}function ej(e,t,n){let r;let a=eR(e.symbol);if(a.declaredType)return a.declaredType;e.rest&&e.type&&e.type.kind!==P.a6.ArrayExpression&&(e.type.kind!==P.a6.ValueOfExpression||e.type.target.kind!==P.a6.ArrayExpression)&&ei((0,T.o)({code:"rest-parameter-array",target:e.type}));let o={kind:"FunctionParameter",node:e,name:e.id.sv,optional:e.optional,rest:e.rest,implementation:e.symbol.value};if(n){let t=e.type?eU(e.type):{entityKind:"MixedParameterConstraint",type:J};r=ty({...o,type:t,mixed:!0,implementation:e.symbol.value})}else r=ty({...o,mixed:!1,type:e.type?ec(e.type):J,implementation:e.symbol.value});return ed(a,r,t),r}function eA(e,t){if(e.kind===P.a6.ValueOfExpression){let n=ec(e.target,t);return["value",n]}return["type",ec(e,t)]}function eU(e,t){if(e.kind===P.a6.UnionExpression)return function(e,t){let n=[],r=[];for(let a of e.options){let[e,o]=eA(a,t);"value"===e?n.push(o):r.push(o)}return{entityKind:"MixedParameterConstraint",node:e,valueType:0===n.length?void 0:1===n.length?n[0]:eI(e,n),type:0===r.length?void 0:1===r.length?r[0]:eI(e,r)}}(e,t);{let[n,r]=eA(e,t);return{entityKind:"MixedParameterConstraint",node:e,type:"value"===n?void 0:r,valueType:"value"===n?r:void 0}}}function eV(e,t){let n=ec(e.elementType,t),r=es("Array").node,a=ec(r.templateParameters[0]);return eP(r,[a],[n],{node:e,mapper:t},void 0)}function eD(e){(0,m.a7)(e.symbol,"Namespace is unbound.",e);let t=tk(e.symbol),n=eR(t);if(!n.type){let r=eK(e),a=e.id.sv,o=ty({kind:"Namespace",name:a,namespace:r,node:e,models:new Map,scalars:new Map,operations:new Map,namespaces:new Map,interfaces:new Map,unions:new Map,enums:new Map,decoratorDeclarations:new Map,functionDeclarations:new Map,decorators:[]});for(let e of(n.type=o,t.declarations))e.kind===P.a6.NamespaceStatement&&(o.decorators=o.decorators.concat(tr(o,e,void 0)));tg(o),r?.namespaces.set(a,o)}return n.type}function eK(e){if(e===Q.node)return;if(e.kind===P.a6.ModelExpression||e.kind===P.a6.IntersectionExpression){let t=e.parent;for(;void 0!==t;){if(t.kind===P.a6.AliasStatement||t.kind===P.a6.ModelStatement||t.kind===P.a6.ScalarStatement||t.kind===P.a6.OperationStatement||t.kind===P.a6.EnumStatement||t.kind===P.a6.InterfaceStatement||t.kind===P.a6.UnionStatement||t.kind===P.a6.ModelExpression||t.kind===P.a6.IntersectionExpression)return eK(t);t=t.parent}return}if(e.kind===P.a6.OperationStatement&&e.parent&&e.parent.kind===P.a6.InterfaceStatement)return eK(e.parent);if(!e.symbol.parent||e.symbol.parent.declarations[0].kind===P.a6.TypeSpecScript||e.symbol.parent.declarations[0].kind===P.a6.JsSourceFile)return Q;let t=tk(e.symbol.parent),n=eR(t);if(!n.type){let r=t.declarations.find(e=>e.kind===P.a6.NamespaceStatement||e.kind===P.a6.JsNamespaceDeclaration);(0,m.a7)(r,"Can't find namespace declaration node.",e),n.type=eD(r)}return n.type}function eO(e,n,r){let o,i,l;let s=e.parent?.kind===P.a6.InterfaceStatement,u=s?tc(e):e.symbol,c=u&&eR(u);if(c&&c.declaredType&&void 0===n)return c.declaredType;void 0===n&&s&&(0,m.a7)(r,"Operation in interface should already have been checked.",e.parent),eG(e,n),B(e)&&void 0!==n&&r&&(n={...n,partial:!0});let p=eK(e),f=e.id.sv,y=[],{resolvedSymbol:g}=t.resolveMetaMemberByName(u,"parameters");if(g?.members){let n=t.getAugmentedSymbolTable(g.members),r=function(e){if(void 0===e.docs)return new Map;let t=new Map;for(let n of e.docs)for(let e of n.tags)e.kind===P.a6.DocParamTag&&t.set(e.paramName.sv,O(e.content));return t}(e);for(let[e,t]of n){let n=r.get(e);n&&I.set(t,n)}}if(e.signature.kind===P.a6.OperationSignatureReference){let r=function(e,n,r){if(!n)return;let o=eb(e);o&&ee.start(o,a.BaseType);let i=t.getNodeLinks(n).resolvedSymbol;if(i&&ee.has(i,a.BaseType)){void 0===r&&ei((0,T.o)({code:"circular-op-signature",format:{typeName:i.name},target:n}));return}let l=ec(n,r);if(o&&ee.finish(o,a.BaseType),!(0,E.xg)(l)){if("Operation"!==l.kind){ei((0,T.o)({code:"is-operation",target:n}));return}return l}}(e,e.signature.baseOperation,n);if(r){l=r;let e=tb(r.parameters,{properties:(0,d.nQ)()});e.properties=(0,d.nQ)(Array.from(r.parameters.properties.entries()).map(([t,n])=>[t,tT(tu(g,n.name),n,{model:e,sourceProperty:n})])),o=tg(e),i=r.returnType,y=[...r.decorators]}else o=tm({kind:"Model",name:"",decorators:[],properties:(0,d.nQ)(),derivedModels:[],sourceModels:[]}),i=X}else o=ec(e.signature.parameters,n),i=ec(e.signature.returnType,n);let v=ty({kind:"Operation",name:f,namespace:p,node:e,parameters:o,returnType:i,decorators:y,sourceOperation:l,interface:r});c&&ed(c,v,n),y.push(...tr(v,e,n)),v.parameters.namespace=p;let k=e.parent;return K(v,n),k.kind===P.a6.InterfaceStatement?eq(k,n)&&eq(e,n)&&tg(v):(eq(e,n)&&tg(v),void 0===n&&p?.operations.set(f,v)),v}function eC(){return t.symbols.global.declarations[0]}function eR(e){return t.getSymbolLinks(e)}function eB(e,t){let n=e.parent,r=e$(n,t,!1);return!r&&(0,x.qq)(n)&&void 0!==n.target&&(r=e$(n.target,t,!1)),r?.declarations.filter(e=>B(e))??[]}function eL(t){let n,r;let a=e=>e?.kind===P.a6.ArrayLiteral||e?.kind===P.a6.ObjectLiteral,o=e=>e?.kind===P.a6.ModelExpression||e?.kind===P.a6.TupleExpression,i=e=>a(e)||o(e),l=[],s=(0,x._$)(t,e=>((function(e,t,n){if(e.kind===P.a6.ArrayLiteral||e.kind===P.a6.TupleExpression){let r=e.values.findIndex(e=>e===t);r>=0?n.unshift({tupleIndex:r}):(0,m.a7)(!1,"not expected, can't find child from the parent?")}(e.kind===P.a6.ModelProperty||e.kind===P.a6.ObjectLiteralProperty)&&n.unshift({propertyName:e.id.sv})})(e,n,l),n=e,i(e)&&(e.parent?.kind===P.a6.TemplateParameterDeclaration||e.parent?.kind===P.a6.TemplateArgument||e.parent?.kind===P.a6.DecoratorExpression)||a(e)&&(e.parent?.kind===P.a6.CallExpression||e.parent?.kind===P.a6.ConstStatement)));switch(s?.parent?.kind){case P.a6.TemplateParameterDeclaration:case P.a6.TemplateArgument:r=function(t){let n,r;if(t?.parent?.kind===P.a6.TemplateArgument&&t?.parent?.parent?.kind===P.a6.TypeReference){let e=t.parent,n=t.parent.parent,a=eB(e,void 0),o=n.arguments.findIndex(t=>t===e);a.length>0&&a[0].templateParameters.length>o&&(r=a[0].templateParameters[o])}else t.parent?.kind===P.a6.TemplateParameterDeclaration&&(r=t?.parent);if(r?.kind===P.a6.TemplateParameterDeclaration&&r.constraint)return a(t)&&r.constraint.kind===P.a6.ValueOfExpression?n=e.checker.getTypeForNode(r.constraint.target):o(t)&&r.constraint.kind!==P.a6.ValueOfExpression&&(n=e.checker.getTypeForNode(r.constraint)),n}(s);break;case P.a6.DecoratorExpression:r=function(t){let n;let r=t?.parent;if(r?.kind!==P.a6.DecoratorExpression)return;let i=e.checker.resolveRelatedSymbols(r.target.kind===P.a6.MemberExpression?r.target.id:r.target);if(!i||i.length<=0)return;let l=i[0].declarations.find(e=>e.kind===P.a6.DecoratorDeclarationStatement);if(!l)return;let s=e.checker.getTypeForNode(l);(0,m.a7)("Decorator"===s.kind,"Expected type to be a Decorator.");let d=r.arguments.findIndex(e=>e===t);if(d<0||d>=s.parameters.length)return;let u=s.parameters[d];return a(t)?n=u.type.valueType:o(t)?n=u.type.type??u.type.valueType:(0,m.a7)(!1,"not expected node type to get reference model from decorator argument"),n}(s);break;case P.a6.CallExpression:r=function(e){let t=e?.parent;if(t?.kind!==P.a6.CallExpression)return;let n=e1(t,void 0);if(n?.kind!=="ScalarConstructor")return;let r=t.arguments.findIndex(t=>t===e);if(!(r<0)&&!(r>=n.parameters.length))return n.parameters[r].type}(s);break;case P.a6.ConstStatement:r=function(t){let n=t?.parent;if(n&&n.kind===P.a6.ConstStatement&&n.type&&n.value===t)return e.checker.getTypeForNode(n.type)}(s)}return function e(t,n){let r=t;if(r&&"Model"!==r.kind&&"Tuple"!==r.kind&&"Union"!==r.kind)return[];if(0===n.length)switch(r?.kind){case"Model":return[r];case"Union":let a=[];for(let t of r.variants.values())("Model"===t.type.kind||"Tuple"===t.type.kind||"Union"===t.type.kind)&&a.push(...e(t.type,n)??[]);return a;default:return[]}let o=n[0];switch(r?.kind){case"Tuple":if(void 0!==o.tupleIndex&&o.tupleIndex>=0&&o.tupleIndex<r.values.length)return e(r.values[o.tupleIndex],n.slice(1));return[];case"Model":if("Array"===r.name&&void 0!==o.tupleIndex)r=r.templateMapper?.args[0];else{if("Array"===r.name||!o.propertyName)return[];r=r.properties.get(o.propertyName)?.type}return e(r,n.slice(1));case"Union":let i=[];for(let t of r.variants.values())("Model"===t.type.kind||"Tuple"===t.type.kind||"Union"===t.type.kind)&&i.push(...e(t.type,n)??[]);return i;default:return[]}}(r,l)}function e$(n,r,a){let o="boolean"==typeof a?{...F,resolveDecorators:a}:{...F,...a??{}};if(void 0===r&&o.checkTemplateTypes&&N.has(n))return N.get(n);let i=function(n,r,a){if(!(0,x.qq)(n)){if(n.kind===P.a6.TypeReference)return e$(n.target,r,a);if(n.kind===P.a6.Identifier){let o=t.getNodeLinks(n);void 0===r&&o.resolutionResult&&(void 0===r&&o.resolutionResult&(P.lS.NotFound|P.lS.Unknown)?ei((0,T.o)({code:"invalid-ref",messageId:a.resolveDecorators?"decorator":"identifier",format:{id:function e(t){switch(t.kind){case P.a6.MemberExpression:return`${e(t.base)}.${e(t.id)}`;case P.a6.TypeReference:return e(t.target);case P.a6.Identifier:return t.sv}}(n)},target:n,codefixes:function(e){if("number"===e.sv)return[(0,c.o)(e,"float64")]}(n)})):o.resolutionResult&P.lS.Ambiguous&&function(t,n){let r=n.map(e=>(0,E.eN)(e,{useGlobalPrefixAtTopLevel:!0}));e.reportDiagnostic((0,T.o)({code:"ambiguous-symbol",format:{name:t.sv,duplicateNames:r.join(", ")},target:t}))}(n,o.ambiguousSymbols));let i=o.resolvedSymbol;return i?.symbolSource??i}if(n.kind===P.a6.MemberExpression){let e=e$(n.base,r,{...a,resolveDecorators:!1});if(!e)return;if(128&e.flags){let t=e_(e,r);if(!t){ei((0,T.o)({code:"invalid-ref",messageId:"node",format:{id:n.id.sv,nodeName:e.declarations[0]?P.a6[e.declarations[0].kind]:"Unknown node"},target:n}));return}e=t}return function(e,n,r){let{finalSymbol:a,resolvedSymbol:o}=t.resolveMemberExpressionForSym(e,n,r),i=o??a;if(i)return i;if(256&e.flags)ei((0,T.o)({code:"invalid-ref",messageId:"underNamespace",format:{namespace:(0,E.eN)(e),id:n.id.sv},target:n}));else if(1024&e.flags)ei((0,T.o)({code:"invalid-ref",messageId:"inDecorator",format:{id:n.id.sv},target:n}));else if(8192&e.flags)ei((0,T.o)({code:"invalid-ref",messageId:"node",format:{id:n.id.sv,nodeName:"function"},target:n}));else if(118&e.flags)ei((0,T.o)({code:"invalid-ref",messageId:"."===n.selector?"member":"metaProperty",format:{kind:function(e){switch(e.kind){case P.a6.ModelStatement:case P.a6.ModelExpression:return"Model";case P.a6.ModelProperty:return"ModelProperty";case P.a6.EnumStatement:return"Enum";case P.a6.InterfaceStatement:return"Interface";case P.a6.UnionStatement:return"Union";default:return"Type"}}((0,u.gG)(e)),id:n.id.sv},target:n}));else{let t=(0,u.gG)(e);ei((0,T.o)({code:"invalid-ref",messageId:"node",format:{id:n.id.sv,nodeName:t?P.a6[t.kind]:"Unknown node"},target:n}))}}(e,n,a)}(0,m.a7)(!1,`Unknown type reference kind "${P.a6[n.kind]}"`,n)}}(n,r,o);return o.checkTemplateTypes&&N.set(n,i),i}function e_(e,n){let r=(0,u.gG)(e),a=t.getSymbolLinks(e);if(!a.aliasResolutionIsTemplate)return a.aliasedSymbol??t.getNodeLinks(r).resolvedSymbol;let o=ec(r,n);if(!(0,E.xg)(o))switch(o.kind){case"Model":case"Interface":case"Union":if((0,E.w7)(o))return e7(o),o.symbol;default:return tk(o.node.symbol)??e}}function eF(e){let t=i.get(e);if(t)return t;let n={entityKind:"Indeterminate",type:e};return i.set(e,n),n}function eQ(e){return ty({kind:"StringTemplateSpan",node:e,isInterpolated:!1,type:tv(e)})}function ez(e){for(let t of e.statements)ek(t,void 0)}function eG(e,t){if(void 0===t)for(let t of e.templateParameters)eS(t,void 0)}function eX(n,r){let i=eR(n.symbol);if(i.declaredType&&void 0===r)return i.declaredType;eG(n,r);let s=[],u=ty({kind:"Model",name:n.id.sv,node:n,properties:(0,d.nQ)(),namespace:eK(n),decorators:s,sourceModels:[],derivedModels:[]});if(ed(i,u,r),n.symbol.members){let e=t.getAugmentedSymbolTable(n.symbol.members),r=function(e){if(void 0===e.docs)return new Map;let t=new Map;for(let n of e.docs)for(let e of n.tags)e.kind===P.a6.DocPropTag&&t.set(e.propName.sv,O(e.content));return t}(n);for(let[t,n]of e){let e=r.get(t);e&&I.set(n,e)}}let c=function(e,n,r){let o;if(!n)return;let i=eb(e);if(ee.start(i,a.BaseType),n.kind===P.a6.ModelExpression){ei((0,T.o)({code:"is-model",messageId:"modelExpression",target:n}));return}if(n.kind===P.a6.ArrayExpression)o=eV(n,r);else if(n.kind===P.a6.TypeReference){let e=t.getNodeLinks(n).resolvedSymbol;if(e&&ee.has(e,a.BaseType)){void 0===r&&ei((0,T.o)({code:"circular-base-type",format:{typeName:e.name},target:e}));return}o=ec(n,r)}else{ei((0,T.o)({code:"is-model",target:n}));return}if(ee.finish(i,a.BaseType),"Model"!==o.kind){ei((0,T.o)({code:"is-model",target:n}));return}if(""===o.name){ei((0,T.o)({code:"is-model",messageId:"modelExpression",target:n}));return}return o}(n,n.is,r);if(c&&(u.sourceModel=c,u.sourceModels.push({usage:"is",model:c}),s.push(...c.decorators),c.indexer&&(u.indexer=c.indexer)),c)for(let e of c.properties.values()){let t=tu(n.symbol,e.name),a=tT(t,e,{sourceProperty:e,model:u});e8(n,a,r),u.properties.set(e.name,a)}c?u.baseModel=c.baseModel:n.extends&&(u.baseModel=function(n,r,o){if(r.kind===P.a6.ModelExpression){ei((0,T.o)({code:"extend-model",messageId:"modelExpression",target:r}));return}if(r.kind!==P.a6.TypeReference){ei((0,T.o)({code:"extend-model",target:r}));return}let i=eb(n);ee.start(i,a.BaseType);let l=t.getNodeLinks(r).resolvedSymbol;if(l&&ee.has(l,a.BaseType)){void 0===o&&ei((0,T.o)({code:"circular-base-type",format:{typeName:l.name},target:l}));return}let s=ec(r,o);if(ee.finish(i,a.BaseType),(0,E.xg)(s)){(0,m.a7)(e.hasError(),"Should already have reported an error.",r);return}if("Model"!==s.kind){ei((0,T.o)({code:"extend-model",target:r}));return}return""===s.name&&ei((0,T.o)({code:"extend-model",messageId:"modelExpression",target:r})),s}(n,n.extends,r),u.baseModel&&ew(u.baseModel,u)),u.baseModel&&u.baseModel.derivedModels.push(u),void 0===r&&u.namespace?.models.set(u.name,u),eW(n,u.properties,u,r),s.push(...tr(u,n,r)),K(u,r),eq(n,r)&&tg(u);let p=(0,l.CT)(e,u);return"Array"===u.name&&eT(u)?o.Array=u:"Record"===u.name&&eT(u)&&(o.Record=u),p&&(u.indexer=p),e7(u),e3(u),u}function eq(e,t){return 0===e.templateParameters.length||void 0!==t&&!t.partial&&t.args.every(e=>(0,E.ml)(e)||"Indeterminate"===e.entityKind||"TemplateParameter"!==e.kind)}function eJ(e,t,n){let r=function(e){let t=e;for(;t;){if(t.indexer)return t.indexer;t=t.baseModel}}(e);if(void 0!==r)return eH(r,t,n)}function eH(e,t,n){if("integer"===e.key.name){el([(0,T.o)({code:"no-array-properties",target:n})]);return}let[r,a]=ea.isTypeAssignableTo(t.type,e.value,n);r||ei((0,T.o)({code:"incompatible-indexer",format:{message:a.map(e=>`  ${e.message}`).join("\n")},target:n.kind===P.a6.ModelProperty?n.value:n}))}function eW(t,n,r,a){let o;for(let i of t.properties)if("id"in i){let e=e5(i,a);e.model=r,eJ(r,e,i),e4(n,e)}else{let[l,s]=function(t,n,r,a){let o=ec(n,a);if("TemplateParameter"===o.kind||(0,E.xg)(o))return[[],void 0];if("Model"!==o.kind||(0,E.x3)(e,o))return ei((0,T.o)({code:"spread-model",target:n}),a),[[],void 0];r===o&&ei((0,T.o)({code:"spread-model",messageId:"selfSpread",target:n})),r.sourceModels.push({usage:"spread",model:o});let i=[];for(let e of V(o)){let n=tu(t,e.name);i.push(tT(n,e,{sourceProperty:e,model:r}))}return[i,o.indexer]}(t.symbol,i.target,r,a);for(let e of(s&&(o?o.push(s):o=[s]),l))e8(t,e,a),eJ(r,e,i),e4(n,e,i)}if(o){let e=1===o.length?o[0].value:function(e){let t=(0,d.nQ)(),n=tm({kind:"Union",node:void 0,options:e,decorators:[],variants:t,expression:!0});for(let r of e){let e=Symbol("indexer-union-variant");t.set(e,tm({kind:"UnionVariant",node:void 0,type:r,name:e,union:n,decorators:[]}))}return n}(o.map(e=>e.value));r.indexer={key:o[0].key,value:e}}}function eY(e,t){return A.set(e,t),e}function eZ(e,t){let n={...e,...t},r=A.get(e);return r&&A.set(n,r),n}function e0(e,t){if(void 0!==e)switch(e.kind){case"Scalar":if((0,m.r$)(er.isTypeAssignableTo(t,e,t)))return e;return;case"Union":let n;for(let r of e.variants.values()){let e=e0(r.type,t);if(e){if(n){ei((0,T.o)({code:"ambiguous-scalar-type",format:{value:(0,b.Uz)(t),types:[n,e].map(e=>e.name).join(", "),example:n.name},target:t}));return}n=e}}return n;default:return}}function e6(e,t,n){let r;if(t&&!tN(e,t,n))return null;if("StringTemplate"===e.kind){if(!e.stringValue)return el((0,v.DK)(e)),null;r=e.stringValue}else r=e.value;let a=e0(t?.type,e);return eY({entityKind:"Value",valueKind:"StringValue",value:r,type:t?t.type:e,scalar:a},e)}function e1(e,t){let n=ex(e.target,t);return"Scalar"===n.kind||"ScalarConstructor"===n.kind?n:(ei((0,T.o)({code:"non-callable",format:{type:n.kind},target:e.target})),null)}function e2(e,t,n){if(1!==e.arguments.length)return ei((0,T.o)({code:"invalid-primitive-init",target:e.target})),null;let r=e.arguments[0],a=ep(r,void 0);return null===a?null:a.valueKind!==n?(ei((0,T.o)({code:"invalid-primitive-init",messageId:"invalidArg",format:{actual:a.valueKind,expected:n},target:r})),null):tA(a,t,r)?eZ(a,{scalar:t,type:t}):null}function e4(e,t,n){if(e.has(t.name)){ei((0,T.o)({code:"duplicate-property",format:{propName:t.name},target:n??t}));return}let r=function(e){(0,m.a7)(e.model,"Parent model must be set before overridden property can be found.");for(let t=e.model.baseModel;t;t=t.baseModel){let n=t.properties.get(e.name);if(n)return n}}(t);if(r){let[e,a]=ea.isTypeAssignableTo(t.type,r.type,t),o=(0,b.Uz)(r.type),i=(0,b.Uz)(t.type),l=!1;if(e||(ei((0,T.o)({code:"override-property-mismatch",format:{propName:t.name,propType:i,parentType:o},target:n??t})),l=!0),!r.optional&&t.optional&&(ei((0,T.o)({code:"override-property-mismatch",messageId:"disallowedOptionalOverride",format:{propName:r.name},target:n??t})),l=!0),l)return}e.set(t.name,t)}function e7(e){if(!e.symbol)switch(e.kind){case"Model":e.symbol=(0,u.v5)(e.node,e.name,4194306),(0,d.Tk)(e.symbol).type=e;break;case"Interface":e.symbol=(0,u.v5)(e.node,e.name,4194336),(0,E.w7)(e)&&"Foo"===e.name&&eR(e.symbol),(0,d.Tk)(e.symbol).type=e;break;case"Union":if(!e.name)return;e.symbol=(0,u.v5)(e.node,e.name,4194368),(0,d.Tk)(e.symbol).type=e}}function e3(e){(0,m.a7)(e.symbol,"Type must have a symbol to late bind members");let n=e.symbol;(0,m.a7)(n.members,"Container symbol didn't have members at late-bind");let r=t.getAugmentedSymbolTable(n.members);switch(e.kind){case"Model":for(let t of V(e))a(t,1310720);break;case"Scalar":for(let t of e.constructors.values())a(t,1310720);break;case"Enum":for(let t of e.members.values())a(t,1310720);break;case"Interface":for(let t of e.operations.values())a(t,1310728);break;case"Union":for(let t of e.variants.values())a(t,1310720)}function a(e,t){if(!e.node||"string"!=typeof e.name)return;let a=(0,u.v5)(e.node,e.name,4194304|t,n);(0,d.Tk)(a).type=e,(0,m.a7)(n.members,"containerSym.members is undefined"),r.set(e.name,a)}}function e8(e,n,r){if(void 0!==r||((0,m.a7)("string"==typeof n.name,"Cannot link unmapped unions"),void 0===e.symbol))return;let a=tu(e.symbol,n.name);if(a){var o;o=t.getSymbolLinks(a),void 0===r&&(o.declaredType=n)}}function e5(e,t){let n=tc(e),r=tp(e);if(r&&r.declaredType&&void 0===t)return r.declaredType;let o=e.id.sv,i=ty({kind:"ModelProperty",name:o,node:e,optional:e.optional,type:void 0,decorators:[]});if(ee.has(n,a.Type)&&void 0===t)ei((0,T.o)({code:"circular-prop",format:{propName:o},target:e})),i.type=G;else{if(ee.start(n,a.Type),i.type=ec(e.value,t),e.default){let t=function(e,t){if((0,E.xg)(t))return null;let n=ep(e,void 0,{kind:"assignment",type:t},{legacyTupleAndModelCast:!0});if(null===n)return null;let[r,a]=ea.isValueOfType(n,t,e);return r?{...n,type:t}:(el(a),null)}(e.default,i.type);null!==t&&(i.defaultValue=t,i.default=function(e){let t=ek(e,void 0);return null===t||(0,E.ml)(t)?void 0:"Indeterminate"===t.entityKind?t.type:t}(e.default))}r&&ed(r,i,t)}i.decorators=tr(i,e,t);let l=(0,E.hO)(e);if(K(i,t),!l||eq(l,t)){let e=I.get(n);e&&i.decorators.unshift(e9("self",e)),tg(i)}return ee.finish(n,a.Type),i}function e9(e,t){return{decorator:l.DY,args:[{value:tP(e),jsValue:e},{value:tP(t),jsValue:t}]}}function te(t,n,r){let a=e$(n.target,void 0,!0);if(!a)return;if(!(1024&a.flags)){ei((0,T.o)({code:"invalid-decorator",format:{id:a.name},target:n}));return}let o=eR(a),i=!1;if(void 0===o.declaredType){let e=a.declarations.find(e=>e.kind===P.a6.DecoratorDeclarationStatement);e&&eN(e,void 0)}o.declaredType&&((0,m.a7)("Decorator"===o.declaredType.kind,`Expected to find a decorator type but got ${o.declaredType.kind}`),!function(e,t,n){let[r]=ea.isTypeAssignableTo(e,t.target.type,n);return r||ei((0,T.o)({code:"decorator-wrong-target",messageId:"withExpected",format:{decorator:t.name,to:(0,b.Uz)(e),expected:(0,b.He)(t.target.type)},target:n})),r}(t,o.declaredType,n)&&(i=!0));let[l,s]=function(t,n,r){if(void 0===r)return[!1,t.arguments.map(e=>{let t=ek(e,n)??G;return"Indeterminate"===t.entityKind&&(t=t.type),{value:t,jsValue:t,node:e}})];let a=!1,o=r.parameters.filter(e=>!e.optional&&!e.rest).length??0,i=r.parameters[r.parameters.length-1]?.rest?void 0:r.parameters.length;if(t.arguments.length<o||void 0!==i&&t.arguments.length>i){if(t.arguments.length<o&&(a=!0),void 0===i)ei((0,T.o)({code:"invalid-argument-count",messageId:"atLeast",format:{actual:t.arguments.length.toString(),expected:o.toString()},target:t}));else{let e=o===i?o.toString():`${o}-${i}`;ei((0,T.o)({code:"invalid-argument-count",format:{actual:t.arguments.length.toString(),expected:e},target:t}))}}let l=[],s=function(t){if(t){let n=(0,g.X)(e,t);if("compiler"===n.type);else if(("library"===n.type||"project"===n.type)&&n.flags?.decoratorArgMarshalling)return n.flags.decoratorArgMarshalling}return"new"}(r);function d(e,t){var r,a,o;let i=eg(e,n,{kind:"argument",constraint:t});return null!==i&&!((0,E.Xj)(i)&&(0,E.xg)(i))&&tt(i,t,e)?{value:i,node:e,jsValue:(r=i,a=ev({kind:"argument",constraint:t}),o=s,void 0!==a&&(0,E.ml)(r)?"legacy"===o?(0,h.i8)(er,r):(0,h.JM)(r,a.type):r)}:void 0}for(let[n,o]of r.parameters.entries()){if(o.rest){let r=function(t){let n,r;if(t.valueType){if(!("Model"===t.valueType.kind&&(0,E.x3)(e,t.valueType)))return;n=t.valueType.indexer.value}if(t.type){if(!("Model"===t.type.kind&&(0,E.x3)(e,t.type)))return;r=t.type.indexer.value}return{entityKind:"MixedParameterConstraint",type:r,valueType:n}}(o.type);if(r)for(let e=n;e<t.arguments.length;e++){let n=t.arguments[e];if(n){let e=d(n,r);e?l.push(e):a=!0}}break}let r=t.arguments[n];if(r){let e=d(r,o.type);e?l.push(e):a=!0}}return[a,l]}(n,r,o.declaredType);if(!i&&!l)return{definition:o.declaredType,decorator:a.value??((...e)=>{}),node:n,args:s}}function tt(e,t,n){let[r]=ea.isTypeAssignableTo(e,t,n);return r||ei((0,T.o)({code:"invalid-argument",format:{value:(0,b.He)(e),expected:(0,b.He)(t)},target:n})),r}function tn(e,n,r){let a=t.getAugmentDecoratorsForSym(e),o=[];for(let e of a){let t=te(n,e,r);t&&o.unshift(t)}return o}function tr(e,n,r){var a;let o=(a=n).symbol&&262144&a.symbol.flags?tc(n)??n.symbol:tk(n.symbol),i=[];for(let a of[...t.getAugmentDecoratorsForSym(o),...n.decorators]){let t=te(e,a,r);t&&i.unshift(t)}let l=function(e){if(e.node?.docs===void 0)return;let t="";for(let n of e.node.docs)t+=O(n.content);let n=t.trim();return""===n?void 0:n}(e);if(l&&i.unshift(e9("self",l)),"Operation"===e.kind){let t=function(e){let t={returns:void 0,errors:void 0};if(e.node?.docs===void 0)return t;for(let n of e.node.docs)for(let e of n.tags)e.kind===P.a6.DocReturnsTag&&(t.returns=O(e.content)),e.kind===P.a6.DocErrorsTag&&(t.errors=O(e.content));return t}(e);t.returns&&i.unshift(e9("returns",t.returns)),t.errors&&i.unshift(e9("errors",t.errors))}else e.kind;return i}function ta(n,r){let i=eR(n.symbol);if(i.declaredType&&void 0===r)return i.declaredType;eG(n,r);let l=[],s=ty({kind:"Scalar",name:n.id.sv,node:n,constructors:new Map,namespace:eK(n),decorators:l,derivedScalars:[]});return ed(i,s,r),n.extends&&(s.baseScalar=function(n,r,o){let i=eb(n);ee.start(i,a.BaseType);let l=t.getNodeLinks(r).resolvedSymbol;if(l&&ee.has(l,a.BaseType)){void 0===o&&ei((0,T.o)({code:"circular-base-type",format:{typeName:l.declarations[0].id.sv},target:l}));return}let s=ec(r,o);if(ee.finish(i,a.BaseType),(0,E.xg)(s)){(0,m.a7)(e.hasError(),"Should already have reported an error.",r);return}if("Scalar"!==s.kind){ei((0,T.o)({code:"extend-model",target:r}));return}return s}(n,n.extends,r),s.baseScalar&&(ew(s.baseScalar,s),s.baseScalar.derivedScalars.push(s))),function(e,t,n,r){if(e.baseScalar)for(let a of e.baseScalar.constructors.values()){let o=tT(tu(t.symbol,a.name),{...a,scalar:e});e8(t,o,r),n.set(a.name,o)}for(let a of t.members){let t=to(a,r,e);if(n.has(t.name)){ei((0,T.o)({code:"constructor-duplicate",format:{name:t.name.toString()},target:a}));continue}n.set(t.name,t)}}(s,n,s.constructors,r),l.push(...tr(s,n,r)),void 0===r&&s.namespace?.scalars.set(s.name,s),K(s,r),eq(n,r)&&tg(s),eT(s)&&(o[s.name]=s),s}function to(e,t,n){let r=e.id.sv,a=tp(e);if(a&&a.declaredType&&void 0===t)return a.declaredType;let o=ty({kind:"ScalarConstructor",scalar:n,name:r,node:e,parameters:e.parameters.map(e=>ej(e,t,!1))});return K(o,t),eq(e.parent,t)&&tg(o),a&&ed(a,o,t),tg(o)}function ti(e,t){let n=eR(e.symbol);if(n.declaredType&&void 0===t)return n.declaredType;eG(e,t);let r=eb(e);if(ee.has(r,a.Type))return void 0===t&&ei((0,T.o)({code:"circular-alias-type",format:{typeName:e.id.sv},target:e})),n.declaredType=G,G;ee.start(r,a.Type);let o=ek(e.value,t);return null===o?(n.declaredType=G,G):(0,E.ml)(o)?(ei((0,T.o)({code:"value-in-type",target:e.value})),n.declaredType=G,G):(ed(n,o,t),ee.finish(r,a.Type),o)}function tl(e,t){let n=eR(e.symbol);if(n.declaredType&&void 0===t)return n.declaredType;eG(e,t);let r=ty({kind:"Interface",decorators:[],node:e,namespace:eK(e),sourceInterfaces:[],operations:(0,d.nQ)(),name:e.id.sv});ed(n,r,t),r.decorators=tr(r,e,t);let a=function(e,t,n){let r=new Map;for(let a of e.operations){let e=eO(a,t,n);if(r.has(e.name)){ei((0,T.o)({code:"interface-duplicate",format:{name:e.name},target:a}));continue}r.set(e.name,e)}return r}(e,t,r);for(let n of e.extends){let o=ec(n,t);if("Interface"!==o.kind){ei((0,T.o)({code:"extends-interface",target:n}));continue}for(let i of o.operations.values()){r.operations.has(i.name)&&ei((0,T.o)({code:"extends-interface-duplicate",format:{name:i.name},target:n}));let o=tT(tu(e.symbol,i.name),i,{interface:r});a.has(i.name)||e8(e,o,t),ew(i,o),r.operations.set(o.name,o)}r.sourceInterfaces.push(o)}for(let[e,t]of a)r.operations.set(e,t);return K(r,t),eq(e,t)&&tg(r),void 0===t&&r.namespace?.interfaces.set(r.name,r),e7(r),e3(r),r}function ts(e,t){let n=eR(e.symbol);if(n.declaredType&&void 0===t)return n.declaredType;eG(e,t);let r=(0,d.nQ)(),a=ty({kind:"Union",decorators:[],node:e,namespace:eK(e),name:e.id.sv,variants:r,get options(){return Array.from(this.variants.values()).map(e=>e.type)},expression:!1});return ed(n,a,t),a.decorators=tr(a,e,t),function(e,t,n,r){for(let a of t.options){let t=td(a,r);if(t.union=e,n.has(t.name)){ei((0,T.o)({code:"union-duplicate",format:{name:t.name.toString()},target:a}));continue}n.set(t.name,t)}}(a,e,r,t),K(a,t),eq(e,t)&&tg(a),void 0===t&&a.namespace?.unions.set(a.name,a),e7(a),e3(a),a}function td(e,t){let n=tp(e);if(n&&n.declaredType&&void 0===t)return n.declaredType;let r=e.id?e.id.sv:Symbol("name"),a=ec(e.value,t),o=ty({kind:"UnionVariant",name:r,node:e,decorators:[],type:a,union:void 0});return o.decorators=tr(o,e,t),K(o,t),eq(e.parent,t)&&tg(o),n&&ed(n,o,t),o}function tu(e,n){return e?t.getAugmentedSymbolTable(e.members).get(n):void 0}function tc(e){if(!e.id)return;let t=e.id.sv,n=e.parent?.symbol;return n?tu(n,t):void 0}function tp(e){let t=tc(e);return t&&(0,u.gG)(t)===e?eR(t):void 0}function tf(e,t,n){let r=e.id.sv,a=tp(e);if(a?.type)return a.type;(0,m.a7)(n,"Enum member should already have been checked.");let o=e.value?e.value.value:void 0,i=ty({kind:"EnumMember",enum:n,name:r,node:e,value:o,decorators:[]});return a&&(a.type=i),i.decorators=tr(i,e,t),tg(i)}function tm(e){return ty(e),tg(e)}function ty(t){return Object.setPrototypeOf(t,D),t.isFinished=!1,t.entityKind="Type",t.node&&function(t,n){let r=!1;for(let a of t.directives??[])if("deprecated"===a.target.sv){let o;let i=a.arguments[0];if(void 0===i){ei((0,T.o)({code:"invalid-deprecation-argument",messageId:"missing",target:a}));continue}i.kind!==P.a6.StringLiteral?(ei((0,T.o)({code:"invalid-deprecation-argument",format:{kind:P.a6[i.kind]},target:a.arguments[0]})),o="<missing message>"):o=i.value,!0===r?ei((0,T.o)({code:"duplicate-deprecation",target:t})):(r=!0,(0,f.BG)(e,n,{message:o}))}}(t.node,t),t}function tg(t){return C(e,D,t)}function tv(e){return tP(e.value,e)}function tk(e){return t.getMergedSymbol(e)}function tb(e,t){let n;switch(e.kind){case"Model":let r=ty({...e,decorators:[...e.decorators],properties:void 0,...t});"properties"in t||(r.properties=(0,d.nQ)(Array.from(e.properties.entries()).map(([e,t])=>[e,th(t,{model:r})]))),n=r;break;case"Union":let a=ty({...e,decorators:[...e.decorators],variants:void 0,get options(){return Array.from(this.variants.values()).map(e=>e.type)},...t});"variants"in t||(a.variants=(0,d.nQ)(Array.from(e.variants.entries()).map(([e,t])=>[e,th(t,{union:a})]))),n=a;break;case"Interface":let o=ty({...e,decorators:[...e.decorators],operations:void 0,...t});"operations"in t||(o.operations=(0,d.nQ)(Array.from(e.operations.entries()).map(([e,t])=>[e,th(t,{interface:o})]))),n=o;break;case"Enum":let i=ty({...e,decorators:[...e.decorators],members:void 0,...t});"members"in t||(i.members=(0,d.nQ)(Array.from(e.members.entries()).map(([e,t])=>[e,th(t,{enum:i})]))),n=i;break;default:n=ty({...e,..."decorators"in e?{decorators:[...e.decorators]}:{},...t})}return n}function th(e,t={}){let n=tb(e,t);e.isFinished&&(n=tg(n));let r=Y.get(e);return r&&Y.set(n,r),(0,m.a7)(n.kind===e.kind,"cloneType must not change type kind"),n}function tT(e,t,n={}){let r=tb(t,n);if("decorators"in r){let t=I.get(e);for(let n of(t&&r.decorators.push(e9("self",t)),tn(e,r,void 0)))r.decorators.push(n)}return t.isFinished&&(r=tg(r)),(0,m.a7)(r.kind===t.kind,"cloneType must not change type kind"),r}function tS(n){var a,o,i,l,s;switch(n.kind){case P.a6.ProjectionExpressionStatement:return a=n,tS(a.expr);case P.a6.ProjectionCallExpression:return function(e){let t=tS(e.target);if(!t)throw new m._f("target undefined");let n=[];for(let t of e.arguments)n.push(tS(t));if("Function"!==t.kind)throw new m._f("Can't call non-function, got type "+t.kind);return t.implementation(...n)}(n);case P.a6.ProjectionMemberExpression:return function(e){let t=tS(e.base);if("Return"===t.kind)return t;let n=e.id.sv,r=e.selector;if("."===r)switch(t.kind){case"Namespace":let a=t.node.symbol.exports.get(n);if(a){let e=eR(a);return e.declaredType||e.type||G}throw new m._f(`Namespace doesn't have member ${n}`);case"Model":let o=t.properties.get(n);if(!o)throw new m._f(`Model doesn't have property ${n}`);return o;case"Enum":let i=t.members.get(n);if(!i)throw new m._f(`Enum doesn't have member ${n}`);return i;case"Union":let l=t.variants.get(n);if(!l)throw new m._f(`Union doesn't have variant ${n}`);return l;default:throw new m._f(`Can't get member "${n}" of type ${t.kind} because it has no members. Did you mean to use "::" instead of "."?`)}if("Object"===t.kind)return t.properties[n]||G;{let e=eo[t.kind];if(!e)throw new m._f(`${t.kind} doesn't have an object model member named ${n}`);let r=e[n];if(!r)throw new m._f(`${t.kind} doesn't have an object model member named ${n}`);return r(t)}}(n);case P.a6.ProjectionDecoratorReferenceExpression:return function(t){let n=e$(t.target,void 0,!0);if(!n)throw new m._f("Can't find decorator.");return(0,m.a7)(1024&n.flags,"should only resolve decorator symbols"),tE((...t)=>(n.value({program:e},...t.map(L)),X))}(n);case P.a6.Identifier:return function(n){let a=r;for(;a;){if(a.locals.has(n.sv))return a.locals.get(n.sv);a=a.parent}let{finalSymbol:o}=t.resolveTypeReference(n);if(!o)throw new m._f("Unknown identifier "+n.sv);if(1024&o.flags)return G;if(8192&o.flags)return tE((...t)=>{let r=o.value(e,...t.map(L));return tI(r,{functionName:n.sv})});{let e=eR(o);return(0,m.a7)(e.declaredType,"Should have checked all types by now"),e.declaredType}}(n);case P.a6.ProjectionLambdaExpression:return o=n,tE((...e)=>(function(e,t){let n=r;for(let[a,o]of(r=tx(e,n),e.parameters.entries()))r.locals.set(o.id.sv,t[a]);let a=tw(e.body);return(r=n,"Return"===a.kind)?a.value:a})(o,e));case P.a6.StringLiteral:return i=n,tP(i.value,i);case P.a6.NumericLiteral:return l=n,tP(l.value,l);case P.a6.BooleanLiteral:return s=n,tP(s.value,s);case P.a6.ProjectionBlockExpression:return tw(n);case P.a6.ProjectionArithmeticExpression:return function(e){let t=tS(e.left);if("Return"===t.kind)return t;if("Number"!==t.kind&&"String"!==t.kind)throw new m._f(`Operator ${e.op} can only apply to strings or numbers`);let n=tS(e.right);if("Return"===n.kind)return n;if("Number"!==n.kind&&"String"!==n.kind)throw new m._f(`Operator ${e.op} can only apply to strings or numbers`);if(n.kind!==t.kind)throw new m._f(`Operator ${e.op}'s operands need to be the same type`);return t.kind,tP(t.value+n.value)}(n);case P.a6.ProjectionIfExpression:return function(e){let t=e;for(;t;){let e=tS(t.test);if("Return"===e.kind)return e;if(function(e){switch(e.kind){case"Boolean":return e.value;case"Number":case"String":return!!e.value;default:return!0}}(e))return tw(t.consequent);if(t.alternate&&t.alternate.kind===P.a6.ProjectionBlockExpression)return tw(t.alternate);t=t.alternate}return X}(n);case P.a6.ProjectionEqualityExpression:return function(e){let t=tS(e.left);if("Return"===t.kind)return t;if("Number"!==t.kind&&"String"!==t.kind)throw new m._f("Comparisons must be strings or numbers");let n=tS(e.right);if("Return"===n.kind)return n;if("Number"!==n.kind&&"String"!==n.kind)throw new m._f("Comparisons must be strings or numbers");if(n.kind!==t.kind)throw new m._f("Can't compare number and string");switch(e.op){case"==":return tP(t.value===n.value);case"!=":return tP(t.value!==n.value)}}(n);case P.a6.ProjectionUnaryExpression:return function(e){let t=tS(e.target);if("Boolean"!==t.kind)throw new m._f("Can't negate a non-boolean");if("!"===e.op)return tP(!t.value)}(n);case P.a6.ProjectionRelationalExpression:return function(e){let t=tS(e.left);if("Return"===t.kind)return t;if("Number"!==t.kind&&"String"!==t.kind)throw new m._f("Can only compare numbers or strings");let n=tS(e.right);if("Return"===n.kind)return n;if("Number"!==n.kind&&"String"!==n.kind)throw new m._f("Can only compare numbers or strings");if(t.kind!==n.kind)throw new m._f("Can't compare numbers and strings");switch(e.op){case"<":return tP(t.value<n.value);case"<=":return tP(t.value<=n.value);case">":return tP(t.value>n.value);case">=":return tP(t.value>=n.value)}}(n);case P.a6.ProjectionModelExpression:return function(e){let t=ty({kind:"Model",name:"",node:e,decorators:[],properties:(0,d.nQ)(),derivedModels:[],sourceModels:[]});for(let n of e.properties)if(n.kind===P.a6.ProjectionModelProperty){let e=function(e,t){let n=tS(e.value);return"Return"===n.kind?n:ty({kind:"ModelProperty",name:e.id.sv,node:e,decorators:[],optional:e.optional,type:n,model:t})}(n,t);if("Return"===e.kind)return e;t.properties.set(e.name,e)}else{let e=function(e){let t=tS(e.target);if("Return"===t.kind)return t;if("Model"!==t.kind)throw new m._f("Can only spread models");let n=[];for(let e of V(t)){let t=th(e,{sourceProperty:e});n.push(t)}return n}(n);if(!Array.isArray(e))return e;for(let n of e)t.properties.set(n.name,n)}return t}(n);case P.a6.VoidKeyword:return X;case P.a6.NeverKeyword:return q;case P.a6.UnknownKeyword:return J;case P.a6.Return:return function(e){let t=tS(e.value);return"Return"===t.kind?t:{kind:"Return",value:t}}(n);default:(0,m.a7)(!1,`Can't eval the node ${P.a6[n.kind]}`)}}function tx(e,t){return{node:e,locals:new Map,parent:t}}function tw(e){let t=X;for(let n of e.statements){let e=tS(n);if("Return"===e.kind)return e;t=e}return t}function tM(e,t,a){if("<error>"===e.direction)throw new m._f("Cannot evaluate projection with invalid direction.");let o=!1;if(n||(o=!0,n=e.direction),"from"===n&&!t.projectionSource)return t;let i=r;for(let[t,n]of(r=tx(e),e.parameters.entries())){let o;if(!a[t])throw new m._f("need argument for parameter "+P.a6[e.parameters[t].kind]);let i=a[t];o="number"==typeof i||"string"==typeof i||"boolean"==typeof i?tP(i):i,r.locals.set(n.id.sv,o)}r.locals.set("self",t);let l=X;for(let t of e.body)if(l=tS(t),"Return"===l.kind)break;o&&(n=void 0);let s=r.locals.get("self");return(r=i,"Return"===l.kind)?l.value:s}function tE(e){return ty({kind:"Function",name:"",parameters:[],returnType:J,implementation:e})}function tP(t,n){let r,a;if(e.literalTypes.has(t))return e.literalTypes.get(t);switch(typeof t){case"string":r=ty({kind:"String",value:t});break;case"boolean":r=ty({kind:"Boolean",value:t});break;case"number":n?((0,m.a7)(n.kind===P.a6.NumericLiteral,"Must pass numeric literal node or undefined when creating a numeric literal type"),a=n.valueAsString):a=String(t),r=ty({kind:"Number",value:t,valueAsString:a,numericValue:(0,S.ew)(a)})}return e.literalTypes.set(t,r),r}function tI(e,t={}){if("boolean"==typeof e||"string"==typeof e||"number"==typeof e)return tP(e);if("object"==typeof e&&null!==e)return"kind"in e?e:ty({kind:"Object",properties:e});if(t.functionName)throw new m._f(`Can't marshal value "${e}" returned from JS function "${t.functionName}" into typespec`);throw new m._f(`Can't marshal value "${e}" into typespec`)}function tN(e,t,n){let[r,a]=ea.isTypeAssignableTo(e,t.type,n);return r||("argument"===t.kind?ei((0,T.o)({code:"invalid-argument",format:{value:(0,b.He)(e),expected:(0,b.He)(t.type)},target:n})):el(a)),r}function tj(e,t,n){let[r,a]=ea.isTypeAssignableTo(e,t,n);return r||el(a),r}function tA(e,t,n){let[r,a]=ea.isValueOfType(e,t,n);return r||el(a),r}}function j(e,t,n,r){let a=new Map(r?.map??[]);for(let[n,r]of e.entries())a.set(r,t[n]);return{partial:!1,args:[...r?.args??[],...t],getMappedType:e=>a.get(e)??e,source:n,map:a}}function A(e,t,n){let r,a;if(n&&(t=U(e,t,n)),t.name||((0,m.a7)(!t.baseModel,"Anonymous model with base model."),0===t.properties.size))return t;for(let e of t.properties.values()){let n=function(e){if(!e.sourceProperty)return;let t=new Set;for(let n=e;n;n=n.sourceProperty)n.model?.name&&t.add(n.model);return t}(e);if(!n)return t;if(!r){r=n;continue}for(let e of(!function(e,t){for(let n of t)if(!e.has(n)){for(let t=n.baseModel;t;t=t.baseModel)if(e.has(t)){e.add(n);break}}}(n,r),r))n.has(e)||r.delete(e)}for(let e of r??[]){if(t.properties.size===D(e)){a=e;break}if(n&&!a&&t.properties.size===D(e,n)){a=e;continue}}return a??t}function U(e,t,n){var r,a;let l=!1;for(let e of V(t))if(!n(e)){l=!0;break}if(!l)return t;let s=o.M.realmForType.get(t),d=s?(0,i.$)(s):i.$,u=d.model.create({name:"",indexer:void 0,properties:{},decorators:[],derivedModels:[],sourceModels:[{usage:"spread",model:t}]});for(let e of V(t))if(n(e)){let t=d.type.clone(e);Object.assign(t,{sourceProperty:e,model:u}),u.properties.set(e.name,t),d.type.finishType(t)}return r=e,a=u,C(r,r.checker.typePrototype,a)}function*V(e){let t=new Set;for(let n=e;n;n=n.baseModel)for(let e of n.properties.values())!t.has(e.name)&&(t.add(e.name),yield e)}function D(e,t){let n=0;for(let r of V(e))(!t||t(r))&&n++;return n}function K(e,t){t&&((0,m.a7)(!e.templateArguments,"Mapper provided but template arguments already set."),e.templateMapper=t,e.templateArguments=t.args)}function O(e){let t=[];for(let n of e)(0,m.a7)(n.kind===P.a6.DocText,"No other doc content node kinds exist yet. Update this code appropriately when more are added."),t.push(n.text);return t.join("")}function C(e,t,n){if("decorators"in n)for(let t of n.decorators)!function(e,t,n){for(let e of((0,m.a7)("decorators"in n,"Cannot apply decorator to non-decoratable type",n),t.args))if((0,E.Xj)(e.value)&&(0,E.xg)(e.value))return;if(t.definition){let r=(0,f.LA)(e,t.definition);void 0!==r&&R(e,t.node??n,r.message,e.reportDiagnostic)}try{let r=t.args.map(e=>e.jsValue),a=t.decorator,o=function(e,t){return{program:e,decoratorTarget:t.node,getArgumentTarget:e=>t.args[e]?.node,call:(n,r,...a)=>n(function e(t,n){return{program:t,decoratorTarget:n.node,getArgumentTarget:()=>n.node,call:(r,a,...o)=>r(e(t,n),a,...o)}}(e,t),r,...a)}}(e,t);a(o,n,...r)}catch(r){if(e.compilerOptions.designTimeBuild)e.reportDiagnostic((0,T.o)({code:"decorator-fail",format:{decoratorName:t.decorator.name,error:r.stack},target:t.node??n}));else throw r}}(e,t,n);return Object.setPrototypeOf(n,t),n.isFinished=!0,n}function R(e,t,n,r){!0!==e.compilerOptions.ignoreDeprecated&&r((0,T.o)({code:"deprecated",format:{message:n},target:t}))}function B(e){return"templateParameters"in e&&e.templateParameters.length>0}!function(e){e[e.Value=0]="Value",e[e.Type=1]="Type",e[e.BaseType=2]="BaseType",e[e.Constraint=3]="Constraint"}(a||(a={}));class _{#e=new Map;start(e,t){let n=this.#e.get(e);void 0===n&&(n=new Set,this.#e.set(e,n)),n.add(t)}has(e,t){return this.#e.get(e)?.has(t)??!1}finish(e,t){let n=this.#e.get(e);void 0!==n&&(n?.delete(t),0===n.size&&this.#e.delete(e))}}let F={resolveDecorators:!1,checkTemplateTypes:!0};function L(e){return"Boolean"===e.kind||"String"===e.kind||"Number"===e.kind?e.value:"StringTemplate"===e.kind?e.stringValue:e}r()}catch(e){r(e)}})}}]);