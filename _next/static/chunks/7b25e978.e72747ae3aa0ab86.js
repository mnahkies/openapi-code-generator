"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[220],{63295:(e,t,n)=>{n.a(e,async(e,r)=>{try{n.d(t,{Dt:()=>A,HF:()=>j,h9:()=>D,wj:()=>I,zN:()=>V});var a,o=n(82918),i=n(2652),l=n(56258),s=n(87982),d=n(15202),u=n(51727),c=n(9332),p=n(21410),f=n(99728),m=n(64638),y=n(16301),g=n(56872),v=n(97591),k=n(50618),b=n(36059),h=n(2738),T=n(98739),S=n(44473),x=n(74989),w=n(90485),M=n(54266),E=n(29113),P=e([l,s,m,g,v,k,h,S,w]);[l,s,m,g,v,k,h,S,w]=P.then?(await P)():P;let $=class extends l.$V{};function I(e,t){let n,r;let P={},I=new Map,A=new WeakMap,j=new WeakMap,U=t=>{e.reportDiagnostic(t)},D={get projections(){return(W.get(this.kind)||[]).concat(Y.get(this)||[])},projectionsByName(e){return this.projections.filter(t=>t.id.sv===e)}},Q=function(){let e=t.symbols.global,n=tm({kind:"Namespace",name:"",node:eO(),models:new Map,scalars:new Map,operations:new Map,namespaces:new Map,interfaces:new Map,unions:new Map,enums:new Map,decoratorDeclarations:new Map,functionDeclarations:new Map,decorators:[]});return eC(e).type=n,n.decorators=tt(e,n,void 0),ty(n)}(),z=new Map,G=tm({kind:"Intrinsic",name:"ErrorType"}),X=tm({kind:"Intrinsic",name:"void"}),q=tm({kind:"Intrinsic",name:"never"}),J=tm({kind:"Intrinsic",name:"unknown"}),H=tm({kind:"Intrinsic",name:"null"}),W=new Map([["Model",[]],["ModelProperty",[]],["Scalar",[]],["Union",[]],["UnionVariant",[]],["Operation",[]],["Interface",[]],["Enum",[]],["EnumMember",[]]]),Y=new Map,Z=new Set,ee=new _,et=t.symbols.global.exports.get("TypeSpec");et&&((0,l.Tk)(et.exports).set("log",{flags:8192,name:"log",value:(t,...n)=>(e.trace("projection.log",n.join(" ")),X),declarations:[],node:void 0}),(0,l.Tk)(t.symbols.null).type=H,eC(t.symbols.null).type=H);let en={getTypeForNode:eu,checkProgram:function(){for(let n of(function(){for(let n of(e.reportDuplicateSymbols(t.symbols.global.exports),e.sourceFiles.values()))for(let t of n.namespaces){let n=tv(t.symbol).exports??t.symbol.exports;e.reportDuplicateSymbols(n)}}(),e.sourceFiles.values()))for(let r of(function(n){let r=new Map;for(let e of n.usings){let n=e.parent,a=tv(n.symbol),o=function(e){let t=r.get(e);if(t)return t;let n=new i.i;return r.set(e,n),n}(a),l=t.getNodeLinks(e.name).resolvedSymbol;l&&o.track(l,e)}for(let t of r.values())for(let[n,r]of t.entries())for(let t of r)e.reportDiagnostic((0,h.o)({code:"duplicate-using",format:{usingName:(0,v.q)(t.name)},target:t}))}(n),n.namespaces))eU(r);for(let t of e.sourceFiles.values())eQ(t);(0,m.J)(e)},checkSourceFile:eQ,getLiteralType:tg,getTypeName:k.Uz,getNamespaceString:k.Qn,getGlobalNamespaceType:function(){return Q},getGlobalNamespaceNode:eO,getMergedSymbol:tv,cloneType:tb,resolveIdentifier:function(e,n){let r;let{node:a,kind:o}=(0,S.fe)(e);switch(o){case E.wp.ModelExpressionProperty:case E.wp.ObjectLiteralProperty:let i=eR(a);if(!i)return;r=td(i.node.symbol,e.sv);break;case E.wp.ModelStatementProperty:case E.wp.Declaration:return t.getNodeLinks(e).resolvedSymbol;case E.wp.Other:return;case E.wp.Decorator:case E.wp.Function:case E.wp.Using:case E.wp.TypeReference:let l=e,s=o===E.wp.Decorator;e.parent?.kind===E.a6.MemberExpression&&(e.parent.id===e?l=e.parent:s=!1),r=eL(l,n,s);break;case E.wp.TemplateArgument:let d=eB(a,n).flatMap(e=>e.templateParameters).find(t=>t.id.sv===e.sv);d&&(r=tv(d.symbol));break;default:(0,f.a7)(!1,"Unreachable")}return r?.symbolSource??r},resolveCompletions:function(n){let r=new Map,{kind:a,node:o}=(0,S.fe)(n);switch(a){case E.wp.Using:case E.wp.Decorator:case E.wp.Function:case E.wp.TypeReference:case E.wp.ModelExpressionProperty:case E.wp.ModelStatementProperty:case E.wp.ObjectLiteralProperty:break;case E.wp.Other:case E.wp.Declaration:return r;case E.wp.TemplateArgument:for(let e of eB(o,void 0))for(let t of e.templateParameters)l(t.id.sv,t.symbol);return r;default:(0,f.a7)(!1,"Unreachable")}if(a===E.wp.ModelStatementProperty){let t=o.parent,a=e.checker.getTypeForNode(t),i=a.baseModel,s=i?.node;if(!s)return r;for(let e of i.properties.values())if(n.sv===e.name||!a.properties.has(e.name)){let t=td(s.symbol,e.name);t&&l(e.name,t)}}else if(a===E.wp.ModelExpressionProperty||a===E.wp.ObjectLiteralProperty){let e=eR(o);if(!e)return r;let t=o.parent;for(let r of V(e))if(n.sv===r.name||!t.properties.find(e=>(e.kind===E.a6.ModelProperty||e.kind===E.a6.ObjectLiteralProperty)&&e.id.sv===r.name)){let t=td(e.node.symbol,r.name);t&&l(r.name,t)}}else if(n.parent&&n.parent.kind===E.a6.MemberExpression){let e=t.getNodeLinks(n.parent.base).resolvedSymbol;e&&(128&e.flags&&(e=e$(e,void 0)),e&&i(e.exports??e.members))}else{if(a===E.wp.TypeReference&&(0,S.Px)(o)&&o.parent?.kind===E.a6.TemplateArgument&&void 0===o.parent.name)for(let e of eB(o.parent,void 0))for(let t of e.templateParameters)l(t.id.sv,t.symbol,{suffix:" = "});let e=n.parent;for(;e&&e.kind!==E.a6.TypeSpecScript;){if(e.symbol&&e.symbol.exports){let t=tv(e.symbol);i(t.exports)}"locals"in e&&i(e.locals),e=e.parent}if(e&&e.kind===E.a6.TypeSpecScript){for(let t of e.inScopeNamespaces){let e=tv(t.symbol);i(e.exports)}i(t.symbols.global.exports),i(e.locals)}}return r;function i(e){if(e)for(let[n,r]of e=t.getAugmentedSymbolTable(e))if(65536&r.flags){for(let t of e.duplicates.get(r))if(32768&t.flags){let e=(0,M.eN)(t.symbolSource);l(e,t)}}else l(n,r)}function l(e,t,n={}){t.symbolSource&&(t=t.symbolSource),function(e){switch(a){case E.wp.ModelExpressionProperty:case E.wp.ModelStatementProperty:case E.wp.ObjectLiteralProperty:return!!(262144&e.flags);case E.wp.Decorator:return!!(1280&e.flags);case E.wp.Using:return!!(256&e.flags);case E.wp.TypeReference:return!(9216&e.flags);case E.wp.TemplateArgument:return!!(2048&e.flags);default:(0,f.a7)(!1,"We should have bailed up-front on other kinds.")}}(t)&&(e.startsWith("@")&&(e=e.slice(1)),r.has(e)||r.set(e,{...n,sym:t}))}},evalProjection:tw,project:function(e,t,n=[]){return tw(t,e,n.map(e=>tP(e)))},neverType:q,errorType:G,nullType:H,anyType:J,voidType:X,typePrototype:D,createType:tm,createAndFinishType:tf,createFunctionType:tM,createLiteralType:tE,finishType:ty,isStdType:function(e,t){return e=e.projectionBase??e,!!(("Model"===e.kind||"Scalar"===e.kind)&&void 0!==e.namespace&&eb(e.namespace))&&("Scalar"===e.kind?void 0===t||t===e.name:"Array"===t&&e===P.Array||"Record"===t&&e===P.Record||"Model"===e.kind&&(void 0===t||t===e.name))},getStdType:el,resolveTypeReference:function(e){let t=U,n=[];U=e=>n.push(e);let r=eS(e,void 0,!1);return U=t,[r===G?void 0:r,n]},getValueForNode:ec,getTypeOrValueForNode:ey,getValueExactType:function(e){return j.get(e)},isTypeAssignableTo:void 0},er=(0,w.i)(e,en);en.isTypeAssignableTo=er.isTypeAssignableTo;let ea=(0,x.J)(en);return en;function eo(e,t){U(void 0===t||"object"!=typeof e.target?e:{...e,target:{node:e.target,templateMapper:t}})}function ei(e){e.forEach(e=>eo(e))}function el(e){let t=P[e];if(void 0!==t)return t;let n=et?.exports?.get(e);(0,f.a7)(n,`Unexpected missing symbol to std type "${e}"`),2&n.flags?eG(n.declarations[0],void 0):tr(n.declarations[0],void 0);let r=P[e];return(0,f.a7)(r,`TypeSpec std type "${e}" should have been initalized before using array syntax.`),r}function es(e,t,n){void 0===n?(e.declaredType=t,e.instantiations=new $):e.instantiations&&e.instantiations.set(n.args,t)}function ed(e,t){let n=eC(e),r=eu((0,s.gG)(e.parent),t);return(n.declaredType??n.type)||function(e,t,n){switch(e.kind){case E.a6.ModelProperty:return e3(e,t);case E.a6.EnumMember:return tp(e,t,n);case E.a6.OperationStatement:return eK(e,t,n);case E.a6.UnionVariant:return ts(e,t);case E.a6.ScalarConstructor:return ta(e,t,n)}}((0,s.gG)(e),t,r)}function eu(e,t){let n=ev(e,t);return null===n?G:"Indeterminate"===n.entityKind?n.type:(0,M.ml)(n)?(eo((0,h.o)({code:"value-in-type",target:e})),G):("TemplateParameter"===n.kind&&n.constraint?.valueType&&eo((0,h.o)({code:"value-in-type",messageId:"referenceTemplate",target:e})),n)}function ec(e,t,n,r={}){var a;let o;let i=ev(e,t,n);return null===i?null:(o="Indeterminate"===i.entityKind?ep(i.type,n,e):i,r.legacyTupleAndModelCast&&null!==o&&(0,M.Xj)(o)&&(o=ef(o,n,e)),null===o)?null:(0,M.ml)(o)?n?function(e,t){switch(e.valueKind){case"BooleanValue":case"StringValue":case"NumericValue":if(void 0===e.scalar){let n=eZ(t,e.type);return eY(e,{scalar:n})}return e;case"ArrayValue":case"ObjectValue":case"EnumValue":case"NullValue":case"ScalarValue":return e}}(o,n.type):o:(a=o,"Model"===a.kind&&""===a.name&&e.kind===E.a6.ModelExpression?eo((0,h.o)({code:"expect-value",messageId:"model",format:{name:(0,k.Uz)(a)},codefixes:[(0,u.l)(e)],target:e})):"Tuple"===a.kind&&e.kind===E.a6.TupleExpression?eo((0,h.o)({code:"expect-value",messageId:"tuple",format:{name:(0,k.Uz)(a)},codefixes:[(0,c.s)(e)],target:e})):eo((0,h.o)({code:"expect-value",format:{name:(0,k.Uz)(a)},target:e})),null)}function ep(e,t,n){switch(e.kind){case"String":case"StringTemplate":return e0(e,t,n);case"Number":return function(e,t,n){if(t&&!tI(e,t,n))return null;let r=eZ(t?.type,e);return eW({entityKind:"Value",valueKind:"NumericValue",value:(0,T.ew)(e.valueAsString),type:t?t.type:e,scalar:r},e)}(e,t,n);case"Boolean":return function(e,t,n){if(t&&!tI(e,t,n))return null;let r=eZ(t?.type,e);return eW({entityKind:"Value",valueKind:"BooleanValue",value:e.value,type:t?t.type:e,scalar:r},e)}(e,t,n);case"EnumMember":return t&&!tI(e,t,n)?null:eW({entityKind:"Value",valueKind:"EnumValue",type:t?t.type:e,value:e},e);case"UnionVariant":return ep(e.type,t,n);case"Intrinsic":if("null"===e.name)return t&&!tI(e,t,n)?null:eW({entityKind:"Value",valueKind:"NullValue",type:t?t.type:e,value:null},e);return e;default:return e}}function ef(t,n,r){switch(t.kind){case"Tuple":return function(t,n,r){if(t.node.kind!==E.a6.TupleExpression)return t;eo((0,h.o)({code:"deprecated",codefixes:[(0,c.s)(t.node)],format:{message:"Using a tuple as a value is deprecated. Use an array value instead(with #[])."},target:t.node}));let a=[];for(let[o,i]of t.values.entries()){let l=n?.kind==="Model"&&(0,M.x3)(e,n)?n.indexer.value:n?.kind==="Tuple"?n.values[o]:void 0,s=ep(i,l&&{kind:"assignment",type:l},r);if(null!==s&&(0,M.Xj)(s)&&(s=ef(s,l&&{kind:"assignment",type:l},r)),null===s)return null;if(!(0,M.ml)(s))return t;a.push(s)}return void 0===n||tN(t,n,r)?{entityKind:"Value",valueKind:"ArrayValue",type:n??t,node:t.node,values:a}:null}(t,n?.type,r);case"Model":return function(e,t,n){if(e.node?.kind!==E.a6.ModelExpression)return e;eo((0,h.o)({code:"deprecated",codefixes:[(0,u.l)(e.node)],format:{message:"Using a model as a value is deprecated. Use an object value instead(with #{})."},target:e.node}));let r={entityKind:"Value",valueKind:"ObjectValue",type:t??e,node:e.node,properties:new Map};for(let t of e.properties.values()){let a=ep(t.type,{kind:"assignment",type:t.type},n);if(null!==a&&(0,M.Xj)(a)&&(a=ef(a,{kind:"assignment",type:t.type},n)),null==a)return null;if(!(0,M.ml)(a))return e;r.properties.set(t.name,{name:t.name,value:a,node:t.node})}return void 0===t||tN(e,t,n)?r:null}(t,n?.type,r);default:return t}}function em(e,t){return!!(t?.valueType&&!(t.type&&(0,f.r$)(er.isTypeAssignableTo(e,t.type,e))))}function ey(e,t,n){let r=eg(n),a=ev(e,t,r);if(null===a)return a;if((0,M.Xj)(a))return em(a,n?.constraint)?ef(a,r,e):a;if((0,M.ml)(a))return a;if((0,f.a7)("Indeterminate"===a.entityKind,"Expected indeterminate entity"),r){let t=[],n=U;U=e=>t.push(e);let o=ep(a.type,r,e);if(U=n,o)return ei(t),o}return a.type}function eg(e){return e?.constraint.valueType?{kind:e.kind,type:e.constraint.valueType}:void 0}function ev(n,r,o){switch(n.kind){case E.a6.ModelExpression:case E.a6.ModelStatement:var i,s;return i=n,s=r,i.kind===E.a6.ModelStatement?eG(i,s):function(e,t){let n=eC(e.symbol);if(n.declaredType&&void 0===t)return n.declaredType;let r=(0,l.nQ)(),a=tm({kind:"Model",name:"",node:e,properties:r,indexer:void 0,namespace:eD(e),decorators:[],derivedModels:[],sourceModels:[]});return es(n,a,t),K(a,t),eH(e,r,a,t),ty(a)}(i,s);case E.a6.ModelProperty:return e3(n,r);case E.a6.ScalarStatement:return tr(n,r);case E.a6.AliasStatement:return to(n,r);case E.a6.EnumStatement:return function(e,t){let n=eC(e.symbol);if(!n.type){let r=n.type=tm({kind:"Enum",name:e.id.sv,node:e,members:(0,l.nQ)(),decorators:[]}),a=new Set;for(let n of e.members)if(n.kind===E.a6.EnumMember){let o=tp(n,t,r);if(a.has(o.name)){eo((0,h.o)({code:"enum-member-duplicate",format:{name:o.name},target:e}));continue}a.add(o.name),r.members.set(o.name,o)}else for(let o of function(e,t,n,r,a){let o=[],i=eu(n,r);if(!(0,M.xg)(i)){if("Enum"!==i.kind)return eo((0,h.o)({code:"spread-enum",target:n})),o;for(let r of i.members.values())if(a.has(r.name))eo((0,h.o)({code:"enum-member-duplicate",format:{name:r.name},target:n}));else{a.add(r.name);let n=td(e,r.name),i=th(n,r,{enum:t,sourceMember:r});i&&o.push(i)}}return o}(e.symbol,r,n.target,t,a))e8(e,o,t),r.members.set(o.name,o);let o=eD(e);r.namespace=o,r.namespace?.enums.set(r.name,r),r.decorators=tn(r,e,t),K(r,t),ty(r)}return n.type}(n,r);case E.a6.EnumMember:return tp(n,r);case E.a6.InterfaceStatement:return ti(n,r);case E.a6.UnionStatement:return tl(n,r);case E.a6.UnionVariant:return ts(n,r);case E.a6.NamespaceStatement:case E.a6.JsNamespaceDeclaration:return function e(t){let n=eC(tv(t.symbol)).type;if(n||(n=eU(t)),t.kind===E.a6.NamespaceStatement){if((0,l.cy)(t.statements))t.statements.forEach(e=>ev(e));else if(t.statements){let r=e(t.statements);n.namespaces.set(r.name,r)}}return n}(n);case E.a6.OperationStatement:return eK(n,r);case E.a6.NumericLiteral:case E.a6.BooleanLiteral:case E.a6.StringLiteral:return{entityKind:"Indeterminate",type:tg(n)};case E.a6.TupleExpression:return tf({kind:"Tuple",node:n,values:n.values.map(e=>eu(e,r))});case E.a6.StringTemplateExpression:return function(e,t){let n=!1,r=!1,a=e.spans.map(e=>[e,ev(e.expression,t)]);for(let[e,t]of a)null!==t&&((0,M.ml)(t)?r=!0:"kind"in t&&"TemplateParameter"===t.kind&&t.constraint?(t.constraint.valueType&&(r=!0),t.constraint.type&&(n=!0)):n=!0);if(n&&r)return eo((0,h.o)({code:"mixed-string-template",target:e})),null;if(r){let t=e.head.value;for(let[e,n]of a)null===n||"kind"in n&&"TemplateParameter"===n.kind||((0,f.a7)(null!==n&&(0,M.ml)(n),"Expected value."),t+=function(e){switch(e.valueKind){case"StringValue":case"NumericValue":case"BooleanValue":return e.value.toString();default:return eo((0,h.o)({code:"non-literal-string-template",target:e})),`[${e.valueKind}]`}}(n)),t+=e.literal.value;return e0(tE(t),void 0,e)}{let t=!1,n=e.head.value,r=[eF(e.head)];for(let[e,i]of a){var o;(0,f.a7)(null!==i&&!(0,M.ml)(i),"Expected type.");let a="Indeterminate"===i.entityKind?i.type:i,l=(o=e.expression,tm({kind:"StringTemplateSpan",node:o,isInterpolated:!0,type:a}));r.push(l);let s=function(e){switch(e.kind){case"String":case"Number":case"Boolean":return String(e.value);case"StringTemplate":if(void 0!==e.stringValue)return e.stringValue;return;default:return}}(a);s?n+=s:t=!0,r.push(eF(e.literal)),n+=e.literal.value}return e_(tm({kind:"StringTemplate",node:e,spans:r,stringValue:t?void 0:n}))}}(n,r);case E.a6.ArrayExpression:return eV(n,r);case E.a6.UnionExpression:return function(e,t){let n=tf({kind:"Union",node:e,get options(){return Array.from(this.variants.values()).map(e=>e.type)},expression:!0,variants:(0,l.nQ)(),decorators:[]});for(let r of e.options){let e=eu(r,t);if(e!==q){if("Union"===e.kind&&e.expression)for(let[t,r]of e.variants)n.variants.set(t,r);else{let t=tm({kind:"UnionVariant",type:e,name:Symbol("name"),decorators:[],node:void 0,union:n});n.variants.set(t.name,t)}}}return K(n,t),n}(n,r);case E.a6.IntersectionExpression:return function(e,t){let n=eC(e.symbol);if(n.declaredType&&void 0===t)return n.declaredType;let r=e.options.map(e=>[e,eu(e,t)]),a=function e(t,n,r,a){let o=(0,l.nQ)(),i=tm({kind:"Model",node:n,name:"",namespace:eD(n),properties:o,decorators:[],derivedModels:[],sourceModels:[]}),s=[],d=r.filter(e=>{let[t,n]=e;return"TemplateParameter"!==n.kind&&("Model"===n.kind||(eo((0,h.o)({code:"intersect-non-model",target:t})),!1))});for(let[e,t]of d)t.indexer&&("integer"===t.indexer.key.name?eo((0,h.o)({code:"intersect-invalid-index",messageId:"array",target:e})):s.push(t.indexer));for(let[e,r]of d)for(let e of(i.sourceModels.push({usage:"intersection",model:r}),V(r))){if(o.has(e.name)){eo((0,h.o)({code:"intersect-duplicate-property",format:{propName:e.name},target:n}));continue}let l=t&&td(t,e.name),d={sourceProperty:e,model:i},u=l?th(l,e,d):tb(e,d);for(let t of(o.set(e.name,u),e8(n,u,a),s.filter(e=>e!==r.indexer)))eJ(t,e,n)}return 1===s.length?i.indexer=s[0]:s.length>1&&(i.indexer={key:s[0].key,value:e(void 0,n,s.map(e=>[e.value.node,e.value]),a)}),K(i,a),ty(i)}(e.symbol,e,r,t);return es(n,a,t),a}(n,r);case E.a6.DecoratorDeclarationStatement:return eI(n,r);case E.a6.FunctionDeclarationStatement:return function(e,t){let n=tv(e.symbol),r=eC(n);if(r.declaredType&&void 0===t)return r.declaredType;let a=eD(e);(0,f.a7)(a,`Decorator ${e.id.sv} should have resolved a namespace or found the global namespace.`);let o=e.id.sv;2&e.modifierFlags||eo((0,h.o)({code:"function-extern",target:e}));let i=n.value;void 0===i&&eo((0,h.o)({code:"missing-implementation",target:e}));let l=tm({kind:"Function",name:o,namespace:a,node:e,parameters:e.parameters.map(e=>eN(e,t,!0)),returnType:e.returnType?eu(e.returnType,t):J,implementation:i??(()=>{})});return a.functionDeclarations.set(o,l),es(r,l,t),l}(n,r);case E.a6.TypeReference:return function(e,t,n=!0){let r=eL(e,t);return r?ew(r,e,t,n)??G:G}(n,r);case E.a6.TemplateArgument:return ev(n.argument,r);case E.a6.TemplateParameterDeclaration:return eT(n,r);case E.a6.ProjectionStatement:return function(e){let t;let n=eC(e.symbol);if(Z.has(e))return n.declaredType;switch(Z.add(e),eo((0,h.o)({code:"projections-are-experimental",target:e})),t=n.declaredType?n.declaredType:n.declaredType=tm({kind:"Projection",node:void 0,nodeByKind:new Map,nodeByType:new Map}),e.selector.kind){case E.a6.ProjectionModelSelector:W.get("Model").push(e),t.nodeByKind.set("Model",e);break;case E.a6.ProjectionModelPropertySelector:W.get("ModelProperty").push(e),t.nodeByKind.set("ModelProperty",e);break;case E.a6.ProjectionScalarSelector:W.get("Scalar").push(e),t.nodeByKind.set("Scalar",e);break;case E.a6.ProjectionOperationSelector:W.get("Operation").push(e),t.nodeByKind.set("Operation",e);break;case E.a6.ProjectionUnionSelector:W.get("Union").push(e),t.nodeByKind.set("Union",e);break;case E.a6.ProjectionUnionVariantSelector:W.get("UnionVariant").push(e),t.nodeByKind.set("UnionVariant",e);break;case E.a6.ProjectionInterfaceSelector:W.get("Interface").push(e),t.nodeByKind.set("Interface",e);break;case E.a6.ProjectionEnumSelector:W.get("Enum").push(e),t.nodeByKind.set("Enum",e);break;case E.a6.ProjectionEnumMemberSelector:W.get("EnumMember").push(e),t.nodeByKind.set("EnumMember",e);break;default:let r=eS(e.selector,void 0),a=Y.get(r);a||(a=[],Y.set(r,a)),a.push(e),t.nodeByType.set(r,e)}return t}(n);case E.a6.VoidKeyword:return X;case E.a6.NeverKeyword:return q;case E.a6.UnknownKeyword:return J;case E.a6.ObjectLiteral:return function(e,t,n){let r=function(e,t){let n=new Map,r=!1;for(let a of e.properties)if("id"in a){let e=ec(a.value,t);null===e?r=!0:n.set(a.id.sv,{name:a.id.sv,value:e,node:a})}else{let e=function(e,t){let n=ec(e,t);return null===n?null:"ObjectValue"!==n.valueKind?(eo((0,h.o)({code:"spread-object",target:e})),null):n}(a.target,t);if(e)for(let[t,r]of e.properties)n.set(t,{...r})}return r?null:n}(e,t);if(null===r)return null;let a=function(e,t){let n=tm({kind:"Model",name:"",node:e,properties:(0,l.nQ)(),decorators:[],derivedModels:[],sourceModels:[]});for(let e of t.values())n.properties.set(e.name,tf({kind:"ModelProperty",node:e.node,model:n,optional:!1,name:e.name,type:e.value.type,decorators:[]}));return ty(n)}(e,r);return n&&!tI(a,n,e)?null:eW({entityKind:"Value",valueKind:"ObjectValue",node:e,properties:r,type:n?n.type:a},a)}(n,r,o);case E.a6.ArrayLiteral:return function(e,t,n){let r=!1,a=e.values.map(e=>{let n=ec(e,t);return null===n&&(r=!0),n});if(r)return null;let o=tf({kind:"Tuple",node:e,values:a.map(e=>e.type)});return n&&!tI(o,n,e)?null:eW({entityKind:"Value",valueKind:"ArrayValue",node:e,values:a,type:n?n.type:o},o)}(n,r,o);case E.a6.ConstStatement:return function(e){let t=eC(e.symbol);if(void 0!==t.value)return t.value;let n=e.type?eu(e.type,void 0):void 0;if(ee.has(e.symbol,a.Value))return eo((0,h.o)({code:"circular-const",format:{name:e.id.sv},target:e})),null;ee.start(e.symbol,a.Value);let r=ec(e.value,void 0,n&&{kind:"assignment",type:n});return(ee.finish(e.symbol,a.Value),null===r||n&&!tA(r,n,e.id))?t.value=null:t.value=n?eY(r,{type:n}):eY(r),t.value}(n);case E.a6.CallExpression:return function(e,t){let n=e6(e,t);return null===n?null:"ScalarConstructor"===n.kind?function(e,t,n){let r=!1,a=n.parameters.filter(e=>!e.optional&&!e.rest).length??0,o=n.parameters[n.parameters.length-1]?.rest?void 0:n.parameters.length;if(e.arguments.length<a||void 0!==o&&e.arguments.length>o){if(e.arguments.length<a&&(r=!0),void 0===o)eo((0,h.o)({code:"invalid-argument-count",messageId:"atLeast",format:{actual:e.arguments.length.toString(),expected:a.toString()},target:e}));else{let t=a===o?a.toString():`${a}-${o}`;eo((0,h.o)({code:"invalid-argument-count",format:{actual:e.arguments.length.toString(),expected:t},target:e}))}}let i=[];for(let[a,o]of n.parameters.entries()){if(o.rest){var l;let n=(l=o.type,"Model"===l.kind?l.indexer?.value:void 0);if(n)for(let o=a;o<e.arguments.length;o++){let a=e.arguments[o];if(a){let e=ec(a,t,{kind:"argument",type:n});if(null===e){r=!0;continue}tA(e,n,a)?i.push(e):r=!0}}break}let n=e.arguments[a];if(n){let e=ec(n,t,{kind:"argument",type:o.type});if(null===e){r=!0;continue}tA(e,o.type,n)?i.push(e):r=!0}}return r?null:{entityKind:"Value",valueKind:"ScalarValue",value:{name:n.name,args:i},scalar:n.scalar,type:n.scalar}}(e,t,n):er.areScalarsRelated(n,el("string"))?e1(e,n,"StringValue"):er.areScalarsRelated(n,el("numeric"))?e1(e,n,"NumericValue"):er.areScalarsRelated(n,el("boolean"))?e1(e,n,"BooleanValue"):(eo((0,h.o)({code:"named-init-required",format:{typeKind:n.kind},target:e.target})),null)}(n,r);case E.a6.TypeOfExpression:return function(e,t){let n=ev(e.target,t,void 0);if(null===n)return G;if("Indeterminate"===n.entityKind)return n.type;if((0,M.Xj)(n)){if("TemplateParameter"===n.kind){if(void 0===n.constraint||void 0!==n.constraint.type)return eo((0,h.o)({code:"expect-value",messageId:"templateConstraint",format:{name:(0,k.Uz)(n)},target:e.target})),G;if(n.constraint.valueType)return n.constraint.valueType}return eo((0,h.o)({code:"expect-value",format:{name:(0,k.Uz)(n)},target:e.target})),n}return n.type}(n,r);case E.a6.AugmentDecoratorStatement:return eL(n.targetType,void 0),t.getNodeLinks(n.targetType).isTemplateInstantiation&&e.reportDiagnostic((0,h.o)({code:"augment-decorator-target",messageId:"noInstance",target:n.targetType})),G;case E.a6.UsingStatement:return function(e){let t=eL(e.name,void 0);return t&&256&~t.flags&&eo((0,h.o)({code:"using-invalid-ref",target:e.name})),G}(n);default:return G}}function ek(e){return e.kind===E.a6.OperationStatement&&e.parent?.kind===E.a6.InterfaceStatement?tu(e):e.symbol}function eb(e){return"TypeSpec"===e.name&&(e.namespace===Q||e.namespace?.projectionBase===Q)}function eh(e){return!!(e.namespace&&eb(e.namespace))}function eT(e,t){let n=e.parent,r=n.parent,o=eC(e.symbol);if(ee.has(ek(e),a.Constraint))return void 0===t&&eo((0,h.o)({code:"circular-constraint",format:{typeName:e.id.sv},target:e.constraint})),G;let i=o.declaredType;if(void 0===i){r&&r.locals?.has(e.id.sv)&&eo((0,h.o)({code:"shadow",format:{name:e.id.sv},target:e}));let t=n.templateParameters.findIndex(t=>t===e);i=o.declaredType=tf({kind:"TemplateParameter",node:e}),e.constraint&&(ee.start(ek(e),a.Constraint),i.constraint=ej(e.constraint),ee.finish(ek(e),a.Constraint)),e.default&&(i.default=function(e,t,n,r){let a=function e(r){let a=ev(r),o=!1;if(null!==a&&"kind"in a&&"TemplateParameter"===a.kind){for(let e=n;e<t.length;e++)if(a.node.symbol===t[e].symbol){eo((0,h.o)({code:"invalid-template-default",target:r}));return}return a}return(0,S.LI)(r,t=>{let n=e(t);void 0===n&&(o=!0)}),o?void 0:a}(e)??G;return!("kind"in a&&(0,M.xg)(a))&&r&&tN(a,r,e),a}(e.default,n.templateParameters,t,i.constraint))}return t?t.getMappedType(i):i}function eS(e,t,n=!0){let r=eL(e,t);return r?function(e,t,n,r=!0){let a=ew(e,t,n,r);return null===a||(0,M.ml)(a)?(eo((0,h.o)({code:"value-in-type",target:t})),G):"Indeterminate"===a.entityKind?a.type:a}(r,e,t,n):G}function ex(t,n){let r=(0,p.LA)(e,t);r&&(0,p.BG)(e,n,r)}function ew(t,n,r,a=!0){let o;if(524288&t.flags)return ec(t.declarations[0],r);if(1024&t.flags)return eo((0,h.o)({code:"invalid-type-ref",messageId:"decorator",target:t})),G;if(8192&t.flags)return eo((0,h.o)({code:"invalid-type-ref",messageId:"function",target:t})),G;let i=n.kind===E.a6.TypeReference?n.arguments:[],l=eC(t);if(1048576&t.flags&&238&t.flags){let e=t.declarations[0];if(R(e)){let l=function(e,t,n){var r;let a=eC(e);return a.declaredType?a.declaredType:4194304&e.flags?((0,f.a7)(e.type,"Expected late bound symbol to have type"),e.type):262144&e.flags?ed(e,n):(r=eM(e,t,n),"Indeterminate"===r.entityKind?r.type:r)}(t,e,r),s=e.templateParameters,d=function(e,t,n,r){let a=new Map,o=[],i=new Map(n.map(e=>{let t=eT(e,void 0);return o.push(t),a.set(e.id.sv,t),[t,{decl:e,checkArgument:null}]})),l=!1;for(let[n,d]of t.map((e,t)=>[e,t])){function s(){return[n,ev(n.argument,r)]}if(n.name){l=!0;let e=a.get(n.name.sv);if(!e){eo((0,h.o)({code:"invalid-template-args",messageId:"unknownName",format:{name:n.name.sv},target:n}));continue}if(null!==i.get(e).checkArgument){eo((0,h.o)({code:"invalid-template-args",messageId:"specifiedAgain",format:{name:n.name.sv},target:n}));continue}i.get(e).checkArgument=s}else{if(l&&eo((0,h.o)({code:"invalid-template-args",messageId:"positionalAfterNamed",target:n})),d>=o.length){eo((0,h.o)({code:"invalid-template-args",messageId:"tooMany",target:e}));continue}let t=o[d];i.get(t).checkArgument??=s}}let d=[],u=[];for(let[t,{decl:n,checkArgument:a}]of[...i]){function c(e,t){i.set(e,t),d.push(e),u.push(t)}if(null===a){let a=N(d,u,{node:e,mapper:r}),o=void 0===t.default?void 0:(0,M.Xj)(t.default)&&(0,M.xg)(t.default)||null===t.default?t.default:ev(n.default,a);o?c(t,o):(eo((0,h.o)({code:"invalid-template-args",messageId:"missing",format:{name:n.id.sv},target:e})),c(t,t.constraint?.type??J));continue}let[o,l]=a();if(null===l){c(t,J);continue}if(t.constraint){let e=t.constraint.type?.kind==="TemplateParameter"?i.get(t.constraint.type):t.constraint;if((0,M.Xj)(l)&&em(l,t.constraint)&&ef(l,{kind:"argument",type:t.constraint.valueType},o)!==l){c(t,l);continue}if(t.constraint&&!te(l,e,o)){let e=t.constraint.type??J;c(t,e);continue}}else if((0,M.xg)(l)){c(t,J);continue}else if((0,M.ml)(l)){eo((0,h.o)({code:"value-in-type",messageId:"noTemplateConstraint",target:o})),c(t,J);continue}c(t,l)}return i}(n,i,s,r);o=eE(e,[...d.keys()],[...d.values()],{node:n,mapper:r},l.templateMapper,a)}else{if(i.length>0&&eo((0,h.o)({code:"invalid-template-args",messageId:"notTemplate",target:n})),4194304&t.flags)return(0,f.a7)(t.type,"Expected late bound symbol to have type"),t.type;o=l.declaredType?l.declaredType:262144&t.flags?ed(t,r):eM(t,e,r)}}else{let e=(0,s.gG)(t);if(i.length>0&&eo((0,h.o)({code:"invalid-template-args",messageId:"notTemplate",target:n})),4194304&t.flags)return(0,f.a7)(t.type,"Expected late bound symbol to have type"),t.type;2048&t.flags?o=eT(e,r):l.type?o=l.type:l.declaredType?o=l.declaredType:262144&t.flags?o=ed(t,r):(o=eu(e,r),l.type=o)}let d=(0,s.gG)(t);return(d&&void 0===r&&(0,M.Xj)(o)&&!function e(t){function n(e){return z.has(e)||z.set(e,(e.directives??[]).findIndex(e=>"deprecated"===e.target.sv)>=0),z.get(e)}switch(t.kind){case E.a6.ModelStatement:return n(t);case E.a6.OperationStatement:return n(t)||t.parent.kind===E.a6.InterfaceStatement&&e(t.parent);case E.a6.InterfaceStatement:return n(t);case E.a6.IntersectionExpression:case E.a6.UnionExpression:case E.a6.ModelProperty:case E.a6.OperationSignatureDeclaration:case E.a6.OperationSignatureReference:return e(t.parent);default:return!1}}(n.parent)&&function(t,n,r){if(n){let t=(0,p.LA)(e,n);if(t){B(e,r,t.message,eo);return}}let a=(0,p.LA)(e,t);a&&B(e,r,a.message,eo)}(o,d,n),(0,M.Xj)(o)&&("EnumMember"===o.kind||"UnionVariant"===o.kind)||(0,M.Cm)(o))?e_(o):o}function eM(e,t,n){return 2&e.flags?eG(t,n):4&e.flags?tr(t,n):128&e.flags?to(t,n):32&e.flags?ti(t,n):8&e.flags?eK(t,n):tl(t,n)}function eE(e,t,n,r,a,o=!0){let i=e.kind===E.a6.OperationStatement&&e.parent.kind===E.a6.InterfaceStatement?tc(e):eC(e.symbol);if((0,f.a7)(i,`Unexpected checker error. symbolLinks was not defined for ${E.a6[e.kind]}`),void 0===i.instantiations){let t=eu(e);if((0,M.xg)(t))return G;(0,f.a7)(!1,`Unexpected checker error. symbolLinks.instantiations was not defined for ${E.a6[e.kind]}`)}let l=N(t,n,r,a);return i.instantiations?.get(l.args)||(o?function(e,t,n,r){let a=eu(t,r);return e.get(r.args)||e.set(r.args,a),"Model"===a.kind&&(a.templateNode=t),a}(i.instantiations,e,0,l):G)}function eP(e,t){let n=(0,l.nQ)(),r=tf({kind:"Union",node:e,options:t,decorators:[],variants:n,expression:!0});for(let e of t){let t=Symbol("indexer-union-variant");n.set(t,tf({kind:"UnionVariant",node:void 0,type:e,name:t,union:r,decorators:[]}))}return r}function eI(e,t){let n=tv(e.symbol),r=eC(n);if(r.declaredType&&void 0===t)return r.declaredType;let a=eD(e);(0,f.a7)(a,`Decorator ${e.id.sv} should have resolved a namespace or found the global namespace.`);let o=e.id.sv;2&e.modifierFlags||eo((0,h.o)({code:"decorator-extern",target:e}));let i=n.value;void 0===i&&eo((0,h.o)({code:"missing-implementation",target:e}));let l=tm({kind:"Decorator",name:`@${o}`,namespace:a,node:e,target:eN(e.target,t,!0),parameters:e.parameters.map(e=>eN(e,t,!0)),implementation:i??(()=>{})});return a.decoratorDeclarations.set(o,l),es(r,l,t),l}function eN(e,t,n){let r;let a=eC(e.symbol);if(a.declaredType)return a.declaredType;e.rest&&e.type&&!(e.type.kind===E.a6.ArrayExpression||e.type.kind===E.a6.ValueOfExpression&&e.type.target.kind===E.a6.ArrayExpression)&&eo((0,h.o)({code:"rest-parameter-array",target:e.type}));let o={kind:"FunctionParameter",node:e,name:e.id.sv,optional:e.optional,rest:e.rest,implementation:e.symbol.value};if(n){let t=e.type?ej(e.type):{entityKind:"MixedParameterConstraint",type:J};r=tm({...o,type:t,mixed:!0,implementation:e.symbol.value})}else r=tm({...o,mixed:!1,type:e.type?eu(e.type):J,implementation:e.symbol.value});return es(a,r,t),r}function eA(e,t){if(e.kind===E.a6.ValueOfExpression){let n=eu(e.target,t);return["value",n]}return["type",eu(e,t)]}function ej(e,t){if(e.kind===E.a6.UnionExpression)return function(e,t){let n=[],r=[];for(let a of e.options){let[e,o]=eA(a,t);"value"===e?n.push(o):r.push(o)}return{entityKind:"MixedParameterConstraint",node:e,valueType:0===n.length?void 0:1===n.length?n[0]:eP(e,n),type:0===r.length?void 0:1===r.length?r[0]:eP(e,r)}}(e,t);{let[n,r]=eA(e,t);return{entityKind:"MixedParameterConstraint",node:e,type:"value"===n?void 0:r,valueType:"value"===n?r:void 0}}}function eV(e,t){let n=eu(e.elementType,t),r=el("Array").node,a=eu(r.templateParameters[0]);return eE(r,[a],[n],{node:e,mapper:t},void 0)}function eU(e){(0,f.a7)(e.symbol,"Namespace is unbound.",e);let t=tv(e.symbol),n=eC(t);if(!n.type){let r=eD(e),a=e.id.sv,o=tm({kind:"Namespace",name:a,namespace:r,node:e,models:new Map,scalars:new Map,operations:new Map,namespaces:new Map,interfaces:new Map,unions:new Map,enums:new Map,decoratorDeclarations:new Map,functionDeclarations:new Map,decorators:[]});for(let e of(n.type=o,t.declarations))e.kind===E.a6.NamespaceStatement&&(o.decorators=o.decorators.concat(tn(o,e,void 0)));ty(o),r?.namespaces.set(a,o)}return n.type}function eD(e){if(e===Q.node)return;if(e.kind===E.a6.ModelExpression||e.kind===E.a6.IntersectionExpression){let t=e.parent;for(;void 0!==t;){if(t.kind===E.a6.AliasStatement||t.kind===E.a6.ModelStatement||t.kind===E.a6.ScalarStatement||t.kind===E.a6.OperationStatement||t.kind===E.a6.EnumStatement||t.kind===E.a6.InterfaceStatement||t.kind===E.a6.UnionStatement||t.kind===E.a6.ModelExpression||t.kind===E.a6.IntersectionExpression)return eD(t);t=t.parent}return}if(e.kind===E.a6.OperationStatement&&e.parent&&e.parent.kind===E.a6.InterfaceStatement)return eD(e.parent);if(!e.symbol.parent||e.symbol.parent.declarations[0].kind===E.a6.TypeSpecScript||e.symbol.parent.declarations[0].kind===E.a6.JsSourceFile)return Q;let t=tv(e.symbol.parent),n=eC(t);if(!n.type){let r=t.declarations.find(e=>e.kind===E.a6.NamespaceStatement||e.kind===E.a6.JsNamespaceDeclaration);(0,f.a7)(r,"Can't find namespace declaration node.",e),n.type=eU(r)}return n.type}function eK(e,n,r){let o,i,s;let d=e.parent?.kind===E.a6.InterfaceStatement,u=d?tu(e):e.symbol,c=u&&eC(u);if(c&&c.declaredType&&void 0===n)return c.declaredType;void 0===n&&d&&(0,f.a7)(r,"Operation in interface should already have been checked.",e.parent),ez(e,n),R(e)&&void 0!==n&&r&&(n={...n,partial:!0});let p=eD(e),m=e.id.sv,y=[],{resolvedSymbol:g}=t.resolveMetaMemberByName(u,"parameters");if(g?.members){let n=t.getAugmentedSymbolTable(g.members),r=function(e){if(void 0===e.docs)return new Map;let t=new Map;for(let n of e.docs)for(let e of n.tags)e.kind===E.a6.DocParamTag&&t.set(e.paramName.sv,O(e.content));return t}(e);for(let[e,t]of n){let n=r.get(e);n&&I.set(t,n)}}if(e.signature.kind===E.a6.OperationSignatureReference){let r=function(e,n,r){if(!n)return;let o=ek(e);o&&ee.start(o,a.BaseType);let i=t.getNodeLinks(n).resolvedSymbol;if(i&&ee.has(i,a.BaseType)){void 0===r&&eo((0,h.o)({code:"circular-op-signature",format:{typeName:i.name},target:n}));return}let l=eu(n,r);if(o&&ee.finish(o,a.BaseType),!(0,M.xg)(l)){if("Operation"!==l.kind){eo((0,h.o)({code:"is-operation",target:n}));return}return l}}(e,e.signature.baseOperation,n);if(r){s=r;let e=tk(r.parameters,{properties:(0,l.nQ)()});e.properties=(0,l.nQ)(Array.from(r.parameters.properties.entries()).map(([t,n])=>[t,th(td(g,n.name),n,{model:e,sourceProperty:n})])),o=ty(e),i=r.returnType,y=[...r.decorators]}else o=tf({kind:"Model",name:"",decorators:[],properties:(0,l.nQ)(),derivedModels:[],sourceModels:[]}),i=X}else o=eu(e.signature.parameters,n),i=eu(e.signature.returnType,n);let v=tm({kind:"Operation",name:m,namespace:p,node:e,parameters:o,returnType:i,decorators:y,sourceOperation:s,interface:r});c&&es(c,v,n),y.push(...tn(v,e,n)),v.parameters.namespace=p;let k=e.parent;return K(v,n),k.kind===E.a6.InterfaceStatement?eX(k,n)&&eX(e,n)&&ty(v):(eX(e,n)&&ty(v),void 0===n&&p?.operations.set(m,v)),v}function eO(){return t.symbols.global.declarations[0]}function eC(e){return t.getSymbolLinks(e)}function eB(e,t){let n=e.parent,r=eL(n,t,!1);return!r&&(0,S.qq)(n)&&void 0!==n.target&&(r=eL(n.target,t,!1)),r?.declarations.filter(e=>R(e))??[]}function eR(t){let n,r;let a=e=>e?.kind===E.a6.ArrayLiteral||e?.kind===E.a6.ObjectLiteral,o=e=>e?.kind===E.a6.ModelExpression||e?.kind===E.a6.TupleExpression,i=e=>a(e)||o(e),l=[],s=(0,S._$)(t,e=>((function(e,t,n){if(e.kind===E.a6.ArrayLiteral||e.kind===E.a6.TupleExpression){let r=e.values.findIndex(e=>e===t);r>=0?n.unshift({tupleIndex:r}):(0,f.a7)(!1,"not expected, can't find child from the parent?")}(e.kind===E.a6.ModelProperty||e.kind===E.a6.ObjectLiteralProperty)&&n.unshift({propertyName:e.id.sv})})(e,n,l),n=e,i(e)&&(e.parent?.kind===E.a6.TemplateParameterDeclaration||e.parent?.kind===E.a6.TemplateArgument||e.parent?.kind===E.a6.DecoratorExpression)||a(e)&&(e.parent?.kind===E.a6.CallExpression||e.parent?.kind===E.a6.ConstStatement)));switch(s?.parent?.kind){case E.a6.TemplateParameterDeclaration:case E.a6.TemplateArgument:r=function(t){let n,r;if(t?.parent?.kind===E.a6.TemplateArgument&&t?.parent?.parent?.kind===E.a6.TypeReference){let e=t.parent,n=t.parent.parent,a=eB(e,void 0),o=n.arguments.findIndex(t=>t===e);a.length>0&&a[0].templateParameters.length>o&&(r=a[0].templateParameters[o])}else t.parent?.kind===E.a6.TemplateParameterDeclaration&&(r=t?.parent);if(r?.kind===E.a6.TemplateParameterDeclaration&&r.constraint)return a(t)&&r.constraint.kind===E.a6.ValueOfExpression?n=e.checker.getTypeForNode(r.constraint.target):o(t)&&r.constraint.kind!==E.a6.ValueOfExpression&&(n=e.checker.getTypeForNode(r.constraint)),n}(s);break;case E.a6.DecoratorExpression:r=function(t){let n;let r=t?.parent;if(r?.kind!==E.a6.DecoratorExpression)return;let i=e.checker.resolveIdentifier(r.target.kind===E.a6.MemberExpression?r.target.id:r.target);if(!i)return;let l=i.declarations.find(e=>e.kind===E.a6.DecoratorDeclarationStatement);if(!l)return;let s=e.checker.getTypeForNode(l);(0,f.a7)("Decorator"===s.kind,"Expected type to be a Decorator.");let d=r.arguments.findIndex(e=>e===t);if(d<0||d>=s.parameters.length)return;let u=s.parameters[d];return a(t)?n=u.type.valueType:o(t)?n=u.type.type??u.type.valueType:(0,f.a7)(!1,"not expected node type to get reference model from decorator argument"),n}(s);break;case E.a6.CallExpression:r=function(e){let t=e?.parent;if(t?.kind!==E.a6.CallExpression)return;let n=e6(t,void 0);if(n?.kind!=="ScalarConstructor")return;let r=t.arguments.findIndex(t=>t===e);if(!(r<0)&&!(r>=n.parameters.length))return n.parameters[r].type}(s);break;case E.a6.ConstStatement:r=function(t){let n=t?.parent;if(n&&n.kind===E.a6.ConstStatement&&n.type&&n.value===t)return e.checker.getTypeForNode(n.type)}(s)}return r?.kind==="Model"||r?.kind==="Tuple"?function(e,t){let n=e;for(let e of t)switch(n?.kind){case"Tuple":if(void 0===e.tupleIndex||!(e.tupleIndex>=0)||!(e.tupleIndex<n.values.length))return;n=n.values[e.tupleIndex];break;case"Model":if("Array"===n.name&&void 0!==e.tupleIndex)n=n.templateMapper?.args[0];else{if("Array"===n.name||!e.propertyName)return;n=n.properties.get(e.propertyName)?.type}break;default:return}return n?.kind==="Model"?n:void 0}(r,l):void 0}function eL(n,r,a){let o="boolean"==typeof a?{...F,resolveDecorators:a}:{...F,...a??{}};if(void 0===r&&o.checkTemplateTypes&&A.has(n))return A.get(n);let i=function(n,r,a){if(!(0,S.qq)(n)){if(n.kind===E.a6.TypeReference)return eL(n.target,r,a);if(n.kind===E.a6.Identifier){let o=t.getNodeLinks(n);void 0===r&&o.resolutionResult&&(void 0===r&&o.resolutionResult&(E.lS.NotFound|E.lS.Unknown)?eo((0,h.o)({code:"invalid-ref",messageId:a.resolveDecorators?"decorator":"identifier",format:{id:function e(t){switch(t.kind){case E.a6.MemberExpression:return`${e(t.base)}.${e(t.id)}`;case E.a6.TypeReference:return e(t.target);case E.a6.Identifier:return t.sv}}(n)},target:n,codefixes:function(e){if("number"===e.sv)return[(0,d.o)(e,"float64")]}(n)})):o.resolutionResult&E.lS.Ambiguous&&function(t,n){let r=n.map(e=>(0,M.eN)(e,{useGlobalPrefixAtTopLevel:!0}));e.reportDiagnostic((0,h.o)({code:"ambiguous-symbol",format:{name:t.sv,duplicateNames:r.join(", ")},target:t}))}(n,o.ambiguousSymbols));let i=o.resolvedSymbol;return i?.symbolSource??i}if(n.kind===E.a6.MemberExpression){let e=eL(n.base,r,{...a,resolveDecorators:!1});if(!e)return;if(128&e.flags){let t=e$(e,r);if(!t){eo((0,h.o)({code:"invalid-ref",messageId:"node",format:{id:n.id.sv,nodeName:e.declarations[0]?E.a6[e.declarations[0].kind]:"Unknown node"},target:n}));return}e=t}return function(e,n,r){let{finalSymbol:a,resolvedSymbol:o}=t.resolveMemberExpressionForSym(e,n,r),i=o??a;if(i)return i;if(256&e.flags)eo((0,h.o)({code:"invalid-ref",messageId:"underNamespace",format:{namespace:(0,M.eN)(e),id:n.id.sv},target:n}));else if(1024&e.flags)eo((0,h.o)({code:"invalid-ref",messageId:"inDecorator",format:{id:n.id.sv},target:n}));else if(8192&e.flags)eo((0,h.o)({code:"invalid-ref",messageId:"node",format:{id:n.id.sv,nodeName:"function"},target:n}));else if(118&e.flags)eo((0,h.o)({code:"invalid-ref",messageId:"."===n.selector?"member":"metaProperty",format:{kind:function(e){switch(e.kind){case E.a6.ModelStatement:case E.a6.ModelExpression:return"Model";case E.a6.ModelProperty:return"ModelProperty";case E.a6.EnumStatement:return"Enum";case E.a6.InterfaceStatement:return"Interface";case E.a6.UnionStatement:return"Union";default:return"Type"}}((0,s.gG)(e)),id:n.id.sv},target:n}));else{let t=(0,s.gG)(e);eo((0,h.o)({code:"invalid-ref",messageId:"node",format:{id:n.id.sv,nodeName:t?E.a6[t.kind]:"Unknown node"},target:n}))}}(e,n,a)}(0,f.a7)(!1,`Unknown type reference kind "${E.a6[n.kind]}"`,n)}}(n,r,o);return o.checkTemplateTypes&&A.set(n,i),i}function e$(e,n){let r=(0,s.gG)(e),a=t.getSymbolLinks(e);if(!a.aliasResolutionIsTemplate)return a.aliasedSymbol??t.getNodeLinks(r).resolvedSymbol;let o=eu(r,n);if(!(0,M.xg)(o))switch(o.kind){case"Model":case"Interface":case"Union":if((0,M.w7)(o))return e7(o),o.symbol;default:return tv(o.node.symbol)??e}}function e_(e){return{entityKind:"Indeterminate",type:e}}function eF(e){return tm({kind:"StringTemplateSpan",node:e,isInterpolated:!1,type:tg(e)})}function eQ(e){for(let t of e.statements)ev(t,void 0)}function ez(e,t){if(void 0===t)for(let t of e.templateParameters)eT(t,void 0)}function eG(n,r){let i=eC(n.symbol);if(i.declaredType&&void 0===r)return i.declaredType;ez(n,r);let s=[],d=tm({kind:"Model",name:n.id.sv,node:n,properties:(0,l.nQ)(),namespace:eD(n),decorators:s,sourceModels:[],derivedModels:[]});if(es(i,d,r),n.symbol.members){let e=t.getAugmentedSymbolTable(n.symbol.members),r=function(e){if(void 0===e.docs)return new Map;let t=new Map;for(let n of e.docs)for(let e of n.tags)e.kind===E.a6.DocPropTag&&t.set(e.propName.sv,O(e.content));return t}(n);for(let[t,n]of e){let e=r.get(t);e&&I.set(n,e)}}let u=function(e,n,r){let o;if(!n)return;let i=ek(e);if(ee.start(i,a.BaseType),n.kind===E.a6.ModelExpression){eo((0,h.o)({code:"is-model",messageId:"modelExpression",target:n}));return}if(n.kind===E.a6.ArrayExpression)o=eV(n,r);else if(n.kind===E.a6.TypeReference){let e=t.getNodeLinks(n).resolvedSymbol;if(e&&ee.has(e,a.BaseType)){void 0===r&&eo((0,h.o)({code:"circular-base-type",format:{typeName:e.name},target:e}));return}o=eu(n,r)}else{eo((0,h.o)({code:"is-model",target:n}));return}if(ee.finish(i,a.BaseType),"Model"!==o.kind){eo((0,h.o)({code:"is-model",target:n}));return}if(""===o.name){eo((0,h.o)({code:"is-model",messageId:"modelExpression",target:n}));return}return o}(n,n.is,r);if(u&&(d.sourceModel=u,d.sourceModels.push({usage:"is",model:u}),s.push(...u.decorators),u.indexer&&(d.indexer=u.indexer)),u)for(let e of u.properties.values()){let t=td(n.symbol,e.name),a=th(t,e,{sourceProperty:e,model:d});e8(n,a,r),d.properties.set(e.name,a)}u?d.baseModel=u.baseModel:n.extends&&(d.baseModel=function(n,r,o){if(r.kind===E.a6.ModelExpression){eo((0,h.o)({code:"extend-model",messageId:"modelExpression",target:r}));return}if(r.kind!==E.a6.TypeReference){eo((0,h.o)({code:"extend-model",target:r}));return}let i=ek(n);ee.start(i,a.BaseType);let l=t.getNodeLinks(r).resolvedSymbol;if(l&&ee.has(l,a.BaseType)){void 0===o&&eo((0,h.o)({code:"circular-base-type",format:{typeName:l.name},target:l}));return}let s=eu(r,o);if(ee.finish(i,a.BaseType),(0,M.xg)(s)){(0,f.a7)(e.hasError(),"Should already have reported an error.",r);return}if("Model"!==s.kind){eo((0,h.o)({code:"extend-model",target:r}));return}return""===s.name&&eo((0,h.o)({code:"extend-model",messageId:"modelExpression",target:r})),s}(n,n.extends,r),d.baseModel&&ex(d.baseModel,d)),d.baseModel&&d.baseModel.derivedModels.push(d),void 0===r&&d.namespace?.models.set(d.name,d),eH(n,d.properties,d,r),s.push(...tn(d,n,r)),K(d,r),eX(n,r)&&ty(d);let c=(0,o.CT)(e,d);return"Array"===d.name&&eh(d)?P.Array=d:"Record"===d.name&&eh(d)&&(P.Record=d),c&&(d.indexer=c),e7(d),e4(d),d}function eX(e,t){return 0===e.templateParameters.length||void 0!==t&&!t.partial&&t.args.every(e=>(0,M.ml)(e)||"Indeterminate"===e.entityKind||"TemplateParameter"!==e.kind)}function eq(e,t,n){let r=function(e){let t=e;for(;t;){if(t.indexer)return t.indexer;t=t.baseModel}}(e);if(void 0!==r)return eJ(r,t,n)}function eJ(e,t,n){if("integer"===e.key.name){ei([(0,h.o)({code:"no-array-properties",target:n})]);return}let[r,a]=er.isTypeAssignableTo(t.type,e.value,n);r||eo((0,h.o)({code:"incompatible-indexer",format:{message:a.map(e=>`  ${e.message}`).join("\n")},target:n.kind===E.a6.ModelProperty?n.value:n}))}function eH(t,n,r,a){let o;for(let i of t.properties)if("id"in i){let e=e3(i,a);e.model=r,eq(r,e,i),e2(n,e)}else{let[l,s]=function(t,n,r,a){let o=eu(n,a);if("TemplateParameter"===o.kind||(0,M.xg)(o))return[[],void 0];if("Model"!==o.kind||(0,M.x3)(e,o))return eo((0,h.o)({code:"spread-model",target:n}),a),[[],void 0];r===o&&eo((0,h.o)({code:"spread-model",messageId:"selfSpread",target:n})),r.sourceModels.push({usage:"spread",model:o});let i=[];for(let e of V(o)){let n=td(t,e.name);i.push(th(n,e,{sourceProperty:e,model:r}))}return[i,o.indexer]}(t.symbol,i.target,r,a);for(let e of(s&&(o?o.push(s):o=[s]),l))e8(t,e,a),eq(r,e,i),e2(n,e,i)}if(o){let e=1===o.length?o[0].value:function(e){let t=(0,l.nQ)(),n=tf({kind:"Union",node:void 0,options:e,decorators:[],variants:t,expression:!0});for(let r of e){let e=Symbol("indexer-union-variant");t.set(e,tf({kind:"UnionVariant",node:void 0,type:r,name:e,union:n,decorators:[]}))}return n}(o.map(e=>e.value));r.indexer={key:o[0].key,value:e}}}function eW(e,t){return j.set(e,t),e}function eY(e,t){let n={...e,...t},r=j.get(e);return r&&j.set(n,r),n}function eZ(e,t){if(void 0!==e)switch(e.kind){case"Scalar":if((0,f.r$)(en.isTypeAssignableTo(t,e,t)))return e;return;case"Union":let n;for(let r of e.variants.values()){let e=eZ(r.type,t);if(e){if(n){eo((0,h.o)({code:"ambiguous-scalar-type",format:{value:(0,k.Uz)(t),types:[n,e].map(e=>e.name).join(", "),example:n.name},target:t}));return}n=e}}return n;default:return}}function e0(e,t,n){let r;if(t&&!tI(e,t,n))return null;if("StringTemplate"===e.kind){if(!e.stringValue)return ei((0,g.DK)(e)),null;r=e.stringValue}else r=e.value;let a=eZ(t?.type,e);return eW({entityKind:"Value",valueKind:"StringValue",value:r,type:t?t.type:e,scalar:a},e)}function e6(e,t){let n=eS(e.target,t);return"Scalar"===n.kind||"ScalarConstructor"===n.kind?n:(eo((0,h.o)({code:"non-callable",format:{type:n.kind},target:e.target})),null)}function e1(e,t,n){if(1!==e.arguments.length)return eo((0,h.o)({code:"invalid-primitive-init",target:e.target})),null;let r=e.arguments[0],a=ec(r,void 0);return null===a?null:a.valueKind!==n?(eo((0,h.o)({code:"invalid-primitive-init",messageId:"invalidArg",format:{actual:a.valueKind,expected:n},target:r})),null):tA(a,t,r)?eY(a,{scalar:t,type:t}):null}function e2(e,t,n){if(e.has(t.name)){eo((0,h.o)({code:"duplicate-property",format:{propName:t.name},target:n??t}));return}let r=function(e){(0,f.a7)(e.model,"Parent model must be set before overridden property can be found.");for(let t=e.model.baseModel;t;t=t.baseModel){let n=t.properties.get(e.name);if(n)return n}}(t);if(r){let[e,a]=er.isTypeAssignableTo(t.type,r.type,t),o=(0,k.Uz)(r.type),i=(0,k.Uz)(t.type),l=!1;if(e||(eo((0,h.o)({code:"override-property-mismatch",format:{propName:t.name,propType:i,parentType:o},target:n??t})),l=!0),!r.optional&&t.optional&&(eo((0,h.o)({code:"override-property-mismatch",messageId:"disallowedOptionalOverride",format:{propName:r.name},target:n??t})),l=!0),l)return}e.set(t.name,t)}function e7(e){if(!e.symbol)switch(e.kind){case"Model":e.symbol=(0,s.v5)(e.node,e.name,4194306),(0,l.Tk)(e.symbol).type=e;break;case"Interface":e.symbol=(0,s.v5)(e.node,e.name,4194336),(0,M.w7)(e)&&"Foo"===e.name&&eC(e.symbol),(0,l.Tk)(e.symbol).type=e;break;case"Union":if(!e.name)return;e.symbol=(0,s.v5)(e.node,e.name,4194368),(0,l.Tk)(e.symbol).type=e}}function e4(e){(0,f.a7)(e.symbol,"Type must have a symbol to late bind members");let n=e.symbol;(0,f.a7)(n.members,"Container symbol didn't have members at late-bind");let r=t.getAugmentedSymbolTable(n.members);switch(e.kind){case"Model":for(let t of V(e))a(t,1310720);break;case"Scalar":for(let t of e.constructors.values())a(t,1310720);break;case"Enum":for(let t of e.members.values())a(t,1310720);break;case"Interface":for(let t of e.operations.values())a(t,1310728);break;case"Union":for(let t of e.variants.values())a(t,1310720)}function a(e,t){if(!e.node||"string"!=typeof e.name)return;let a=(0,s.v5)(e.node,e.name,4194304|t,n);(0,l.Tk)(a).type=e,(0,f.a7)(n.members,"containerSym.members is undefined"),r.set(e.name,a)}}function e8(e,n,r){if(void 0!==r||((0,f.a7)("string"==typeof n.name,"Cannot link unmapped unions"),void 0===e.symbol))return;let a=td(e.symbol,n.name);if(a){var o;o=t.getSymbolLinks(a),void 0===r&&(o.declaredType=n)}}function e3(e,t){let n=tu(e),r=tc(e);if(r&&r.declaredType&&void 0===t)return r.declaredType;let o=e.id.sv,i=tm({kind:"ModelProperty",name:o,node:e,optional:e.optional,type:void 0,decorators:[]});if(ee.has(n,a.Type)&&void 0===t)eo((0,h.o)({code:"circular-prop",format:{propName:o},target:e})),i.type=G;else{if(ee.start(n,a.Type),i.type=eu(e.value,t),e.default){let t=function(e,t){if((0,M.xg)(t))return null;let n=ec(e,void 0,{kind:"assignment",type:t},{legacyTupleAndModelCast:!0});if(null===n)return null;let[r,a]=er.isValueOfType(n,t,e);return r?{...n,type:t}:(ei(a),null)}(e.default,i.type);null!==t&&(i.defaultValue=t,i.default=function(e){let t=ev(e,void 0);return null===t||(0,M.ml)(t)?void 0:"Indeterminate"===t.entityKind?t.type:t}(e.default))}r&&es(r,i,t)}i.decorators=tn(i,e,t);let l=(0,M.hO)(e);if(K(i,t),!l||eX(l,t)){let e=I.get(n);e&&i.decorators.unshift(e9("self",e)),ty(i)}return ee.finish(n,a.Type),i}function e9(e,t){return{decorator:o.DY,args:[{value:tE(e),jsValue:e},{value:tE(t),jsValue:t}]}}function e5(t,n,r){let a=eL(n.target,void 0,!0);if(!a)return;if(!(1024&a.flags)){eo((0,h.o)({code:"invalid-decorator",format:{id:a.name},target:n}));return}let o=eC(a),i=!1;if(void 0===o.declaredType){let e=a.declarations.find(e=>e.kind===E.a6.DecoratorDeclarationStatement);e&&eI(e,void 0)}o.declaredType&&((0,f.a7)("Decorator"===o.declaredType.kind,`Expected to find a decorator type but got ${o.declaredType.kind}`),!function(e,t,n){let[r]=er.isTypeAssignableTo(e,t.target.type,n);return r||eo((0,h.o)({code:"decorator-wrong-target",messageId:"withExpected",format:{decorator:t.name,to:(0,k.Uz)(e),expected:(0,k.He)(t.target.type)},target:n})),r}(t,o.declaredType,n)&&(i=!0));let[l,s]=function(t,n,r){if(void 0===r)return[!1,t.arguments.map(e=>{let t=ev(e,n)??G;return"Indeterminate"===t.entityKind&&(t=t.type),{value:t,jsValue:t,node:e}})];let a=!1,o=r.parameters.filter(e=>!e.optional&&!e.rest).length??0,i=r.parameters[r.parameters.length-1]?.rest?void 0:r.parameters.length;if(t.arguments.length<o||void 0!==i&&t.arguments.length>i){if(t.arguments.length<o&&(a=!0),void 0===i)eo((0,h.o)({code:"invalid-argument-count",messageId:"atLeast",format:{actual:t.arguments.length.toString(),expected:o.toString()},target:t}));else{let e=o===i?o.toString():`${o}-${i}`;eo((0,h.o)({code:"invalid-argument-count",format:{actual:t.arguments.length.toString(),expected:e},target:t}))}}let l=[],s=function(t){if(t){let n=(0,y.X)(e,t);if("compiler"===n.type);else if(("library"===n.type||"project"===n.type)&&n.flags?.decoratorArgMarshalling)return n.flags.decoratorArgMarshalling}return"new"}(r);function d(e,t){var r;let a=ey(e,n,{kind:"argument",constraint:t});return null!==a&&!((0,M.Xj)(a)&&(0,M.xg)(a))&&te(a,t,e)?{value:a,node:e,jsValue:(r=eg({kind:"argument",constraint:t}),void 0!==r&&(0,M.ml)(a)?"legacy"===s?(0,b.i8)(en,a):(0,b.JM)(a,r.type):a)}:void 0}for(let[n,o]of r.parameters.entries()){if(o.rest){let r=function(t){let n,r;if(t.valueType){if(!("Model"===t.valueType.kind&&(0,M.x3)(e,t.valueType)))return;n=t.valueType.indexer.value}if(t.type){if(!("Model"===t.type.kind&&(0,M.x3)(e,t.type)))return;r=t.type.indexer.value}return{entityKind:"MixedParameterConstraint",type:r,valueType:n}}(o.type);if(r)for(let e=n;e<t.arguments.length;e++){let n=t.arguments[e];if(n){let e=d(n,r);e?l.push(e):a=!0}}break}let r=t.arguments[n];if(r){let e=d(r,o.type);e?l.push(e):a=!0}}return[a,l]}(n,r,o.declaredType);if(!i&&!l)return{definition:o.declaredType,decorator:a.value??((...e)=>{}),node:n,args:s}}function te(e,t,n){let[r]=er.isTypeAssignableTo(e,t,n);return r||eo((0,h.o)({code:"invalid-argument",format:{value:(0,k.He)(e),expected:(0,k.He)(t)},target:n})),r}function tt(e,n,r){let a=t.getAugmentDecoratorsForSym(e),o=[];for(let e of a){let t=e5(n,e,r);t&&o.unshift(t)}return o}function tn(e,n,r){let a=n.symbol&&262144&n.symbol.flags?tu(n)??n.symbol:tv(n.symbol),o=[];for(let i of[...t.getAugmentDecoratorsForSym(a),...n.decorators]){let t=e5(e,i,r);t&&o.unshift(t)}let i=function(e){if(e.node?.docs===void 0)return;let t="";for(let n of e.node.docs)t+=O(n.content);let n=t.trim();return""===n?void 0:n}(e);if(i&&o.unshift(e9("self",i)),"Operation"===e.kind){let t=function(e){let t={returns:void 0,errors:void 0};if(e.node?.docs===void 0)return t;for(let n of e.node.docs)for(let e of n.tags)e.kind===E.a6.DocReturnsTag&&(t.returns=O(e.content)),e.kind===E.a6.DocErrorsTag&&(t.errors=O(e.content));return t}(e);t.returns&&o.unshift(e9("returns",t.returns)),t.errors&&o.unshift(e9("errors",t.errors))}else e.kind;return o}function tr(n,r){let o=eC(n.symbol);if(o.declaredType&&void 0===r)return o.declaredType;ez(n,r);let i=[],l=tm({kind:"Scalar",name:n.id.sv,node:n,constructors:new Map,namespace:eD(n),decorators:i,derivedScalars:[]});return es(o,l,r),n.extends&&(l.baseScalar=function(n,r,o){let i=ek(n);ee.start(i,a.BaseType);let l=t.getNodeLinks(r).resolvedSymbol;if(l&&ee.has(l,a.BaseType)){void 0===o&&eo((0,h.o)({code:"circular-base-type",format:{typeName:l.declarations[0].id.sv},target:l}));return}let s=eu(r,o);if(ee.finish(i,a.BaseType),(0,M.xg)(s)){(0,f.a7)(e.hasError(),"Should already have reported an error.",r);return}if("Scalar"!==s.kind){eo((0,h.o)({code:"extend-model",target:r}));return}return s}(n,n.extends,r),l.baseScalar&&(ex(l.baseScalar,l),l.baseScalar.derivedScalars.push(l))),function(e,t,n,r){if(e.baseScalar)for(let a of e.baseScalar.constructors.values()){let o=th(td(t.symbol,a.name),{...a,scalar:e});e8(t,o,r),n.set(a.name,o)}for(let a of t.members){let t=ta(a,r,e);if(n.has(t.name)){eo((0,h.o)({code:"constructor-duplicate",format:{name:t.name.toString()},target:a}));continue}n.set(t.name,t)}}(l,n,l.constructors,r),i.push(...tn(l,n,r)),void 0===r&&l.namespace?.scalars.set(l.name,l),K(l,r),eX(n,r)&&ty(l),eh(l)&&(P[l.name]=l),l}function ta(e,t,n){let r=e.id.sv,a=tc(e);if(a&&a.declaredType&&void 0===t)return a.declaredType;let o=tm({kind:"ScalarConstructor",scalar:n,name:r,node:e,parameters:e.parameters.map(e=>eN(e,t,!1))});return K(o,t),eX(e.parent,t)&&ty(o),a&&es(a,o,t),ty(o)}function to(e,t){let n=eC(e.symbol);if(n.declaredType&&void 0===t)return n.declaredType;ez(e,t);let r=ek(e);if(ee.has(r,a.Type))return void 0===t&&eo((0,h.o)({code:"circular-alias-type",format:{typeName:e.id.sv},target:e})),n.declaredType=G,G;ee.start(r,a.Type);let o=ev(e.value,t);return null===o?(n.declaredType=G,G):(0,M.ml)(o)?(eo((0,h.o)({code:"value-in-type",target:e.value})),n.declaredType=G,G):(es(n,o,t),ee.finish(r,a.Type),o)}function ti(e,t){let n=eC(e.symbol);if(n.declaredType&&void 0===t)return n.declaredType;ez(e,t);let r=tm({kind:"Interface",decorators:[],node:e,namespace:eD(e),sourceInterfaces:[],operations:(0,l.nQ)(),name:e.id.sv});es(n,r,t),r.decorators=tn(r,e,t);let a=function(e,t,n){let r=new Map;for(let a of e.operations){let e=eK(a,t,n);if(r.has(e.name)){eo((0,h.o)({code:"interface-duplicate",format:{name:e.name},target:a}));continue}r.set(e.name,e)}return r}(e,t,r);for(let n of e.extends){let o=eu(n,t);if("Interface"!==o.kind){eo((0,h.o)({code:"extends-interface",target:n}));continue}for(let i of o.operations.values()){r.operations.has(i.name)&&eo((0,h.o)({code:"extends-interface-duplicate",format:{name:i.name},target:n}));let o=th(td(e.symbol,i.name),i,{interface:r});a.has(i.name)||e8(e,o,t),ex(i,o),r.operations.set(o.name,o)}r.sourceInterfaces.push(o)}for(let[e,t]of a)r.operations.set(e,t);return K(r,t),eX(e,t)&&ty(r),void 0===t&&r.namespace?.interfaces.set(r.name,r),e7(r),e4(r),r}function tl(e,t){let n=eC(e.symbol);if(n.declaredType&&void 0===t)return n.declaredType;ez(e,t);let r=(0,l.nQ)(),a=tm({kind:"Union",decorators:[],node:e,namespace:eD(e),name:e.id.sv,variants:r,get options(){return Array.from(this.variants.values()).map(e=>e.type)},expression:!1});return es(n,a,t),a.decorators=tn(a,e,t),function(e,t,n,r){for(let a of t.options){let t=ts(a,r);if(t.union=e,n.has(t.name)){eo((0,h.o)({code:"union-duplicate",format:{name:t.name.toString()},target:a}));continue}n.set(t.name,t)}}(a,e,r,t),K(a,t),eX(e,t)&&ty(a),void 0===t&&a.namespace?.unions.set(a.name,a),e7(a),e4(a),a}function ts(e,t){let n=tc(e);if(n&&n.declaredType&&void 0===t)return n.declaredType;let r=e.id?e.id.sv:Symbol("name"),a=eu(e.value,t),o=tm({kind:"UnionVariant",name:r,node:e,decorators:[],type:a,union:void 0});return o.decorators=tn(o,e,t),K(o,t),eX(e.parent,t)&&ty(o),n&&es(n,o,t),o}function td(e,n){return e?t.getAugmentedSymbolTable(e.members).get(n):void 0}function tu(e){if(!e.id)return;let t=e.id.sv,n=e.parent?.symbol;return n?td(n,t):void 0}function tc(e){let t=tu(e);return t&&(0,s.gG)(t)===e?eC(t):void 0}function tp(e,t,n){let r=e.id.sv,a=tc(e);if(a?.type)return a.type;(0,f.a7)(n,"Enum member should already have been checked.");let o=e.value?e.value.value:void 0,i=tm({kind:"EnumMember",enum:n,name:r,node:e,value:o,decorators:[]});return a&&(a.type=i),i.decorators=tn(i,e,t),ty(i)}function tf(e){return tm(e),ty(e)}function tm(t){return Object.setPrototypeOf(t,D),t.isFinished=!1,t.entityKind="Type",t.node&&function(t,n){let r=!1;for(let a of t.directives??[])if("deprecated"===a.target.sv){let o;let i=a.arguments[0];if(void 0===i){eo((0,h.o)({code:"invalid-deprecation-argument",messageId:"missing",target:a}));continue}i.kind!==E.a6.StringLiteral?(eo((0,h.o)({code:"invalid-deprecation-argument",format:{kind:E.a6[i.kind]},target:a.arguments[0]})),o="<missing message>"):o=i.value,!0===r?eo((0,h.o)({code:"duplicate-deprecation",target:t})):(r=!0,(0,p.BG)(e,n,{message:o}))}}(t.node,t),t}function ty(t){return C(e,D,t)}function tg(e){return tE(e.value,e)}function tv(e){return t.getMergedSymbol(e)}function tk(e,t){let n;switch(e.kind){case"Model":let r=tm({...e,decorators:[...e.decorators],properties:void 0,...t});"properties"in t||(r.properties=(0,l.nQ)(Array.from(e.properties.entries()).map(([e,t])=>[e,tb(t,{model:r})]))),n=r;break;case"Union":let a=tm({...e,decorators:[...e.decorators],variants:void 0,get options(){return Array.from(this.variants.values()).map(e=>e.type)},...t});"variants"in t||(a.variants=(0,l.nQ)(Array.from(e.variants.entries()).map(([e,t])=>[e,tb(t,{union:a})]))),n=a;break;case"Interface":let o=tm({...e,decorators:[...e.decorators],operations:void 0,...t});"operations"in t||(o.operations=(0,l.nQ)(Array.from(e.operations.entries()).map(([e,t])=>[e,tb(t,{interface:o})]))),n=o;break;case"Enum":let i=tm({...e,decorators:[...e.decorators],members:void 0,...t});"members"in t||(i.members=(0,l.nQ)(Array.from(e.members.entries()).map(([e,t])=>[e,tb(t,{enum:i})]))),n=i;break;default:n=tm({...e,..."decorators"in e?{decorators:[...e.decorators]}:{},...t})}return n}function tb(e,t={}){let n=tk(e,t);e.isFinished&&(n=ty(n));let r=Y.get(e);return r&&Y.set(n,r),(0,f.a7)(n.kind===e.kind,"cloneType must not change type kind"),n}function th(e,t,n={}){let r=tk(t,n);if("decorators"in r){let t=I.get(e);for(let n of(t&&r.decorators.push(e9("self",t)),tt(e,r,void 0)))r.decorators.push(n)}return t.isFinished&&(r=ty(r)),(0,f.a7)(r.kind===t.kind,"cloneType must not change type kind"),r}function tT(n){switch(n.kind){case E.a6.ProjectionExpressionStatement:return tT(n.expr);case E.a6.ProjectionCallExpression:return function(e){let t=tT(e.target);if(!t)throw new f._f("target undefined");let n=[];for(let t of e.arguments)n.push(tT(t));if("Function"!==t.kind)throw new f._f("Can't call non-function, got type "+t.kind);return t.implementation(...n)}(n);case E.a6.ProjectionMemberExpression:return function(e){let t=tT(e.base);if("Return"===t.kind)return t;let n=e.id.sv,r=e.selector;if("."===r)switch(t.kind){case"Namespace":let a=t.node.symbol.exports.get(n);if(a){let e=eC(a);return e.declaredType||e.type||G}throw new f._f(`Namespace doesn't have member ${n}`);case"Model":let o=t.properties.get(n);if(!o)throw new f._f(`Model doesn't have property ${n}`);return o;case"Enum":let i=t.members.get(n);if(!i)throw new f._f(`Enum doesn't have member ${n}`);return i;case"Union":let l=t.variants.get(n);if(!l)throw new f._f(`Union doesn't have variant ${n}`);return l;default:throw new f._f(`Can't get member "${n}" of type ${t.kind} because it has no members. Did you mean to use "::" instead of "."?`)}if("Object"===t.kind)return t.properties[n]||G;{let e=ea[t.kind];if(!e)throw new f._f(`${t.kind} doesn't have an object model member named ${n}`);let r=e[n];if(!r)throw new f._f(`${t.kind} doesn't have an object model member named ${n}`);return r(t)}}(n);case E.a6.ProjectionDecoratorReferenceExpression:return function(t){let n=eL(t.target,void 0,!0);if(!n)throw new f._f("Can't find decorator.");return(0,f.a7)(1024&n.flags,"should only resolve decorator symbols"),tM((...t)=>(n.value({program:e},...t.map(L)),X))}(n);case E.a6.Identifier:return function(n){let a=r;for(;a;){if(a.locals.has(n.sv))return a.locals.get(n.sv);a=a.parent}let{finalSymbol:o}=t.resolveTypeReference(n);if(!o)throw new f._f("Unknown identifier "+n.sv);if(1024&o.flags)return G;if(8192&o.flags)return tM((...t)=>{let r=o.value(e,...t.map(L));return tP(r,{functionName:n.sv})});{let e=eC(o);return(0,f.a7)(e.declaredType,"Should have checked all types by now"),e.declaredType}}(n);case E.a6.ProjectionLambdaExpression:return tM((...e)=>(function(e,t){let n=r;for(let[a,o]of(r=tS(e,n),e.parameters.entries()))r.locals.set(o.id.sv,t[a]);let a=tx(e.body);return(r=n,"Return"===a.kind)?a.value:a})(n,e));case E.a6.StringLiteral:case E.a6.NumericLiteral:case E.a6.BooleanLiteral:return tE(n.value,n);case E.a6.ProjectionBlockExpression:return tx(n);case E.a6.ProjectionArithmeticExpression:return function(e){let t=tT(e.left);if("Return"===t.kind)return t;if("Number"!==t.kind&&"String"!==t.kind)throw new f._f(`Operator ${e.op} can only apply to strings or numbers`);let n=tT(e.right);if("Return"===n.kind)return n;if("Number"!==n.kind&&"String"!==n.kind)throw new f._f(`Operator ${e.op} can only apply to strings or numbers`);if(n.kind!==t.kind)throw new f._f(`Operator ${e.op}'s operands need to be the same type`);return t.kind,tE(t.value+n.value)}(n);case E.a6.ProjectionIfExpression:return function(e){let t=e;for(;t;){let e=tT(t.test);if("Return"===e.kind)return e;if(function(e){switch(e.kind){case"Boolean":return e.value;case"Number":case"String":return!!e.value;default:return!0}}(e))return tx(t.consequent);if(t.alternate&&t.alternate.kind===E.a6.ProjectionBlockExpression)return tx(t.alternate);t=t.alternate}return X}(n);case E.a6.ProjectionEqualityExpression:return function(e){let t=tT(e.left);if("Return"===t.kind)return t;if("Number"!==t.kind&&"String"!==t.kind)throw new f._f("Comparisons must be strings or numbers");let n=tT(e.right);if("Return"===n.kind)return n;if("Number"!==n.kind&&"String"!==n.kind)throw new f._f("Comparisons must be strings or numbers");if(n.kind!==t.kind)throw new f._f("Can't compare number and string");switch(e.op){case"==":return tE(t.value===n.value);case"!=":return tE(t.value!==n.value)}}(n);case E.a6.ProjectionUnaryExpression:return function(e){let t=tT(e.target);if("Boolean"!==t.kind)throw new f._f("Can't negate a non-boolean");if("!"===e.op)return tE(!t.value)}(n);case E.a6.ProjectionRelationalExpression:return function(e){let t=tT(e.left);if("Return"===t.kind)return t;if("Number"!==t.kind&&"String"!==t.kind)throw new f._f("Can only compare numbers or strings");let n=tT(e.right);if("Return"===n.kind)return n;if("Number"!==n.kind&&"String"!==n.kind)throw new f._f("Can only compare numbers or strings");if(t.kind!==n.kind)throw new f._f("Can't compare numbers and strings");switch(e.op){case"<":return tE(t.value<n.value);case"<=":return tE(t.value<=n.value);case">":return tE(t.value>n.value);case">=":return tE(t.value>=n.value)}}(n);case E.a6.ProjectionModelExpression:return function(e){let t=tm({kind:"Model",name:"",node:e,decorators:[],properties:(0,l.nQ)(),derivedModels:[],sourceModels:[]});for(let n of e.properties)if(n.kind===E.a6.ProjectionModelProperty){let e=function(e,t){let n=tT(e.value);return"Return"===n.kind?n:tm({kind:"ModelProperty",name:e.id.sv,node:e,decorators:[],optional:e.optional,type:n,model:t})}(n,t);if("Return"===e.kind)return e;t.properties.set(e.name,e)}else{let e=function(e){let t=tT(e.target);if("Return"===t.kind)return t;if("Model"!==t.kind)throw new f._f("Can only spread models");let n=[];for(let e of V(t)){let t=tb(e,{sourceProperty:e});n.push(t)}return n}(n);if(!Array.isArray(e))return e;for(let n of e)t.properties.set(n.name,n)}return t}(n);case E.a6.VoidKeyword:return X;case E.a6.NeverKeyword:return q;case E.a6.UnknownKeyword:return J;case E.a6.Return:return function(e){let t=tT(e.value);return"Return"===t.kind?t:{kind:"Return",value:t}}(n);default:(0,f.a7)(!1,`Can't eval the node ${E.a6[n.kind]}`)}}function tS(e,t){return{node:e,locals:new Map,parent:t}}function tx(e){let t=X;for(let n of e.statements){let e=tT(n);if("Return"===e.kind)return e;t=e}return t}function tw(e,t,a){if("<error>"===e.direction)throw new f._f("Cannot evaluate projection with invalid direction.");let o=!1;if(n||(o=!0,n=e.direction),"from"===n&&!t.projectionSource)return t;let i=r;for(let[t,n]of(r=tS(e),e.parameters.entries())){let o;if(!a[t])throw new f._f("need argument for parameter "+E.a6[e.parameters[t].kind]);let i=a[t];o="number"==typeof i||"string"==typeof i||"boolean"==typeof i?tE(i):i,r.locals.set(n.id.sv,o)}r.locals.set("self",t);let l=X;for(let t of e.body)if(l=tT(t),"Return"===l.kind)break;o&&(n=void 0);let s=r.locals.get("self");return(r=i,"Return"===l.kind)?l.value:s}function tM(e){return tm({kind:"Function",name:"",parameters:[],returnType:J,implementation:e})}function tE(t,n){let r,a;if(e.literalTypes.has(t))return e.literalTypes.get(t);switch(typeof t){case"string":r=tm({kind:"String",value:t});break;case"boolean":r=tm({kind:"Boolean",value:t});break;case"number":n?((0,f.a7)(n.kind===E.a6.NumericLiteral,"Must pass numeric literal node or undefined when creating a numeric literal type"),a=n.valueAsString):a=String(t),r=tm({kind:"Number",value:t,valueAsString:a,numericValue:(0,T.ew)(a)})}return e.literalTypes.set(t,r),r}function tP(e,t={}){if("boolean"==typeof e||"string"==typeof e||"number"==typeof e)return tE(e);if("object"==typeof e&&null!==e)return"kind"in e?e:tm({kind:"Object",properties:e});if(t.functionName)throw new f._f(`Can't marshal value "${e}" returned from JS function "${t.functionName}" into typespec`);throw new f._f(`Can't marshal value "${e}" into typespec`)}function tI(e,t,n){let[r,a]=er.isTypeAssignableTo(e,t.type,n);return r||("argument"===t.kind?eo((0,h.o)({code:"invalid-argument",format:{value:(0,k.He)(e),expected:(0,k.He)(t.type)},target:n})):ei(a)),r}function tN(e,t,n){let[r,a]=er.isTypeAssignableTo(e,t,n);return r||ei(a),r}function tA(e,t,n){let[r,a]=er.isValueOfType(e,t,n);return r||ei(a),r}}function N(e,t,n,r){let a=new Map(r?.map??[]);for(let[n,r]of e.entries())a.set(r,t[n]);return{partial:!1,args:[...r?.args??[],...t],getMappedType:e=>a.get(e)??e,source:n,map:a}}function A(e,t,n){let r,a;if(n&&(t=j(e,t,n)),t.name||((0,f.a7)(!t.baseModel,"Anonymous model with base model."),0===t.properties.size))return t;for(let e of t.properties.values()){let n=function(e){if(!e.sourceProperty)return;let t=new Set;for(let n=e;n;n=n.sourceProperty)n.model?.name&&t.add(n.model);return t}(e);if(!n)return t;if(!r){r=n;continue}for(let e of(!function(e,t){for(let n of t)if(!e.has(n)){for(let t=n.baseModel;t;t=t.baseModel)if(e.has(t)){e.add(n);break}}}(n,r),r))n.has(e)||r.delete(e)}for(let e of r??[]){if(t.properties.size===U(e)){a=e;break}if(n&&!a&&t.properties.size===U(e,n)){a=e;continue}}return a??t}function j(e,t,n){let r=!1;for(let e of V(t))if(!n(e)){r=!0;break}if(!r)return t;let a=(0,l.nQ)(),o=e.checker.createType({kind:"Model",node:void 0,name:"",indexer:void 0,properties:a,decorators:[],derivedModels:[],sourceModels:[{usage:"spread",model:t}]});for(let r of V(t))if(n(r)){let t=e.checker.cloneType(r,{sourceProperty:r,model:o});a.set(r.name,t)}return D(e,o)}function*V(e){let t=new Set;for(let n=e;n;n=n.baseModel)for(let e of n.properties.values())t.has(e.name)||(t.add(e.name),yield e)}function U(e,t){let n=0;for(let r of V(e))(!t||t(r))&&n++;return n}function D(e,t){return C(e,e.checker.typePrototype,t)}function K(e,t){t&&((0,f.a7)(!e.templateArguments,"Mapper provided but template arguments already set."),e.templateMapper=t,e.templateArguments=t.args)}function O(e){let t=[];for(let n of e)(0,f.a7)(n.kind===E.a6.DocText,"No other doc content node kinds exist yet. Update this code appropriately when more are added."),t.push(n.text);return t.join("")}function C(e,t,n){if("decorators"in n)for(let t of n.decorators)!function(e,t,n){for(let e of((0,f.a7)("decorators"in n,"Cannot apply decorator to non-decoratable type",n),t.args))if((0,M.Xj)(e.value)&&(0,M.xg)(e.value))return;if(t.definition){let r=(0,p.LA)(e,t.definition);void 0!==r&&B(e,t.node??n,r.message,e.reportDiagnostic)}try{let r=t.args.map(e=>e.jsValue),a=t.decorator,o=function(e,t){return{program:e,decoratorTarget:t.node,getArgumentTarget:e=>t.args[e]?.node,call:(n,r,...a)=>n(function e(t,n){return{program:t,decoratorTarget:n.node,getArgumentTarget:()=>n.node,call:(r,a,...o)=>r(e(t,n),a,...o)}}(e,t),r,...a)}}(e,t);a(o,n,...r)}catch(r){if(e.compilerOptions.designTimeBuild)e.reportDiagnostic((0,h.o)({code:"decorator-fail",format:{decoratorName:t.decorator.name,error:r.stack},target:t.node??n}));else throw r}}(e,t,n);return Object.setPrototypeOf(n,t),n.isFinished=!0,n}function B(e,t,n,r){!0!==e.compilerOptions.ignoreDeprecated&&r((0,h.o)({code:"deprecated",format:{message:n},target:t}))}function R(e){return"templateParameters"in e&&e.templateParameters.length>0}!function(e){e[e.Value=0]="Value",e[e.Type=1]="Type",e[e.BaseType=2]="BaseType",e[e.Constraint=3]="Constraint"}(a||(a={}));class _{#e=new Map;start(e,t){let n=this.#e.get(e);void 0===n&&(n=new Set,this.#e.set(e,n)),n.add(t)}has(e,t){return this.#e.get(e)?.has(t)??!1}finish(e,t){let n=this.#e.get(e);void 0!==n&&(n?.delete(t),0===n.size&&this.#e.delete(e))}}let F={resolveDecorators:!1,checkTemplateTypes:!0};function L(e){return"Boolean"===e.kind||"String"===e.kind||"Number"===e.kind?e.value:"StringTemplate"===e.kind?e.stringValue:e}r()}catch(e){r(e)}})}}]);