/** AUTOGENERATED - DO NOT EDIT **/
/* tslint:disable */
/* eslint-disable */

import {
  t_CreateTodoListItemBodySchema,
  t_CreateTodoListItemParamSchema,
  t_DeleteTodoListByIdParamSchema,
  t_Error,
  t_GetTodoListByIdParamSchema,
  t_GetTodoListItemsParamSchema,
  t_GetTodoListsQuerySchema,
  t_TodoList,
  t_UnknownObject,
  t_UpdateTodoListByIdBodySchema,
  t_UpdateTodoListByIdParamSchema,
  t_UploadAttachmentBodySchema,
} from "./models"
import {
  s_CreateUpdateTodoList,
  s_Error,
  s_Statuses,
  s_TodoList,
  s_UnknownObject,
} from "./schemas"
import KoaRouter, { RouterContext } from "@koa/router"
import {
  KoaRuntimeError,
  RequestInputType,
} from "@nahkies/typescript-koa-runtime/errors"
import {
  KoaRuntimeResponder,
  KoaRuntimeResponse,
  Params,
  Response,
  ServerConfig,
  StatusCode,
  StatusCode4xx,
  StatusCode5xx,
  b,
  startServer,
} from "@nahkies/typescript-koa-runtime/server"
import { parseRequestInput } from "@nahkies/typescript-koa-runtime/zod"
import { z } from "zod"

const getTodoLists = b((r) => ({
  with200: r.with200<t_TodoList[]>(z.array(s_TodoList)),
  withStatus: r.withStatus,
}))

type GetTodoListsResponder = (typeof getTodoLists)["responder"] &
  KoaRuntimeResponder

export type GetTodoLists = (
  params: Params<void, t_GetTodoListsQuerySchema, void, void>,
  respond: GetTodoListsResponder,
  ctx: RouterContext,
) => Promise<KoaRuntimeResponse<unknown> | Response<200, t_TodoList[]>>

const getTodoListById = b((r) => ({
  with200: r.with200<t_TodoList>(s_TodoList),
  withStatusCode4xx: r.withStatusCode4xx<t_Error>(s_Error),
  withDefault: r.withDefault<void>(z.undefined()),
  withStatus: r.withStatus,
}))

type GetTodoListByIdResponder = (typeof getTodoListById)["responder"] &
  KoaRuntimeResponder

export type GetTodoListById = (
  params: Params<t_GetTodoListByIdParamSchema, void, void, void>,
  respond: GetTodoListByIdResponder,
  ctx: RouterContext,
) => Promise<
  | KoaRuntimeResponse<unknown>
  | Response<200, t_TodoList>
  | Response<StatusCode4xx, t_Error>
  | Response<StatusCode, void>
>

const updateTodoListById = b((r) => ({
  with200: r.with200<t_TodoList>(s_TodoList),
  withStatusCode4xx: r.withStatusCode4xx<t_Error>(s_Error),
  withDefault: r.withDefault<void>(z.undefined()),
  withStatus: r.withStatus,
}))

type UpdateTodoListByIdResponder = (typeof updateTodoListById)["responder"] &
  KoaRuntimeResponder

export type UpdateTodoListById = (
  params: Params<
    t_UpdateTodoListByIdParamSchema,
    void,
    t_UpdateTodoListByIdBodySchema,
    void
  >,
  respond: UpdateTodoListByIdResponder,
  ctx: RouterContext,
) => Promise<
  | KoaRuntimeResponse<unknown>
  | Response<200, t_TodoList>
  | Response<StatusCode4xx, t_Error>
  | Response<StatusCode, void>
>

const deleteTodoListById = b((r) => ({
  with204: r.with204<void>(z.undefined()),
  withStatusCode4xx: r.withStatusCode4xx<t_Error>(s_Error),
  withDefault: r.withDefault<void>(z.undefined()),
  withStatus: r.withStatus,
}))

type DeleteTodoListByIdResponder = (typeof deleteTodoListById)["responder"] &
  KoaRuntimeResponder

export type DeleteTodoListById = (
  params: Params<t_DeleteTodoListByIdParamSchema, void, void, void>,
  respond: DeleteTodoListByIdResponder,
  ctx: RouterContext,
) => Promise<
  | KoaRuntimeResponse<unknown>
  | Response<204, void>
  | Response<StatusCode4xx, t_Error>
  | Response<StatusCode, void>
>

const getTodoListItems = b((r) => ({
  with200: r.with200<{
    completedAt?: string
    content: string
    createdAt: string
    id: string
  }>(
    z.object({
      id: z.string(),
      content: z.string(),
      createdAt: z.string().datetime({ offset: true }),
      completedAt: z.string().datetime({ offset: true }).optional(),
    }),
  ),
  withStatusCode5xx: r.withStatusCode5xx<{
    code: string
    message: string
  }>(z.object({ message: z.string(), code: z.string() })),
  withStatus: r.withStatus,
}))

type GetTodoListItemsResponder = (typeof getTodoListItems)["responder"] &
  KoaRuntimeResponder

export type GetTodoListItems = (
  params: Params<t_GetTodoListItemsParamSchema, void, void, void>,
  respond: GetTodoListItemsResponder,
  ctx: RouterContext,
) => Promise<
  | KoaRuntimeResponse<unknown>
  | Response<
      200,
      {
        completedAt?: string
        content: string
        createdAt: string
        id: string
      }
    >
  | Response<
      StatusCode5xx,
      {
        code: string
        message: string
      }
    >
>

const createTodoListItem = b((r) => ({
  with204: r.with204<void>(z.undefined()),
  withStatus: r.withStatus,
}))

type CreateTodoListItemResponder = (typeof createTodoListItem)["responder"] &
  KoaRuntimeResponder

export type CreateTodoListItem = (
  params: Params<
    t_CreateTodoListItemParamSchema,
    void,
    t_CreateTodoListItemBodySchema,
    void
  >,
  respond: CreateTodoListItemResponder,
  ctx: RouterContext,
) => Promise<KoaRuntimeResponse<unknown> | Response<204, void>>

const listAttachments = b((r) => ({
  with200: r.with200<t_UnknownObject[]>(z.array(s_UnknownObject)),
  withStatus: r.withStatus,
}))

type ListAttachmentsResponder = (typeof listAttachments)["responder"] &
  KoaRuntimeResponder

export type ListAttachments = (
  params: Params<void, void, void, void>,
  respond: ListAttachmentsResponder,
  ctx: RouterContext,
) => Promise<KoaRuntimeResponse<unknown> | Response<200, t_UnknownObject[]>>

const uploadAttachment = b((r) => ({
  with202: r.with202<void>(z.undefined()),
  withStatus: r.withStatus,
}))

type UploadAttachmentResponder = (typeof uploadAttachment)["responder"] &
  KoaRuntimeResponder

export type UploadAttachment = (
  params: Params<void, void, t_UploadAttachmentBodySchema, void>,
  respond: UploadAttachmentResponder,
  ctx: RouterContext,
) => Promise<KoaRuntimeResponse<unknown> | Response<202, void>>

export type Implementation = {
  getTodoLists: GetTodoLists
  getTodoListById: GetTodoListById
  updateTodoListById: UpdateTodoListById
  deleteTodoListById: DeleteTodoListById
  getTodoListItems: GetTodoListItems
  createTodoListItem: CreateTodoListItem
  listAttachments: ListAttachments
  uploadAttachment: UploadAttachment
}

export function createRouter(implementation: Implementation): KoaRouter {
  const router = new KoaRouter()

  const getTodoListsQuerySchema = z.object({
    created: z.string().datetime({ offset: true }).optional(),
    statuses: z
      .preprocess(
        (it: unknown) => (Array.isArray(it) || it === undefined ? it : [it]),
        s_Statuses,
      )
      .optional(),
    tags: z
      .preprocess(
        (it: unknown) => (Array.isArray(it) || it === undefined ? it : [it]),
        z.array(z.string()),
      )
      .optional(),
  })

  router.get("getTodoLists", "/list", async (ctx, next) => {
    const input = {
      params: undefined,
      query: parseRequestInput(
        getTodoListsQuerySchema,
        ctx.query,
        RequestInputType.QueryString,
      ),
      body: undefined,
      headers: undefined,
    }

    const response = await implementation
      .getTodoLists(input, getTodoLists.responder, ctx)
      .catch((err) => {
        throw KoaRuntimeError.HandlerError(err)
      })

    const { status, body } =
      response instanceof KoaRuntimeResponse ? response.unpack() : response

    ctx.body = getTodoLists.validator(status, body)
    ctx.status = status
    return next()
  })

  const getTodoListByIdParamSchema = z.object({ listId: z.string() })

  router.get("getTodoListById", "/list/:listId", async (ctx, next) => {
    const input = {
      params: parseRequestInput(
        getTodoListByIdParamSchema,
        ctx.params,
        RequestInputType.RouteParam,
      ),
      query: undefined,
      body: undefined,
      headers: undefined,
    }

    const response = await implementation
      .getTodoListById(input, getTodoListById.responder, ctx)
      .catch((err) => {
        throw KoaRuntimeError.HandlerError(err)
      })

    const { status, body } =
      response instanceof KoaRuntimeResponse ? response.unpack() : response

    ctx.body = getTodoListById.validator(status, body)
    ctx.status = status
    return next()
  })

  const updateTodoListByIdParamSchema = z.object({ listId: z.string() })

  const updateTodoListByIdBodySchema = s_CreateUpdateTodoList

  router.put("updateTodoListById", "/list/:listId", async (ctx, next) => {
    const input = {
      params: parseRequestInput(
        updateTodoListByIdParamSchema,
        ctx.params,
        RequestInputType.RouteParam,
      ),
      query: undefined,
      body: parseRequestInput(
        updateTodoListByIdBodySchema,
        Reflect.get(ctx.request, "body"),
        RequestInputType.RequestBody,
      ),
      headers: undefined,
    }

    const response = await implementation
      .updateTodoListById(input, updateTodoListById.responder, ctx)
      .catch((err) => {
        throw KoaRuntimeError.HandlerError(err)
      })

    const { status, body } =
      response instanceof KoaRuntimeResponse ? response.unpack() : response

    ctx.body = updateTodoListById.validator(status, body)
    ctx.status = status
    return next()
  })

  const deleteTodoListByIdParamSchema = z.object({ listId: z.string() })

  router.delete("deleteTodoListById", "/list/:listId", async (ctx, next) => {
    const input = {
      params: parseRequestInput(
        deleteTodoListByIdParamSchema,
        ctx.params,
        RequestInputType.RouteParam,
      ),
      query: undefined,
      body: undefined,
      headers: undefined,
    }

    const response = await implementation
      .deleteTodoListById(input, deleteTodoListById.responder, ctx)
      .catch((err) => {
        throw KoaRuntimeError.HandlerError(err)
      })

    const { status, body } =
      response instanceof KoaRuntimeResponse ? response.unpack() : response

    ctx.body = deleteTodoListById.validator(status, body)
    ctx.status = status
    return next()
  })

  const getTodoListItemsParamSchema = z.object({ listId: z.string() })

  router.get("getTodoListItems", "/list/:listId/items", async (ctx, next) => {
    const input = {
      params: parseRequestInput(
        getTodoListItemsParamSchema,
        ctx.params,
        RequestInputType.RouteParam,
      ),
      query: undefined,
      body: undefined,
      headers: undefined,
    }

    const response = await implementation
      .getTodoListItems(input, getTodoListItems.responder, ctx)
      .catch((err) => {
        throw KoaRuntimeError.HandlerError(err)
      })

    const { status, body } =
      response instanceof KoaRuntimeResponse ? response.unpack() : response

    ctx.body = getTodoListItems.validator(status, body)
    ctx.status = status
    return next()
  })

  const createTodoListItemParamSchema = z.object({ listId: z.string() })

  const createTodoListItemBodySchema = z.object({
    id: z.string(),
    content: z.string(),
    completedAt: z.string().datetime({ offset: true }).optional(),
  })

  router.post(
    "createTodoListItem",
    "/list/:listId/items",
    async (ctx, next) => {
      const input = {
        params: parseRequestInput(
          createTodoListItemParamSchema,
          ctx.params,
          RequestInputType.RouteParam,
        ),
        query: undefined,
        body: parseRequestInput(
          createTodoListItemBodySchema,
          Reflect.get(ctx.request, "body"),
          RequestInputType.RequestBody,
        ),
        headers: undefined,
      }

      const response = await implementation
        .createTodoListItem(input, createTodoListItem.responder, ctx)
        .catch((err) => {
          throw KoaRuntimeError.HandlerError(err)
        })

      const { status, body } =
        response instanceof KoaRuntimeResponse ? response.unpack() : response

      ctx.body = createTodoListItem.validator(status, body)
      ctx.status = status
      return next()
    },
  )

  router.get("listAttachments", "/attachments", async (ctx, next) => {
    const input = {
      params: undefined,
      query: undefined,
      body: undefined,
      headers: undefined,
    }

    const response = await implementation
      .listAttachments(input, listAttachments.responder, ctx)
      .catch((err) => {
        throw KoaRuntimeError.HandlerError(err)
      })

    const { status, body } =
      response instanceof KoaRuntimeResponse ? response.unpack() : response

    ctx.body = listAttachments.validator(status, body)
    ctx.status = status
    return next()
  })

  const uploadAttachmentBodySchema = z.object({ file: z.unknown().optional() })

  router.post("uploadAttachment", "/attachments", async (ctx, next) => {
    const input = {
      params: undefined,
      query: undefined,
      body: parseRequestInput(
        uploadAttachmentBodySchema,
        Reflect.get(ctx.request, "body"),
        RequestInputType.RequestBody,
      ),
      headers: undefined,
    }

    const response = await implementation
      .uploadAttachment(input, uploadAttachment.responder, ctx)
      .catch((err) => {
        throw KoaRuntimeError.HandlerError(err)
      })

    const { status, body } =
      response instanceof KoaRuntimeResponse ? response.unpack() : response

    ctx.body = uploadAttachment.validator(status, body)
    ctx.status = status
    return next()
  })

  return router
}

export async function bootstrap(config: ServerConfig) {
  // Todo Lists Example API
  return startServer(config)
}
