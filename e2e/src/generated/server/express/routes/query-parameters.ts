/** AUTOGENERATED - DO NOT EDIT **/
/* tslint:disable */
/* eslint-disable */

import {RequestInputType} from "@nahkies/typescript-express-runtime/errors"
import {
  type ExpressRuntimeResponder,
  ExpressRuntimeResponse,
  handleImplementationError,
  handleResponse,
  type Params,
  parseQueryParameters,
  type SkipResponse,
  type StatusCode,
} from "@nahkies/typescript-express-runtime/server"
import {
  parseRequestInput,
  responseValidationFactory,
} from "@nahkies/typescript-express-runtime/zod-v4"
import {type NextFunction, type Request, type Response, Router} from "express"
import {z} from "zod/v4"
import type {
  t_GetParamsDefaultObjectQuery200Response,
  t_GetParamsDefaultObjectQueryQuerySchema,
  t_GetParamsMixedQuery200Response,
  t_GetParamsMixedQueryQuerySchema,
  t_GetParamsSimpleQuery200Response,
  t_GetParamsSimpleQueryQuerySchema,
  t_GetParamsUnexplodedObjectQuery200Response,
  t_GetParamsUnexplodedObjectQueryQuerySchema,
} from "../models.ts"
import {
  s_GetParamsDefaultObjectQuery200Response,
  s_GetParamsMixedQuery200Response,
  s_GetParamsSimpleQuery200Response,
  s_GetParamsUnexplodedObjectQuery200Response,
} from "../schemas.ts"

export type GetParamsSimpleQueryResponder = {
  with200(): ExpressRuntimeResponse<t_GetParamsSimpleQuery200Response>
} & ExpressRuntimeResponder

export type GetParamsSimpleQuery = (
  params: Params<void, t_GetParamsSimpleQueryQuerySchema, void, void>,
  respond: GetParamsSimpleQueryResponder,
  req: Request,
  res: Response,
  next: NextFunction,
) => Promise<ExpressRuntimeResponse<unknown> | typeof SkipResponse>

export type GetParamsDefaultObjectQueryResponder = {
  with200(): ExpressRuntimeResponse<t_GetParamsDefaultObjectQuery200Response>
} & ExpressRuntimeResponder

export type GetParamsDefaultObjectQuery = (
  params: Params<void, t_GetParamsDefaultObjectQueryQuerySchema, void, void>,
  respond: GetParamsDefaultObjectQueryResponder,
  req: Request,
  res: Response,
  next: NextFunction,
) => Promise<ExpressRuntimeResponse<unknown> | typeof SkipResponse>

export type GetParamsUnexplodedObjectQueryResponder = {
  with200(): ExpressRuntimeResponse<t_GetParamsUnexplodedObjectQuery200Response>
} & ExpressRuntimeResponder

export type GetParamsUnexplodedObjectQuery = (
  params: Params<void, t_GetParamsUnexplodedObjectQueryQuerySchema, void, void>,
  respond: GetParamsUnexplodedObjectQueryResponder,
  req: Request,
  res: Response,
  next: NextFunction,
) => Promise<ExpressRuntimeResponse<unknown> | typeof SkipResponse>

export type GetParamsMixedQueryResponder = {
  with200(): ExpressRuntimeResponse<t_GetParamsMixedQuery200Response>
} & ExpressRuntimeResponder

export type GetParamsMixedQuery = (
  params: Params<void, t_GetParamsMixedQueryQuerySchema, void, void>,
  respond: GetParamsMixedQueryResponder,
  req: Request,
  res: Response,
  next: NextFunction,
) => Promise<ExpressRuntimeResponse<unknown> | typeof SkipResponse>

export type QueryParametersImplementation = {
  getParamsSimpleQuery: GetParamsSimpleQuery
  getParamsDefaultObjectQuery: GetParamsDefaultObjectQuery
  getParamsUnexplodedObjectQuery: GetParamsUnexplodedObjectQuery
  getParamsMixedQuery: GetParamsMixedQuery
}

export function createQueryParametersRouter(
  implementation: QueryParametersImplementation,
): Router {
  const router = Router()

  const getParamsSimpleQueryQuerySchema = z.object({
    orderBy: z.enum(["asc", "desc"]),
    limit: z.coerce.number(),
  })

  const getParamsSimpleQueryResponseBodyValidator = responseValidationFactory(
    [["200", s_GetParamsSimpleQuery200Response]],
    undefined,
  )

  // getParamsSimpleQuery
  router.get(
    `/params/simple-query`,
    async (req: Request, res: Response, next: NextFunction) => {
      try {
        const input = {
          params: undefined,
          query: parseRequestInput(
            getParamsSimpleQueryQuerySchema,
            req.query,
            RequestInputType.QueryString,
          ),
          body: undefined,
          headers: undefined,
        }

        const responder = {
          with200() {
            return new ExpressRuntimeResponse<t_GetParamsSimpleQuery200Response>(
              200,
            )
          },
          withStatus(status: StatusCode) {
            return new ExpressRuntimeResponse(status)
          },
        }

        await implementation
          .getParamsSimpleQuery(input, responder, req, res, next)
          .catch(handleImplementationError)
          .then(handleResponse(res, getParamsSimpleQueryResponseBodyValidator))
      } catch (error) {
        next(error)
      }
    },
  )

  const getParamsDefaultObjectQueryQuerySchema = z.object({
    filter: z.object({name: z.string(), age: z.coerce.number()}),
  })

  const getParamsDefaultObjectQueryResponseBodyValidator =
    responseValidationFactory(
      [["200", s_GetParamsDefaultObjectQuery200Response]],
      undefined,
    )

  // getParamsDefaultObjectQuery
  router.get(
    `/params/default-object-query`,
    async (req: Request, res: Response, next: NextFunction) => {
      try {
        const input = {
          params: undefined,
          query: parseRequestInput(
            getParamsDefaultObjectQueryQuerySchema,
            parseQueryParameters(
              new URL(`http://localhost${req.originalUrl}`).search,
              [
                {
                  name: "filter",
                  explode: true,
                  style: "form",
                  schema: {
                    type: "object",
                    properties: {name: {type: "string"}, age: {type: "number"}},
                  },
                },
              ],
            ),
            RequestInputType.QueryString,
          ),
          body: undefined,
          headers: undefined,
        }

        const responder = {
          with200() {
            return new ExpressRuntimeResponse<t_GetParamsDefaultObjectQuery200Response>(
              200,
            )
          },
          withStatus(status: StatusCode) {
            return new ExpressRuntimeResponse(status)
          },
        }

        await implementation
          .getParamsDefaultObjectQuery(input, responder, req, res, next)
          .catch(handleImplementationError)
          .then(
            handleResponse(
              res,
              getParamsDefaultObjectQueryResponseBodyValidator,
            ),
          )
      } catch (error) {
        next(error)
      }
    },
  )

  const getParamsUnexplodedObjectQueryQuerySchema = z.object({
    filter: z.object({name: z.string(), age: z.coerce.number()}),
  })

  const getParamsUnexplodedObjectQueryResponseBodyValidator =
    responseValidationFactory(
      [["200", s_GetParamsUnexplodedObjectQuery200Response]],
      undefined,
    )

  // getParamsUnexplodedObjectQuery
  router.get(
    `/params/unexploded-object-query`,
    async (req: Request, res: Response, next: NextFunction) => {
      try {
        const input = {
          params: undefined,
          query: parseRequestInput(
            getParamsUnexplodedObjectQueryQuerySchema,
            parseQueryParameters(
              new URL(`http://localhost${req.originalUrl}`).search,
              [
                {
                  name: "filter",
                  explode: false,
                  style: "form",
                  schema: {
                    type: "object",
                    properties: {name: {type: "string"}, age: {type: "number"}},
                  },
                },
              ],
            ),
            RequestInputType.QueryString,
          ),
          body: undefined,
          headers: undefined,
        }

        const responder = {
          with200() {
            return new ExpressRuntimeResponse<t_GetParamsUnexplodedObjectQuery200Response>(
              200,
            )
          },
          withStatus(status: StatusCode) {
            return new ExpressRuntimeResponse(status)
          },
        }

        await implementation
          .getParamsUnexplodedObjectQuery(input, responder, req, res, next)
          .catch(handleImplementationError)
          .then(
            handleResponse(
              res,
              getParamsUnexplodedObjectQueryResponseBodyValidator,
            ),
          )
      } catch (error) {
        next(error)
      }
    },
  )

  const getParamsMixedQueryQuerySchema = z.object({
    limit: z.coerce.number(),
    statuses: z.preprocess(
      (it: unknown) => (Array.isArray(it) || it === undefined ? it : [it]),
      z.array(z.enum(["open", "closed"])),
    ),
  })

  const getParamsMixedQueryResponseBodyValidator = responseValidationFactory(
    [["200", s_GetParamsMixedQuery200Response]],
    undefined,
  )

  // getParamsMixedQuery
  router.get(
    `/params/mixed-query`,
    async (req: Request, res: Response, next: NextFunction) => {
      try {
        const input = {
          params: undefined,
          query: parseRequestInput(
            getParamsMixedQueryQuerySchema,
            req.query,
            RequestInputType.QueryString,
          ),
          body: undefined,
          headers: undefined,
        }

        const responder = {
          with200() {
            return new ExpressRuntimeResponse<t_GetParamsMixedQuery200Response>(
              200,
            )
          },
          withStatus(status: StatusCode) {
            return new ExpressRuntimeResponse(status)
          },
        }

        await implementation
          .getParamsMixedQuery(input, responder, req, res, next)
          .catch(handleImplementationError)
          .then(handleResponse(res, getParamsMixedQueryResponseBodyValidator))
      } catch (error) {
        next(error)
      }
    },
  )

  return router
}

export {createQueryParametersRouter as createRouter}
export type {QueryParametersImplementation as Implementation}
